/*! For license information please see bundlePopup.js.LICENSE.txt */
(()=>{var e={300:function(e){e.exports=function(){"use strict";const{entries:e,setPrototypeOf:t,isFrozen:n,getPrototypeOf:r,getOwnPropertyDescriptor:i}=Object;let{freeze:s,seal:o,create:a}=Object,{apply:c,construct:u}="undefined"!=typeof Reflect&&Reflect;s||(s=function(e){return e}),o||(o=function(e){return e}),c||(c=function(e,t,n){return e.apply(t,n)}),u||(u=function(e,t){return new e(...t)});const l=T(Array.prototype.forEach),h=T(Array.prototype.pop),d=T(Array.prototype.push),f=T(String.prototype.toLowerCase),p=T(String.prototype.toString),m=T(String.prototype.match),g=T(String.prototype.replace),y=T(String.prototype.indexOf),v=T(String.prototype.trim),w=T(RegExp.prototype.test),E=(_=TypeError,function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return u(_,t)});var _;function T(e){return function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return c(e,t,r)}}function b(e,r){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:f;t&&t(e,null);let s=r.length;for(;s--;){let t=r[s];if("string"==typeof t){const e=i(t);e!==t&&(n(r)||(r[s]=e),t=e)}e[t]=!0}return e}function I(e){for(let t=0;t<e.length;t++)void 0===i(e,t)&&(e[t]=null);return e}function S(t){const n=a(null);for(const[r,s]of e(t))void 0!==i(t,r)&&(Array.isArray(s)?n[r]=I(s):s&&"object"==typeof s&&s.constructor===Object?n[r]=S(s):n[r]=s);return n}function C(e,t){for(;null!==e;){const n=i(e,t);if(n){if(n.get)return T(n.get);if("function"==typeof n.value)return T(n.value)}e=r(e)}return function(e){return console.warn("fallback value for",e),null}}const A=s(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),k=s(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),N=s(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),D=s(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),R=s(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),L=s(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),O=s(["#text"]),P=s(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","xmlns","slot"]),x=s(["accent-height","accumulate","additive","alignment-baseline","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),M=s(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),U=s(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),F=o(/\{\{[\w\W]*|[\w\W]*\}\}/gm),V=o(/<%[\w\W]*|[\w\W]*%>/gm),B=o(/\${[\w\W]*}/gm),j=o(/^data-[\-\w.\u00B7-\uFFFF]/),z=o(/^aria-[\-\w]+$/),q=o(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),$=o(/^(?:\w+script|data):/i),H=o(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),G=o(/^html$/i);var K=Object.freeze({__proto__:null,MUSTACHE_EXPR:F,ERB_EXPR:V,TMPLIT_EXPR:B,DATA_ATTR:j,ARIA_ATTR:z,IS_ALLOWED_URI:q,IS_SCRIPT_OR_DATA:$,ATTR_WHITESPACE:H,DOCTYPE_NAME:G});const W=function(){return"undefined"==typeof window?null:window};return function t(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:W();const r=e=>t(e);if(r.version="3.0.8",r.removed=[],!n||!n.document||9!==n.document.nodeType)return r.isSupported=!1,r;let{document:i}=n;const o=i,c=o.currentScript,{DocumentFragment:u,HTMLTemplateElement:_,Node:T,Element:I,NodeFilter:F,NamedNodeMap:V=n.NamedNodeMap||n.MozNamedAttrMap,HTMLFormElement:B,DOMParser:j,trustedTypes:z}=n,$=I.prototype,H=C($,"cloneNode"),Q=C($,"nextSibling"),X=C($,"childNodes"),Y=C($,"parentNode");if("function"==typeof _){const e=i.createElement("template");e.content&&e.content.ownerDocument&&(i=e.content.ownerDocument)}let J,Z="";const{implementation:ee,createNodeIterator:te,createDocumentFragment:ne,getElementsByTagName:re}=i,{importNode:ie}=o;let se={};r.isSupported="function"==typeof e&&"function"==typeof Y&&ee&&void 0!==ee.createHTMLDocument;const{MUSTACHE_EXPR:oe,ERB_EXPR:ae,TMPLIT_EXPR:ce,DATA_ATTR:ue,ARIA_ATTR:le,IS_SCRIPT_OR_DATA:he,ATTR_WHITESPACE:de}=K;let{IS_ALLOWED_URI:fe}=K,pe=null;const me=b({},[...A,...k,...N,...R,...O]);let ge=null;const ye=b({},[...P,...x,...M,...U]);let ve=Object.seal(a(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),we=null,Ee=null,_e=!0,Te=!0,be=!1,Ie=!0,Se=!1,Ce=!1,Ae=!1,ke=!1,Ne=!1,De=!1,Re=!1,Le=!0,Oe=!1,Pe=!0,xe=!1,Me={},Ue=null;const Fe=b({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let Ve=null;const Be=b({},["audio","video","img","source","image","track"]);let je=null;const ze=b({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),qe="http://www.w3.org/1998/Math/MathML",$e="http://www.w3.org/2000/svg",He="http://www.w3.org/1999/xhtml";let Ge=He,Ke=!1,We=null;const Qe=b({},[qe,$e,He],p);let Xe=null;const Ye=["application/xhtml+xml","text/html"];let Je=null,Ze=null;const et=i.createElement("form"),tt=function(e){return e instanceof RegExp||e instanceof Function},nt=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!Ze||Ze!==e){if(e&&"object"==typeof e||(e={}),e=S(e),Xe=-1===Ye.indexOf(e.PARSER_MEDIA_TYPE)?"text/html":e.PARSER_MEDIA_TYPE,Je="application/xhtml+xml"===Xe?p:f,pe="ALLOWED_TAGS"in e?b({},e.ALLOWED_TAGS,Je):me,ge="ALLOWED_ATTR"in e?b({},e.ALLOWED_ATTR,Je):ye,We="ALLOWED_NAMESPACES"in e?b({},e.ALLOWED_NAMESPACES,p):Qe,je="ADD_URI_SAFE_ATTR"in e?b(S(ze),e.ADD_URI_SAFE_ATTR,Je):ze,Ve="ADD_DATA_URI_TAGS"in e?b(S(Be),e.ADD_DATA_URI_TAGS,Je):Be,Ue="FORBID_CONTENTS"in e?b({},e.FORBID_CONTENTS,Je):Fe,we="FORBID_TAGS"in e?b({},e.FORBID_TAGS,Je):{},Ee="FORBID_ATTR"in e?b({},e.FORBID_ATTR,Je):{},Me="USE_PROFILES"in e&&e.USE_PROFILES,_e=!1!==e.ALLOW_ARIA_ATTR,Te=!1!==e.ALLOW_DATA_ATTR,be=e.ALLOW_UNKNOWN_PROTOCOLS||!1,Ie=!1!==e.ALLOW_SELF_CLOSE_IN_ATTR,Se=e.SAFE_FOR_TEMPLATES||!1,Ce=e.WHOLE_DOCUMENT||!1,Ne=e.RETURN_DOM||!1,De=e.RETURN_DOM_FRAGMENT||!1,Re=e.RETURN_TRUSTED_TYPE||!1,ke=e.FORCE_BODY||!1,Le=!1!==e.SANITIZE_DOM,Oe=e.SANITIZE_NAMED_PROPS||!1,Pe=!1!==e.KEEP_CONTENT,xe=e.IN_PLACE||!1,fe=e.ALLOWED_URI_REGEXP||q,Ge=e.NAMESPACE||He,ve=e.CUSTOM_ELEMENT_HANDLING||{},e.CUSTOM_ELEMENT_HANDLING&&tt(e.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(ve.tagNameCheck=e.CUSTOM_ELEMENT_HANDLING.tagNameCheck),e.CUSTOM_ELEMENT_HANDLING&&tt(e.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(ve.attributeNameCheck=e.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),e.CUSTOM_ELEMENT_HANDLING&&"boolean"==typeof e.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements&&(ve.allowCustomizedBuiltInElements=e.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),Se&&(Te=!1),De&&(Ne=!0),Me&&(pe=b({},O),ge=[],!0===Me.html&&(b(pe,A),b(ge,P)),!0===Me.svg&&(b(pe,k),b(ge,x),b(ge,U)),!0===Me.svgFilters&&(b(pe,N),b(ge,x),b(ge,U)),!0===Me.mathMl&&(b(pe,R),b(ge,M),b(ge,U))),e.ADD_TAGS&&(pe===me&&(pe=S(pe)),b(pe,e.ADD_TAGS,Je)),e.ADD_ATTR&&(ge===ye&&(ge=S(ge)),b(ge,e.ADD_ATTR,Je)),e.ADD_URI_SAFE_ATTR&&b(je,e.ADD_URI_SAFE_ATTR,Je),e.FORBID_CONTENTS&&(Ue===Fe&&(Ue=S(Ue)),b(Ue,e.FORBID_CONTENTS,Je)),Pe&&(pe["#text"]=!0),Ce&&b(pe,["html","head","body"]),pe.table&&(b(pe,["tbody"]),delete we.tbody),e.TRUSTED_TYPES_POLICY){if("function"!=typeof e.TRUSTED_TYPES_POLICY.createHTML)throw E('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if("function"!=typeof e.TRUSTED_TYPES_POLICY.createScriptURL)throw E('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');J=e.TRUSTED_TYPES_POLICY,Z=J.createHTML("")}else void 0===J&&(J=function(e,t){if("object"!=typeof e||"function"!=typeof e.createPolicy)return null;let n=null;const r="data-tt-policy-suffix";t&&t.hasAttribute(r)&&(n=t.getAttribute(r));const i="dompurify"+(n?"#"+n:"");try{return e.createPolicy(i,{createHTML:e=>e,createScriptURL:e=>e})}catch(e){return console.warn("TrustedTypes policy "+i+" could not be created."),null}}(z,c)),null!==J&&"string"==typeof Z&&(Z=J.createHTML(""));s&&s(e),Ze=e}},rt=b({},["mi","mo","mn","ms","mtext"]),it=b({},["foreignobject","desc","title","annotation-xml"]),st=b({},["title","style","font","a","script"]),ot=b({},[...k,...N,...D]),at=b({},[...R,...L]),ct=function(e){d(r.removed,{element:e});try{e.parentNode.removeChild(e)}catch(t){e.remove()}},ut=function(e,t){try{d(r.removed,{attribute:t.getAttributeNode(e),from:t})}catch(e){d(r.removed,{attribute:null,from:t})}if(t.removeAttribute(e),"is"===e&&!ge[e])if(Ne||De)try{ct(t)}catch(e){}else try{t.setAttribute(e,"")}catch(e){}},lt=function(e){let t=null,n=null;if(ke)e="<remove></remove>"+e;else{const t=m(e,/^[\r\n\t ]+/);n=t&&t[0]}"application/xhtml+xml"===Xe&&Ge===He&&(e='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+e+"</body></html>");const r=J?J.createHTML(e):e;if(Ge===He)try{t=(new j).parseFromString(r,Xe)}catch(e){}if(!t||!t.documentElement){t=ee.createDocument(Ge,"template",null);try{t.documentElement.innerHTML=Ke?Z:r}catch(e){}}const s=t.body||t.documentElement;return e&&n&&s.insertBefore(i.createTextNode(n),s.childNodes[0]||null),Ge===He?re.call(t,Ce?"html":"body")[0]:Ce?t.documentElement:s},ht=function(e){return te.call(e.ownerDocument||e,e,F.SHOW_ELEMENT|F.SHOW_COMMENT|F.SHOW_TEXT,null)},dt=function(e){return"function"==typeof T&&e instanceof T},ft=function(e,t,n){se[e]&&l(se[e],(e=>{e.call(r,t,n,Ze)}))},pt=function(e){let t=null;if(ft("beforeSanitizeElements",e,null),(n=e)instanceof B&&("string"!=typeof n.nodeName||"string"!=typeof n.textContent||"function"!=typeof n.removeChild||!(n.attributes instanceof V)||"function"!=typeof n.removeAttribute||"function"!=typeof n.setAttribute||"string"!=typeof n.namespaceURI||"function"!=typeof n.insertBefore||"function"!=typeof n.hasChildNodes))return ct(e),!0;var n;const i=Je(e.nodeName);if(ft("uponSanitizeElement",e,{tagName:i,allowedTags:pe}),e.hasChildNodes()&&!dt(e.firstElementChild)&&w(/<[/\w]/g,e.innerHTML)&&w(/<[/\w]/g,e.textContent))return ct(e),!0;if(!pe[i]||we[i]){if(!we[i]&&gt(i)){if(ve.tagNameCheck instanceof RegExp&&w(ve.tagNameCheck,i))return!1;if(ve.tagNameCheck instanceof Function&&ve.tagNameCheck(i))return!1}if(Pe&&!Ue[i]){const t=Y(e)||e.parentNode,n=X(e)||e.childNodes;if(n&&t)for(let r=n.length-1;r>=0;--r)t.insertBefore(H(n[r],!0),Q(e))}return ct(e),!0}return e instanceof I&&!function(e){let t=Y(e);t&&t.tagName||(t={namespaceURI:Ge,tagName:"template"});const n=f(e.tagName),r=f(t.tagName);return!!We[e.namespaceURI]&&(e.namespaceURI===$e?t.namespaceURI===He?"svg"===n:t.namespaceURI===qe?"svg"===n&&("annotation-xml"===r||rt[r]):Boolean(ot[n]):e.namespaceURI===qe?t.namespaceURI===He?"math"===n:t.namespaceURI===$e?"math"===n&&it[r]:Boolean(at[n]):e.namespaceURI===He?!(t.namespaceURI===$e&&!it[r])&&!(t.namespaceURI===qe&&!rt[r])&&!at[n]&&(st[n]||!ot[n]):!("application/xhtml+xml"!==Xe||!We[e.namespaceURI]))}(e)?(ct(e),!0):"noscript"!==i&&"noembed"!==i&&"noframes"!==i||!w(/<\/no(script|embed|frames)/i,e.innerHTML)?(Se&&3===e.nodeType&&(t=e.textContent,l([oe,ae,ce],(e=>{t=g(t,e," ")})),e.textContent!==t&&(d(r.removed,{element:e.cloneNode()}),e.textContent=t)),ft("afterSanitizeElements",e,null),!1):(ct(e),!0)},mt=function(e,t,n){if(Le&&("id"===t||"name"===t)&&(n in i||n in et))return!1;if(Te&&!Ee[t]&&w(ue,t));else if(_e&&w(le,t));else if(!ge[t]||Ee[t]){if(!(gt(e)&&(ve.tagNameCheck instanceof RegExp&&w(ve.tagNameCheck,e)||ve.tagNameCheck instanceof Function&&ve.tagNameCheck(e))&&(ve.attributeNameCheck instanceof RegExp&&w(ve.attributeNameCheck,t)||ve.attributeNameCheck instanceof Function&&ve.attributeNameCheck(t))||"is"===t&&ve.allowCustomizedBuiltInElements&&(ve.tagNameCheck instanceof RegExp&&w(ve.tagNameCheck,n)||ve.tagNameCheck instanceof Function&&ve.tagNameCheck(n))))return!1}else if(je[t]);else if(w(fe,g(n,de,"")));else if("src"!==t&&"xlink:href"!==t&&"href"!==t||"script"===e||0!==y(n,"data:")||!Ve[e])if(be&&!w(he,g(n,de,"")));else if(n)return!1;return!0},gt=function(e){return e.indexOf("-")>0},yt=function(e){ft("beforeSanitizeAttributes",e,null);const{attributes:t}=e;if(!t)return;const n={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:ge};let i=t.length;for(;i--;){const s=t[i],{name:o,namespaceURI:a,value:c}=s,u=Je(o);let d="value"===o?c:v(c);if(n.attrName=u,n.attrValue=d,n.keepAttr=!0,n.forceKeepAttr=void 0,ft("uponSanitizeAttribute",e,n),d=n.attrValue,n.forceKeepAttr)continue;if(ut(o,e),!n.keepAttr)continue;if(!Ie&&w(/\/>/i,d)){ut(o,e);continue}Se&&l([oe,ae,ce],(e=>{d=g(d,e," ")}));const f=Je(e.nodeName);if(mt(f,u,d)){if(!Oe||"id"!==u&&"name"!==u||(ut(o,e),d="user-content-"+d),J&&"object"==typeof z&&"function"==typeof z.getAttributeType)if(a);else switch(z.getAttributeType(f,u)){case"TrustedHTML":d=J.createHTML(d);break;case"TrustedScriptURL":d=J.createScriptURL(d)}try{a?e.setAttributeNS(a,o,d):e.setAttribute(o,d),h(r.removed)}catch(e){}}}ft("afterSanitizeAttributes",e,null)},vt=function e(t){let n=null;const r=ht(t);for(ft("beforeSanitizeShadowDOM",t,null);n=r.nextNode();)ft("uponSanitizeShadowNode",n,null),pt(n)||(n.content instanceof u&&e(n.content),yt(n));ft("afterSanitizeShadowDOM",t,null)};return r.sanitize=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=null,i=null,s=null,a=null;if(Ke=!e,Ke&&(e="\x3c!--\x3e"),"string"!=typeof e&&!dt(e)){if("function"!=typeof e.toString)throw E("toString is not a function");if("string"!=typeof(e=e.toString()))throw E("dirty is not a string, aborting")}if(!r.isSupported)return e;if(Ae||nt(t),r.removed=[],"string"==typeof e&&(xe=!1),xe){if(e.nodeName){const t=Je(e.nodeName);if(!pe[t]||we[t])throw E("root node is forbidden and cannot be sanitized in-place")}}else if(e instanceof T)n=lt("\x3c!----\x3e"),i=n.ownerDocument.importNode(e,!0),1===i.nodeType&&"BODY"===i.nodeName||"HTML"===i.nodeName?n=i:n.appendChild(i);else{if(!Ne&&!Se&&!Ce&&-1===e.indexOf("<"))return J&&Re?J.createHTML(e):e;if(n=lt(e),!n)return Ne?null:Re?Z:""}n&&ke&&ct(n.firstChild);const c=ht(xe?e:n);for(;s=c.nextNode();)pt(s)||(s.content instanceof u&&vt(s.content),yt(s));if(xe)return e;if(Ne){if(De)for(a=ne.call(n.ownerDocument);n.firstChild;)a.appendChild(n.firstChild);else a=n;return(ge.shadowroot||ge.shadowrootmode)&&(a=ie.call(o,a,!0)),a}let h=Ce?n.outerHTML:n.innerHTML;return Ce&&pe["!doctype"]&&n.ownerDocument&&n.ownerDocument.doctype&&n.ownerDocument.doctype.name&&w(G,n.ownerDocument.doctype.name)&&(h="<!DOCTYPE "+n.ownerDocument.doctype.name+">\n"+h),Se&&l([oe,ae,ce],(e=>{h=g(h,e," ")})),J&&Re?J.createHTML(h):h},r.setConfig=function(){nt(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}),Ae=!0},r.clearConfig=function(){Ze=null,Ae=!1},r.isValidAttribute=function(e,t,n){Ze||nt({});const r=Je(e),i=Je(t);return mt(r,i,n)},r.addHook=function(e,t){"function"==typeof t&&(se[e]=se[e]||[],d(se[e],t))},r.removeHook=function(e){if(se[e])return h(se[e])},r.removeHooks=function(e){se[e]&&(se[e]=[])},r.removeAllHooks=function(){se={}},r}()}()}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var s=t[r]={exports:{}};return e[r].call(s.exports,s,s.exports,n),s.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";const e=function(e){const t=[];let n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=63&i|128):55296==(64512&i)&&r+1<e.length&&56320==(64512&e.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++r)),t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=63&i|128):(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=63&i|128)}return t},t={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let t=0;t<e.length;t+=3){const i=e[t],s=t+1<e.length,o=s?e[t+1]:0,a=t+2<e.length,c=a?e[t+2]:0,u=i>>2,l=(3&i)<<4|o>>4;let h=(15&o)<<2|c>>6,d=63&c;a||(d=64,s||(h=64)),r.push(n[u],n[l],n[h],n[d])}return r.join("")},encodeString(t,n){return this.HAS_NATIVE_SUPPORT&&!n?btoa(t):this.encodeByteArray(e(t),n)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,r=0;for(;n<e.length;){const i=e[n++];if(i<128)t[r++]=String.fromCharCode(i);else if(i>191&&i<224){const s=e[n++];t[r++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){const s=((7&i)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[r++]=String.fromCharCode(55296+(s>>10)),t[r++]=String.fromCharCode(56320+(1023&s))}else{const s=e[n++],o=e[n++];t[r++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&o)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const n=t?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let t=0;t<e.length;){const s=n[e.charAt(t++)],o=t<e.length?n[e.charAt(t)]:0;++t;const a=t<e.length?n[e.charAt(t)]:64;++t;const c=t<e.length?n[e.charAt(t)]:64;if(++t,null==s||null==o||null==a||null==c)throw new r;const u=s<<2|o>>4;if(i.push(u),64!==a){const e=o<<4&240|a>>2;if(i.push(e),64!==c){const e=a<<6&192|c;i.push(e)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class r extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const i=function(n){return function(n){const r=e(n);return t.encodeByteArray(r,!0)}(n).replace(/\./g,"")},s=function(e){try{return t.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null},o=()=>{try{return function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==n.g)return n.g;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__||(()=>{if("undefined"==typeof process||void 0===process.env)return;const e=process.env.__FIREBASE_DEFAULTS__;return e?JSON.parse(e):void 0})()||(()=>{if("undefined"==typeof document)return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}const t=e&&s(e[1]);return t&&JSON.parse(t)})()}catch(e){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`)}},a=e=>{var t,n;return null===(n=null===(t=o())||void 0===t?void 0:t.emulatorHosts)||void 0===n?void 0:n[e]},c=e=>{const t=a(e);if(!t)return;const n=t.lastIndexOf(":");if(n<=0||n+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const r=parseInt(t.substring(n+1),10);return"["===t[0]?[t.substring(1,n-1),r]:[t.substring(0,n),r]},u=()=>{var e;return null===(e=o())||void 0===e?void 0:e.config};class l{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"==typeof e&&(this.promise.catch((()=>{})),1===e.length?e(t):e(t,n))}}}function h(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function d(){try{return"object"==typeof indexedDB}catch(e){return!1}}class f extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,f.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,p.prototype.create)}}class p{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){const n=t[0]||{},r=`${this.service}/${e}`,i=this.errors[e],s=i?function(e,t){return e.replace(m,((e,n)=>{const r=t[n];return null!=r?String(r):`<${n}?>`}))}(i,n):"Error",o=`${this.serviceName}: ${s} (${r}).`;return new f(r,o,n)}}const m=/\{\$([^}]+)}/g;function g(e,t){if(e===t)return!0;const n=Object.keys(e),r=Object.keys(t);for(const i of n){if(!r.includes(i))return!1;const n=e[i],s=t[i];if(y(n)&&y(s)){if(!g(n,s))return!1}else if(n!==s)return!1}for(const e of r)if(!n.includes(e))return!1;return!0}function y(e){return null!==e&&"object"==typeof e}function v(e){const t=[];for(const[n,r]of Object.entries(e))Array.isArray(r)?r.forEach((e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))})):t.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return t.length?"&"+t.join("&"):""}function w(e){const t={};return e.replace(/^\?/,"").split("&").forEach((e=>{if(e){const[n,r]=e.split("=");t[decodeURIComponent(n)]=decodeURIComponent(r)}})),t}function E(e){const t=e.indexOf("?");if(!t)return"";const n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)}class _{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then((()=>{e(this)})).catch((e=>{this.error(e)}))}next(e){this.forEachObserver((t=>{t.next(e)}))}error(e){this.forEachObserver((t=>{t.error(e)})),this.close(e)}complete(){this.forEachObserver((e=>{e.complete()})),this.close()}subscribe(e,t,n){let r;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");r=function(e,t){if("object"!=typeof e||null===e)return!1;for(const t of["next","error","complete"])if(t in e&&"function"==typeof e[t])return!0;return!1}(e)?e:{next:e,error:t,complete:n},void 0===r.next&&(r.next=T),void 0===r.error&&(r.error=T),void 0===r.complete&&(r.complete=T);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then((()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch(e){}})),this.observers.push(r),i}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then((()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}}))}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then((()=>{this.observers=void 0,this.onNoObservers=void 0})))}}function T(){}function b(e){return e&&e._delegate?e._delegate:e}class I{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const S="[DEFAULT]";class C{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new l;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const n=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),r=null!==(t=null==e?void 0:e.optional)&&void 0!==t&&t;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(r)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(e){if(r)return null;throw e}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:S})}catch(e){}for(const[e,t]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:n});t.resolve(e)}catch(e){}}}}clearInstance(e=S){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter((e=>"INTERNAL"in e)).map((e=>e.INTERNAL.delete())),...e.filter((e=>"_delete"in e)).map((e=>e._delete()))])}isComponentSet(){return null!=this.component}isInitialized(e=S){return this.instances.has(e)}getOptions(e=S){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[e,t]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(e)&&t.resolve(r);return r}onInit(e,t){var n;const r=this.normalizeInstanceIdentifier(t),i=null!==(n=this.onInitCallbacks.get(r))&&void 0!==n?n:new Set;i.add(e),this.onInitCallbacks.set(r,i);const s=this.instances.get(r);return s&&e(s,r),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const r of n)try{r(e,t)}catch(e){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(r=e,r===S?void 0:r),options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch(e){}var r;return n||null}normalizeInstanceIdentifier(e=S){return this.component?this.component.multipleInstances?e:S:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class A{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new C(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}const k=[];var N;!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(N||(N={}));const D={debug:N.DEBUG,verbose:N.VERBOSE,info:N.INFO,warn:N.WARN,error:N.ERROR,silent:N.SILENT},R=N.INFO,L={[N.DEBUG]:"log",[N.VERBOSE]:"log",[N.INFO]:"info",[N.WARN]:"warn",[N.ERROR]:"error"},O=(e,t,...n)=>{if(t<e.logLevel)return;const r=(new Date).toISOString(),i=L[t];if(!i)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);console[i](`[${r}]  ${e.name}:`,...n)};class P{constructor(e){this.name=e,this._logLevel=R,this._logHandler=O,this._userLogHandler=null,k.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in N))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?D[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,N.DEBUG,...e),this._logHandler(this,N.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,N.VERBOSE,...e),this._logHandler(this,N.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,N.INFO,...e),this._logHandler(this,N.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,N.WARN,...e),this._logHandler(this,N.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,N.ERROR,...e),this._logHandler(this,N.ERROR,...e)}}const x=(e,t)=>t.some((t=>e instanceof t));let M,U;const F=new WeakMap,V=new WeakMap,B=new WeakMap,j=new WeakMap,z=new WeakMap;let q={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return V.get(e);if("objectStoreNames"===t)return e.objectStoreNames||B.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return H(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function $(e){return"function"==typeof e?(t=e)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(U||(U=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(...e){return t.apply(G(this),e),H(F.get(this))}:function(...e){return H(t.apply(G(this),e))}:function(e,...n){const r=t.call(G(this),e,...n);return B.set(r,e.sort?e.sort():[e]),H(r)}:(e instanceof IDBTransaction&&function(e){if(V.has(e))return;const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",s),e.removeEventListener("abort",s)},i=()=>{t(),r()},s=()=>{n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",i),e.addEventListener("error",s),e.addEventListener("abort",s)}));V.set(e,t)}(e),x(e,M||(M=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(e,q):e);var t}function H(e){if(e instanceof IDBRequest)return function(e){const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("success",i),e.removeEventListener("error",s)},i=()=>{t(H(e.result)),r()},s=()=>{n(e.error),r()};e.addEventListener("success",i),e.addEventListener("error",s)}));return t.then((t=>{t instanceof IDBCursor&&F.set(t,e)})).catch((()=>{})),z.set(t,e),t}(e);if(j.has(e))return j.get(e);const t=$(e);return t!==e&&(j.set(e,t),z.set(t,e)),t}const G=e=>z.get(e),K=["get","getKey","getAll","getAllKeys","count"],W=["put","add","delete","clear"],Q=new Map;function X(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(Q.get(t))return Q.get(t);const n=t.replace(/FromIndex$/,""),r=t!==n,i=W.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!i&&!K.includes(n))return;const s=async function(e,...t){const s=this.transaction(e,i?"readwrite":"readonly");let o=s.store;return r&&(o=o.index(t.shift())),(await Promise.all([o[n](...t),i&&s.done]))[0]};return Q.set(t,s),s}var Y;Y=q,q={...Y,get:(e,t,n)=>X(e,t)||Y.get(e,t,n),has:(e,t)=>!!X(e,t)||Y.has(e,t)};class J{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map((e=>{if(function(e){const t=e.getComponent();return"VERSION"===(null==t?void 0:t.type)}(e)){const t=e.getImmediate();return`${t.library}/${t.version}`}return null})).filter((e=>e)).join(" ")}}const Z="@firebase/app",ee="0.9.27",te=new P("@firebase/app"),ne="[DEFAULT]",re={[Z]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","fire-js":"fire-js",firebase:"fire-js-all"},ie=new Map,se=new Map;function oe(e,t){try{e.container.addComponent(t)}catch(n){te.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function ae(e){const t=e.name;if(se.has(t))return te.debug(`There were multiple attempts to register component ${t}.`),!1;se.set(t,e);for(const t of ie.values())oe(t,e);return!0}function ce(e,t){const n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}const ue=new p("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."});class le{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new I("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw ue.create("app-deleted",{appName:this._name})}}const he="10.8.0";function de(e,t={}){let n=e;"object"!=typeof t&&(t={name:t});const r=Object.assign({name:ne,automaticDataCollectionEnabled:!1},t),i=r.name;if("string"!=typeof i||!i)throw ue.create("bad-app-name",{appName:String(i)});if(n||(n=u()),!n)throw ue.create("no-options");const s=ie.get(i);if(s){if(g(n,s.options)&&g(r,s.config))return s;throw ue.create("duplicate-app",{appName:i})}const o=new A(i);for(const e of se.values())o.addComponent(e);const a=new le(n,r,o);return ie.set(i,a),a}function fe(e=ne){const t=ie.get(e);if(!t&&e===ne&&u())return de();if(!t)throw ue.create("no-app",{appName:e});return t}function pe(e,t,n){var r;let i=null!==(r=re[e])&&void 0!==r?r:e;n&&(i+=`-${n}`);const s=i.match(/\s|\//),o=t.match(/\s|\//);if(s||o){const e=[`Unable to register library "${i}" with version "${t}":`];return s&&e.push(`library name "${i}" contains illegal characters (whitespace or "/")`),s&&o&&e.push("and"),o&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),void te.warn(e.join(" "))}ae(new I(`${i}-version`,(()=>({library:i,version:t})),"VERSION"))}const me="firebase-heartbeat-database",ge=1,ye="firebase-heartbeat-store";let ve=null;function we(){return ve||(ve=function(e,t,{blocked:n,upgrade:r,blocking:i,terminated:s}={}){const o=indexedDB.open(e,t),a=H(o);return r&&o.addEventListener("upgradeneeded",(e=>{r(H(o.result),e.oldVersion,e.newVersion,H(o.transaction),e)})),n&&o.addEventListener("blocked",(e=>n(e.oldVersion,e.newVersion,e))),a.then((e=>{s&&e.addEventListener("close",(()=>s())),i&&e.addEventListener("versionchange",(e=>i(e.oldVersion,e.newVersion,e)))})).catch((()=>{})),a}(me,ge,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(ye)}catch(e){console.warn(e)}}}).catch((e=>{throw ue.create("idb-open",{originalErrorMessage:e.message})}))),ve}async function Ee(e,t){try{const n=(await we()).transaction(ye,"readwrite"),r=n.objectStore(ye);await r.put(t,_e(e)),await n.done}catch(e){if(e instanceof f)te.warn(e.message);else{const t=ue.create("idb-set",{originalErrorMessage:null==e?void 0:e.message});te.warn(t.message)}}}function _e(e){return`${e.name}!${e.options.appId}`}class Te{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new Ie(t),this._heartbeatsCachePromise=this._storage.read().then((e=>(this._heartbeatsCache=e,e)))}async triggerHeartbeat(){var e,t;const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=be();if((null!=(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)||(this._heartbeatsCache=await this._heartbeatsCachePromise,null!=(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)))&&this._heartbeatsCache.lastSentHeartbeatDate!==r&&!this._heartbeatsCache.heartbeats.some((e=>e.date===r)))return this._heartbeatsCache.heartbeats.push({date:r,agent:n}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter((e=>{const t=new Date(e.date).valueOf();return Date.now()-t<=2592e6})),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){var e;if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null==(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)||0===this._heartbeatsCache.heartbeats.length)return"";const t=be(),{heartbeatsToSend:n,unsentEntries:r}=function(e,t=1024){const n=[];let r=e.slice();for(const i of e){const e=n.find((e=>e.agent===i.agent));if(e){if(e.dates.push(i.date),Se(n)>t){e.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),Se(n)>t){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}(this._heartbeatsCache.heartbeats),s=i(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=t,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}}function be(){return(new Date).toISOString().substring(0,10)}class Ie{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!d()&&new Promise(((e,t)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),e(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{var e;t((null===(e=i.error)||void 0===e?void 0:e.message)||"")}}catch(e){t(e)}})).then((()=>!0)).catch((()=>!1))}async read(){if(await this._canUseIndexedDBPromise){const e=await async function(e){try{const t=(await we()).transaction(ye),n=await t.objectStore(ye).get(_e(e));return await t.done,n}catch(e){if(e instanceof f)te.warn(e.message);else{const t=ue.create("idb-get",{originalErrorMessage:null==e?void 0:e.message});te.warn(t.message)}}}(this.app);return(null==e?void 0:e.heartbeats)?e:{heartbeats:[]}}return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return Ee(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return Ee(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}}}function Se(e){return i(JSON.stringify({version:2,heartbeats:e})).length}function Ce(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}ae(new I("platform-logger",(e=>new J(e)),"PRIVATE")),ae(new I("heartbeat",(e=>new Te(e)),"PRIVATE")),pe(Z,ee,""),pe(Z,ee,"esm2017"),pe("fire-js",""),Object.create,Object.create,"function"==typeof SuppressedError&&SuppressedError;const Ae=function(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}},ke=new p("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),Ne=new P("@firebase/auth");function De(e,...t){Ne.logLevel<=N.ERROR&&Ne.error(`Auth (${he}): ${e}`,...t)}function Re(e,...t){throw Oe(e,...t)}function Le(e,...t){return Oe(e,...t)}function Oe(e,...t){if("string"!=typeof e){const n=t[0],r=[...t.slice(1)];return r[0]&&(r[0].appName=e.name),e._errorFactory.create(n,...r)}return ke.create(e,...t)}function Pe(e,t,...n){if(!e)throw Oe(t,...n)}function xe(e){const t="INTERNAL ASSERTION FAILED: "+e;throw De(t),new Error(t)}function Me(e,t){e||xe(t)}function Ue(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.protocol)||null}function Fe(){return!("undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&("http:"===Ue()||"https:"===Ue()||function(){const e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}()||"connection"in navigator))||navigator.onLine}class Ve{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:"undefined"!=typeof globalThis&&globalThis.fetch?globalThis.fetch:"undefined"!=typeof fetch?fetch:void xe("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:"undefined"!=typeof globalThis&&globalThis.Headers?globalThis.Headers:"undefined"!=typeof Headers?Headers:void xe("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:"undefined"!=typeof globalThis&&globalThis.Response?globalThis.Response:"undefined"!=typeof Response?Response:void xe("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const Be={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},je=new class{constructor(e,t){this.shortDelay=e,this.longDelay=t,Me(t>e,"Short delay should be less than long delay!"),this.isMobile="undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(h())||"object"==typeof navigator&&"ReactNative"===navigator.product}get(){return Fe()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}(3e4,6e4);function ze(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function qe(e,t,n,r,i={}){return $e(e,i,(async()=>{let i={},s={};r&&("GET"===t?s=r:i={body:JSON.stringify(r)});const o=v(Object.assign({key:e.config.apiKey},s)).slice(1),a=await e._getAdditionalHeaders();return a["Content-Type"]="application/json",e.languageCode&&(a["X-Firebase-Locale"]=e.languageCode),Ve.fetch()(Ge(e,e.config.apiHost,n,o),Object.assign({method:t,headers:a,referrerPolicy:"no-referrer"},i))}))}async function $e(e,t,n){e._canInitEmulator=!1;const r=Object.assign(Object.assign({},Be),t);try{const t=new We(e),i=await Promise.race([n(),t.promise]);t.clearNetworkTimeout();const s=await i.json();if("needConfirmation"in s)throw Qe(e,"account-exists-with-different-credential",s);if(i.ok&&!("errorMessage"in s))return s;{const t=i.ok?s.errorMessage:s.error.message,[n,o]=t.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===n)throw Qe(e,"credential-already-in-use",s);if("EMAIL_EXISTS"===n)throw Qe(e,"email-already-in-use",s);if("USER_DISABLED"===n)throw Qe(e,"user-disabled",s);const a=r[n]||n.toLowerCase().replace(/[_\s]+/g,"-");if(o)throw function(e,t,n){const r=Object.assign(Object.assign({},Ae()),{[t]:n});return new p("auth","Firebase",r).create(t,{appName:e.name})}(e,a,o);Re(e,a)}}catch(t){if(t instanceof f)throw t;Re(e,"network-request-failed",{message:String(t)})}}async function He(e,t,n,r,i={}){const s=await qe(e,t,n,r,i);return"mfaPendingCredential"in s&&Re(e,"multi-factor-auth-required",{_serverResponse:s}),s}function Ge(e,t,n,r){const i=`${t}${n}?${r}`;return e.config.emulator?function(e,t){Me(e.emulator,"Emulator should always be set here");const{url:n}=e.emulator;return t?`${n}${t.startsWith("/")?t.slice(1):t}`:n}(e.config,i):`${e.config.apiScheme}://${i}`}function Ke(e){switch(e){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class We{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise(((e,t)=>{this.timer=setTimeout((()=>t(Le(this.auth,"network-request-failed"))),je.get())}))}clearNetworkTimeout(){clearTimeout(this.timer)}}function Qe(e,t,n){const r={appName:e.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const i=Le(e,t,r);return i.customData._tokenResponse=n,i}function Xe(e){return void 0!==e&&void 0!==e.enterprise}class Ye{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],void 0===e.recaptchaKey)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||0===this.recaptchaEnforcementState.length)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return Ke(t.enforcementState);return null}isProviderEnabled(e){return"ENFORCE"===this.getProviderEnforcementState(e)||"AUDIT"===this.getProviderEnforcementState(e)}}function Je(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(e){}}function Ze(e){return 1e3*Number(e)}function et(e){const[t,n,r]=e.split(".");if(void 0===t||void 0===n||void 0===r)return De("JWT malformed, contained fewer than 3 sections"),null;try{const e=s(n);return e?JSON.parse(e):(De("Failed to decode base64 JWT payload"),null)}catch(e){return De("Caught error parsing JWT payload as JSON",null==e?void 0:e.toString()),null}}async function tt(e,t,n=!1){if(n)return t;try{return await t}catch(t){throw t instanceof f&&function({code:e}){return"auth/user-disabled"===e||"auth/user-token-expired"===e}(t)&&e.auth.currentUser===e&&await e.auth.signOut(),t}}class nt{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}{this.errorBackoff=3e4;const e=(null!==(t=this.user.stsTokenManager.expirationTime)&&void 0!==t?t:0)-Date.now()-3e5;return Math.max(0,e)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout((async()=>{await this.iteration()}),t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){return void("auth/network-request-failed"===(null==e?void 0:e.code)&&this.schedule(!0))}this.schedule()}}class rt{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Je(this.lastLoginAt),this.creationTime=Je(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function it(e){var t;const n=e.auth,r=await e.getIdToken(),i=await tt(e,async function(e,t){return qe(e,"POST","/v1/accounts:lookup",t)}(n,{idToken:r}));Pe(null==i?void 0:i.users.length,n,"internal-error");const s=i.users[0];e._notifyReloadListener(s);const o=(null===(t=s.providerUserInfo)||void 0===t?void 0:t.length)?s.providerUserInfo.map((e=>{var{providerId:t}=e,n=Ce(e,["providerId"]);return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}})):[],a=(c=e.providerData,u=o,[...c.filter((e=>!u.some((t=>t.providerId===e.providerId)))),...u]);var c,u;const l=e.isAnonymous,h=!(e.email&&s.passwordHash||(null==a?void 0:a.length)),d=!!l&&h,f={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:a,metadata:new rt(s.createdAt,s.lastLoginAt),isAnonymous:d};Object.assign(e,f)}class st{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Pe(e.idToken,"internal-error"),Pe(void 0!==e.idToken,"internal-error"),Pe(void 0!==e.refreshToken,"internal-error");const t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):function(e){const t=et(e);return Pe(t,"internal-error"),Pe(void 0!==t.exp,"internal-error"),Pe(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}async getToken(e,t=!1){return Pe(!this.accessToken||this.refreshToken,e,"user-token-expired"),t||!this.accessToken||this.isExpired?this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null:this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:n,refreshToken:r,expiresIn:i}=await async function(e,t){const n=await $e(e,{},(async()=>{const n=v({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:r,apiKey:i}=e.config,s=Ge(e,r,"/v1/token",`key=${i}`),o=await e._getAdditionalHeaders();return o["Content-Type"]="application/x-www-form-urlencoded",Ve.fetch()(s,{method:"POST",headers:o,body:n})}));return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}(e,t);this.updateTokensAndExpiration(n,r,Number(i))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){const{refreshToken:n,accessToken:r,expirationTime:i}=t,s=new st;return n&&(Pe("string"==typeof n,"internal-error",{appName:e}),s.refreshToken=n),r&&(Pe("string"==typeof r,"internal-error",{appName:e}),s.accessToken=r),i&&(Pe("number"==typeof i,"internal-error",{appName:e}),s.expirationTime=i),s}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new st,this.toJSON())}_performRefresh(){return xe("not implemented")}}function ot(e,t){Pe("string"==typeof e||void 0===e,"internal-error",{appName:t})}class at{constructor(e){var{uid:t,auth:n,stsTokenManager:r}=e,i=Ce(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new nt(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new rt(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const t=await tt(this,this.stsTokenManager.getToken(this.auth,e));return Pe(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return async function(e,t=!1){const n=b(e),r=await n.getIdToken(t),i=et(r);Pe(i&&i.exp&&i.auth_time&&i.iat,n.auth,"internal-error");const s="object"==typeof i.firebase?i.firebase:void 0,o=null==s?void 0:s.sign_in_provider;return{claims:i,token:r,authTime:Je(Ze(i.auth_time)),issuedAtTime:Je(Ze(i.iat)),expirationTime:Je(Ze(i.exp)),signInProvider:o||null,signInSecondFactor:(null==s?void 0:s.sign_in_second_factor)||null}}(this,e)}reload(){return async function(e){const t=b(e);await it(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}(this)}_assign(e){this!==e&&(Pe(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map((e=>Object.assign({},e))),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new at(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){Pe(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await it(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){const e=await this.getIdToken();return await tt(this,async function(e,t){return qe(e,"POST","/v1/accounts:delete",t)}(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map((e=>Object.assign({},e))),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n,r,i,s,o,a,c,u;const l=null!==(n=t.displayName)&&void 0!==n?n:void 0,h=null!==(r=t.email)&&void 0!==r?r:void 0,d=null!==(i=t.phoneNumber)&&void 0!==i?i:void 0,f=null!==(s=t.photoURL)&&void 0!==s?s:void 0,p=null!==(o=t.tenantId)&&void 0!==o?o:void 0,m=null!==(a=t._redirectEventId)&&void 0!==a?a:void 0,g=null!==(c=t.createdAt)&&void 0!==c?c:void 0,y=null!==(u=t.lastLoginAt)&&void 0!==u?u:void 0,{uid:v,emailVerified:w,isAnonymous:E,providerData:_,stsTokenManager:T}=t;Pe(v&&T,e,"internal-error");const b=st.fromJSON(this.name,T);Pe("string"==typeof v,e,"internal-error"),ot(l,e.name),ot(h,e.name),Pe("boolean"==typeof w,e,"internal-error"),Pe("boolean"==typeof E,e,"internal-error"),ot(d,e.name),ot(f,e.name),ot(p,e.name),ot(m,e.name),ot(g,e.name),ot(y,e.name);const I=new at({uid:v,auth:e,email:h,emailVerified:w,displayName:l,isAnonymous:E,photoURL:f,phoneNumber:d,tenantId:p,stsTokenManager:b,createdAt:g,lastLoginAt:y});return _&&Array.isArray(_)&&(I.providerData=_.map((e=>Object.assign({},e)))),m&&(I._redirectEventId=m),I}static async _fromIdTokenResponse(e,t,n=!1){const r=new st;r.updateFromServerResponse(t);const i=new at({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:n});return await it(i),i}}const ct=new Map;function ut(e){Me(e instanceof Function,"Expected a class definition");let t=ct.get(e);return t?(Me(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,ct.set(e,t),t)}class lt{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}lt.type="NONE";const ht=lt;function dt(e,t,n){return`firebase:${e}:${t}:${n}`}class ft{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:r,name:i}=this.auth;this.fullUserKey=dt(this.userKey,r.apiKey,i),this.fullPersistenceKey=dt("persistence",r.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?at._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=e,t?this.setCurrentUser(t):void 0}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,n="authUser"){if(!t.length)return new ft(ut(ht),e,n);const r=(await Promise.all(t.map((async e=>{if(await e._isAvailable())return e})))).filter((e=>e));let i=r[0]||ut(ht);const s=dt(n,e.config.apiKey,e.name);let o=null;for(const n of t)try{const t=await n._get(s);if(t){const r=at._fromJSON(e,t);n!==i&&(o=r),i=n;break}}catch(e){}const a=r.filter((e=>e._shouldAllowMigration));return i._shouldAllowMigration&&a.length?(i=a[0],o&&await i._set(s,o.toJSON()),await Promise.all(t.map((async e=>{if(e!==i)try{await e._remove(s)}catch(e){}}))),new ft(i,e,n)):new ft(i,e,n)}}function pt(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(function(e=h()){return/iemobile/i.test(e)}(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(function(e=h()){return/firefox\//i.test(e)}(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(function(e=h()){return/blackberry/i.test(e)}(t))return"Blackberry";if(function(e=h()){return/webos/i.test(e)}(t))return"Webos";if(function(e=h()){const t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}(t))return"Safari";if((t.includes("chrome/")||function(e=h()){return/crios\//i.test(e)}(t))&&!t.includes("edge/"))return"Chrome";if(function(e=h()){return/android/i.test(e)}(t))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=e.match(t);if(2===(null==n?void 0:n.length))return n[1]}return"Other"}function mt(e,t=[]){let n;switch(e){case"Browser":n=pt(h());break;case"Worker":n=`${pt(h())}-${e}`;break;default:n=e}const r=t.length?t.join(","):"FirebaseCore-web";return`${n}/JsCore/${he}/${r}`}class gt{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const n=t=>new Promise(((n,r)=>{try{n(e(t))}catch(e){r(e)}}));n.onAbort=t,this.queue.push(n);const r=this.queue.length-1;return()=>{this.queue[r]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(e){t.reverse();for(const e of t)try{e()}catch(e){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null==e?void 0:e.message})}}}class yt{constructor(e){var t,n,r,i;const s=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=null!==(t=s.minPasswordLength)&&void 0!==t?t:6,s.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=s.maxPasswordLength),void 0!==s.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=s.containsLowercaseCharacter),void 0!==s.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=s.containsUppercaseCharacter),void 0!==s.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=s.containsNumericCharacter),void 0!==s.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=s.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=null!==(r=null===(n=e.allowedNonAlphanumericCharacters)||void 0===n?void 0:n.join(""))&&void 0!==r?r:"",this.forceUpgradeOnSignin=null!==(i=e.forceUpgradeOnSignin)&&void 0!==i&&i,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,n,r,i,s,o;const a={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,a),this.validatePasswordCharacterOptions(e,a),a.isValid&&(a.isValid=null===(t=a.meetsMinPasswordLength)||void 0===t||t),a.isValid&&(a.isValid=null===(n=a.meetsMaxPasswordLength)||void 0===n||n),a.isValid&&(a.isValid=null===(r=a.containsLowercaseLetter)||void 0===r||r),a.isValid&&(a.isValid=null===(i=a.containsUppercaseLetter)||void 0===i||i),a.isValid&&(a.isValid=null===(s=a.containsNumericCharacter)||void 0===s||s),a.isValid&&(a.isValid=null===(o=a.containsNonAlphanumericCharacter)||void 0===o||o),a}validatePasswordLengthOptions(e,t){const n=this.customStrengthOptions.minPasswordLength,r=this.customStrengthOptions.maxPasswordLength;n&&(t.meetsMinPasswordLength=e.length>=n),r&&(t.meetsMaxPasswordLength=e.length<=r)}validatePasswordCharacterOptions(e,t){let n;this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);for(let r=0;r<e.length;r++)n=e.charAt(r),this.updatePasswordCharacterOptionsStatuses(t,n>="a"&&n<="z",n>="A"&&n<="Z",n>="0"&&n<="9",this.allowedNonAlphanumericCharacters.includes(n))}updatePasswordCharacterOptionsStatuses(e,t,n,r,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=n)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=r)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}class vt{constructor(e,t,n,r){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=n,this.config=r,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Et(this),this.idTokenSubscription=new Et(this),this.beforeStateQueue=new gt(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=ke,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=r.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=ut(t)),this._initializationPromise=this.queue((async()=>{var n,r;if(!this._deleted&&(this.persistenceManager=await ft.create(this,e),!this._deleted)){if(null===(n=this._popupRedirectResolver)||void 0===n?void 0:n._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(e){}await this.initializeCurrentUser(t),this.lastNotifiedUid=(null===(r=this.currentUser)||void 0===r?void 0:r.uid)||null,this._deleted||(this._isInitialized=!0)}})),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();return this.currentUser||e?this.currentUser&&e&&this.currentUser.uid===e.uid?(this._currentUser._assign(e),void await this.currentUser.getIdToken()):void await this._updateCurrentUser(e,!0):void 0}async initializeCurrentUser(e){var t;const n=await this.assertedPersistence.getCurrentUser();let r=n,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const n=null===(t=this.redirectUser)||void 0===t?void 0:t._redirectEventId,s=null==r?void 0:r._redirectEventId,o=await this.tryRedirectSignIn(e);n&&n!==s||!(null==o?void 0:o.user)||(r=o.user,i=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(r)}catch(e){r=n,this._popupRedirectResolver._overrideRedirectResult(this,(()=>Promise.reject(e)))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return Pe(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(e){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await it(e)}catch(e){if("auth/network-request-failed"!==(null==e?void 0:e.code))return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){const t=e?b(e):null;return t&&Pe(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&Pe(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue((async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()}))}async signOut(){return await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0)}setPersistence(e){return this.queue((async()=>{await this.assertedPersistence.setPersistence(ut(e))}))}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await async function(e,t={}){return qe(e,"GET","/v2/passwordPolicy",ze(e,t))}(this),t=new yt(e);null===this.tenantId?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new p("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}authStateReady(){return new Promise(((e,t)=>{if(this.currentUser)e();else{const n=this.onAuthStateChanged((()=>{n(),e()}),t)}}))}async revokeAccessToken(e){if(this.currentUser){const t={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:await this.currentUser.getIdToken()};null!=this.tenantId&&(t.tenantId=this.tenantId),await async function(e,t){return qe(e,"POST","/v2/accounts:revokeToken",ze(e,t))}(this,t)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(e=this._currentUser)||void 0===e?void 0:e.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&ut(e)||this._popupRedirectResolver;Pe(t,this,"argument-error"),this.redirectPersistenceManager=await ft.create(this,[ut(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,n;return this._isInitialized&&await this.queue((async()=>{})),(null===(t=this._currentUser)||void 0===t?void 0:t._redirectEventId)===e?this._currentUser:(null===(n=this.redirectUser)||void 0===n?void 0:n._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue((async()=>this.directlySetCurrentUser(e)))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=null!==(t=null===(e=this.currentUser)||void 0===e?void 0:e.uid)&&void 0!==t?t:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,r){if(this._deleted)return()=>{};const i="function"==typeof t?t:t.next.bind(t);let s=!1;const o=this._isInitialized?Promise.resolve():this._initializationPromise;if(Pe(o,this,"internal-error"),o.then((()=>{s||i(this.currentUser)})),"function"==typeof t){const i=e.addObserver(t,n,r);return()=>{s=!0,i()}}{const n=e.addObserver(t);return()=>{s=!0,n()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Pe(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){e&&!this.frameworks.includes(e)&&(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=mt(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const n=await(null===(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getHeartbeatsHeader());n&&(t["X-Firebase-Client"]=n);const r=await this._getAppCheckToken();return r&&(t["X-Firebase-AppCheck"]=r),t}async _getAppCheckToken(){var e;const t=await(null===(e=this.appCheckServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getToken());return(null==t?void 0:t.error)&&function(e,...t){Ne.logLevel<=N.WARN&&Ne.warn(`Auth (${he}): ${e}`,...t)}(`Error while retrieving App Check token: ${t.error}`),null==t?void 0:t.token}}function wt(e){return b(e)}class Et{constructor(e){this.auth=e,this.observer=null,this.addObserver=function(e,t){const n=new _(e,void 0);return n.subscribe.bind(n)}((e=>this.observer=e))}get next(){return Pe(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let _t={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};class Tt{constructor(e){this.type="recaptcha-enterprise",this.auth=wt(e)}async verify(e="verify",t=!1){function n(t,n,r){const i=window.grecaptcha;Xe(i)?i.enterprise.ready((()=>{i.enterprise.execute(t,{action:e}).then((e=>{n(e)})).catch((()=>{n("NO_RECAPTCHA")}))})):r(Error("No reCAPTCHA enterprise script loaded."))}return new Promise(((e,r)=>{(async function(e){if(!t){if(null==e.tenantId&&null!=e._agentRecaptchaConfig)return e._agentRecaptchaConfig.siteKey;if(null!=e.tenantId&&void 0!==e._tenantRecaptchaConfigs[e.tenantId])return e._tenantRecaptchaConfigs[e.tenantId].siteKey}return new Promise((async(t,n)=>{(async function(e,t){return qe(e,"GET","/v2/recaptchaConfig",ze(e,t))})(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then((r=>{if(void 0!==r.recaptchaKey){const n=new Ye(r);return null==e.tenantId?e._agentRecaptchaConfig=n:e._tenantRecaptchaConfigs[e.tenantId]=n,t(n.siteKey)}n(new Error("recaptcha Enterprise site key undefined"))})).catch((e=>{n(e)}))}))})(this.auth).then((i=>{if(!t&&Xe(window.grecaptcha))n(i,e,r);else{if("undefined"==typeof window)return void r(new Error("RecaptchaVerifier is only supported in browser"));let t=_t.recaptchaEnterpriseScript;0!==t.length&&(t+=i),function(e){return _t.loadJS(e)}(t).then((()=>{n(i,e,r)})).catch((e=>{r(e)}))}})).catch((e=>{r(e)}))}))}}async function bt(e,t,n,r=!1){const i=new Tt(e);let s;try{s=await i.verify(n)}catch(e){s=await i.verify(n,!0)}const o=Object.assign({},t);return r?Object.assign(o,{captchaResp:s}):Object.assign(o,{captchaResponse:s}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o}async function It(e,t,n,r){var i;if(null===(i=e._getRecaptchaConfig())||void 0===i?void 0:i.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const i=await bt(e,t,n,"getOobCode"===n);return r(e,i)}return r(e,t).catch((async i=>{if("auth/missing-recaptcha-token"===i.code){console.log(`${n} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const i=await bt(e,t,n,"getOobCode"===n);return r(e,i)}return Promise.reject(i)}))}function St(e){const t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function Ct(e){if(!e)return null;const t=Number(e);return isNaN(t)?null:t}class At{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return xe("not implemented")}_getIdTokenResponse(e){return xe("not implemented")}_linkToIdToken(e,t){return xe("not implemented")}_getReauthenticationResolver(e){return xe("not implemented")}}async function kt(e,t){return qe(e,"POST","/v1/accounts:signUp",t)}async function Nt(e,t){return He(e,"POST","/v1/accounts:signInWithPassword",ze(e,t))}class Dt extends At{constructor(e,t,n,r=null){super("password",n),this._email=e,this._password=t,this._tenantId=r}static _fromEmailAndPassword(e,t){return new Dt(e,t,"password")}static _fromEmailAndCode(e,t,n=null){return new Dt(e,t,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e;if((null==t?void 0:t.email)&&(null==t?void 0:t.password)){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return It(e,{returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signInWithPassword",Nt);case"emailLink":return async function(e,t){return He(e,"POST","/v1/accounts:signInWithEmailLink",ze(e,t))}(e,{email:this._email,oobCode:this._password});default:Re(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return It(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",kt);case"emailLink":return async function(e,t){return He(e,"POST","/v1/accounts:signInWithEmailLink",ze(e,t))}(e,{idToken:t,email:this._email,oobCode:this._password});default:Re(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function Rt(e,t){return He(e,"POST","/v1/accounts:signInWithIdp",ze(e,t))}class Lt extends At{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Lt(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Re("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e,{providerId:n,signInMethod:r}=t,i=Ce(t,["providerId","signInMethod"]);if(!n||!r)return null;const s=new Lt(n,r);return s.idToken=i.idToken||void 0,s.accessToken=i.accessToken||void 0,s.secret=i.secret,s.nonce=i.nonce,s.pendingToken=i.pendingToken||null,s}_getIdTokenResponse(e){return Rt(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,Rt(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Rt(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=v(t)}return e}}class Ot{constructor(e){var t,n,r,i,s,o;const a=w(E(e)),c=null!==(t=a.apiKey)&&void 0!==t?t:null,u=null!==(n=a.oobCode)&&void 0!==n?n:null,l=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(r=a.mode)&&void 0!==r?r:null);Pe(c&&u&&l,"argument-error"),this.apiKey=c,this.operation=l,this.code=u,this.continueUrl=null!==(i=a.continueUrl)&&void 0!==i?i:null,this.languageCode=null!==(s=a.languageCode)&&void 0!==s?s:null,this.tenantId=null!==(o=a.tenantId)&&void 0!==o?o:null}static parseLink(e){const t=function(e){const t=w(E(e)).link,n=t?w(E(t)).deep_link_id:null,r=w(E(e)).deep_link_id;return(r?w(E(r)).link:null)||r||n||t||e}(e);try{return new Ot(t)}catch(e){return null}}}class Pt{constructor(){this.providerId=Pt.PROVIDER_ID}static credential(e,t){return Dt._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const n=Ot.parseLink(t);return Pe(n,"argument-error"),Dt._fromEmailAndCode(e,n.code,n.tenantId)}}Pt.PROVIDER_ID="password",Pt.EMAIL_PASSWORD_SIGN_IN_METHOD="password",Pt.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class xt{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class Mt extends xt{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class Ut extends Mt{constructor(){super("facebook.com")}static credential(e){return Lt._fromParams({providerId:Ut.PROVIDER_ID,signInMethod:Ut.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Ut.credentialFromTaggedObject(e)}static credentialFromError(e){return Ut.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return Ut.credential(e.oauthAccessToken)}catch(e){return null}}}Ut.FACEBOOK_SIGN_IN_METHOD="facebook.com",Ut.PROVIDER_ID="facebook.com";class Ft extends Mt{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Lt._fromParams({providerId:Ft.PROVIDER_ID,signInMethod:Ft.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Ft.credentialFromTaggedObject(e)}static credentialFromError(e){return Ft.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:n}=e;if(!t&&!n)return null;try{return Ft.credential(t,n)}catch(e){return null}}}Ft.GOOGLE_SIGN_IN_METHOD="google.com",Ft.PROVIDER_ID="google.com";class Vt extends Mt{constructor(){super("github.com")}static credential(e){return Lt._fromParams({providerId:Vt.PROVIDER_ID,signInMethod:Vt.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Vt.credentialFromTaggedObject(e)}static credentialFromError(e){return Vt.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return Vt.credential(e.oauthAccessToken)}catch(e){return null}}}Vt.GITHUB_SIGN_IN_METHOD="github.com",Vt.PROVIDER_ID="github.com";class Bt extends Mt{constructor(){super("twitter.com")}static credential(e,t){return Lt._fromParams({providerId:Bt.PROVIDER_ID,signInMethod:Bt.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return Bt.credentialFromTaggedObject(e)}static credentialFromError(e){return Bt.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:n}=e;if(!t||!n)return null;try{return Bt.credential(t,n)}catch(e){return null}}}Bt.TWITTER_SIGN_IN_METHOD="twitter.com",Bt.PROVIDER_ID="twitter.com";class jt{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n,r=!1){const i=await at._fromIdTokenResponse(e,n,r),s=zt(n);return new jt({user:i,providerId:s,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);const r=zt(n);return new jt({user:e,providerId:r,_tokenResponse:n,operationType:t})}}function zt(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}new WeakMap;const qt="__sak";class $t{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find((t=>t.isListeningto(e)));if(t)return t;const n=new $t(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:r,data:i}=t.data,s=this.handlersMap[r];if(!(null==s?void 0:s.size))return;t.ports[0].postMessage({status:"ack",eventId:n,eventType:r});const o=Array.from(s).map((async e=>e(t.origin,i))),a=await function(e){return Promise.all(e.map((async e=>{try{return{fulfilled:!0,value:await e}}catch(e){return{fulfilled:!1,reason:e}}})))}(o);t.ports[0].postMessage({status:"done",eventId:n,eventType:r,response:a})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}$t.receivers=[];class Ht{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,n=50){const r="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!r)throw new Error("connection_unavailable");let i,s;return new Promise(((o,a)=>{const c=function(e="",t=10){let n="";for(let e=0;e<t;e++)n+=Math.floor(10*Math.random());return e+n}("",20);r.port1.start();const u=setTimeout((()=>{a(new Error("unsupported_event"))}),n);s={messageChannel:r,onMessage(e){const t=e;if(t.data.eventId===c)switch(t.data.status){case"ack":clearTimeout(u),i=setTimeout((()=>{a(new Error("timeout"))}),3e3);break;case"done":clearTimeout(i),o(t.data.response);break;default:clearTimeout(u),clearTimeout(i),a(new Error("invalid_response"))}}},this.handlers.add(s),r.port1.addEventListener("message",s.onMessage),this.target.postMessage({eventType:e,eventId:c,data:t},[r.port2])})).finally((()=>{s&&this.removeMessageHandler(s)}))}}function Gt(){return window}function Kt(){return void 0!==Gt().WorkerGlobalScope&&"function"==typeof Gt().importScripts}const Wt="firebaseLocalStorageDb",Qt="firebaseLocalStorage",Xt="fbase_key";class Yt{constructor(e){this.request=e}toPromise(){return new Promise(((e,t)=>{this.request.addEventListener("success",(()=>{e(this.request.result)})),this.request.addEventListener("error",(()=>{t(this.request.error)}))}))}}function Jt(e,t){return e.transaction([Qt],t?"readwrite":"readonly").objectStore(Qt)}function Zt(){const e=indexedDB.open(Wt,1);return new Promise(((t,n)=>{e.addEventListener("error",(()=>{n(e.error)})),e.addEventListener("upgradeneeded",(()=>{const t=e.result;try{t.createObjectStore(Qt,{keyPath:Xt})}catch(e){n(e)}})),e.addEventListener("success",(async()=>{const n=e.result;n.objectStoreNames.contains(Qt)?t(n):(n.close(),await function(){const e=indexedDB.deleteDatabase(Wt);return new Yt(e).toPromise()}(),t(await Zt()))}))}))}async function en(e,t,n){const r=Jt(e,!0).put({[Xt]:t,value:n});return new Yt(r).toPromise()}function tn(e,t){const n=Jt(e,!0).delete(t);return new Yt(n).toPromise()}class nn{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then((()=>{}),(()=>{}))}async _openDb(){return this.db||(this.db=await Zt()),this.db}async _withRetries(e){let t=0;for(;;)try{const t=await this._openDb();return await e(t)}catch(e){if(t++>3)throw e;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Kt()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=$t._getInstance(Kt()?self:null),this.receiver._subscribe("keyChanged",(async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)}))),this.receiver._subscribe("ping",(async(e,t)=>["keyChanged"]))}async initializeSender(){var e,t;if(this.activeServiceWorker=await async function(){if(!(null===navigator||void 0===navigator?void 0:navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch(e){return null}}(),!this.activeServiceWorker)return;this.sender=new Ht(this.activeServiceWorker);const n=await this.sender._send("ping",{},800);n&&(null===(e=n[0])||void 0===e?void 0:e.fulfilled)&&(null===(t=n[0])||void 0===t?void 0:t.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){var t;if(this.sender&&this.activeServiceWorker&&((null===(t=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)||void 0===t?void 0:t.controller)||null)===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch(t){}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Zt();return await en(e,qt,"1"),await tn(e,qt),!0}catch(e){}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite((async()=>(await this._withRetries((n=>en(n,e,t))),this.localCache[e]=t,this.notifyServiceWorker(e))))}async _get(e){const t=await this._withRetries((t=>async function(e,t){const n=Jt(e,!1).get(t),r=await new Yt(n).toPromise();return void 0===r?null:r.value}(t,e)));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite((async()=>(await this._withRetries((t=>tn(t,e))),delete this.localCache[e],this.notifyServiceWorker(e))))}async _poll(){const e=await this._withRetries((e=>{const t=Jt(e,!1).getAll();return new Yt(t).toPromise()}));if(!e)return[];if(0!==this.pendingWrites)return[];const t=[],n=new Set;if(0!==e.length)for(const{fbase_key:r,value:i}of e)n.add(r),JSON.stringify(this.localCache[r])!==JSON.stringify(i)&&(this.notifyListeners(r,i),t.push(r));for(const e of Object.keys(this.localCache))this.localCache[e]&&!n.has(e)&&(this.notifyListeners(e,null),t.push(e));return t}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const e of Array.from(n))e(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((async()=>this._poll()),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}nn.type="LOCAL";const rn=nn;var sn,on="@firebase/auth",an="1.6.0";class cn{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null===(e=this.auth.currentUser)||void 0===e?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged((t=>{e((null==t?void 0:t.stsTokenManager.accessToken)||null)}));this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){Pe(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}sn="WebExtension",ae(new I("auth",((e,{options:t})=>{const n=e.getProvider("app").getImmediate(),r=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:s,authDomain:o}=n.options;Pe(s&&!s.includes(":"),"invalid-api-key",{appName:n.name});const a={apiKey:s,authDomain:o,clientPlatform:sn,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:mt(sn)},c=new vt(n,r,i,a);return function(e,t){const n=(null==t?void 0:t.persistence)||[],r=(Array.isArray(n)?n:[n]).map(ut);(null==t?void 0:t.errorMap)&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(r,null==t?void 0:t.popupRedirectResolver)}(c,t),c}),"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback(((e,t,n)=>{e.getProvider("auth-internal").initialize()}))),ae(new I("auth-internal",(e=>(e=>new cn(e))(wt(e.getProvider("auth").getImmediate()))),"PRIVATE").setInstantiationMode("EXPLICIT")),pe(on,an,function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}(sn)),pe(on,an,"esm2017");const un="type.googleapis.com/google.protobuf.Int64Value",ln="type.googleapis.com/google.protobuf.UInt64Value";function hn(e,t){const n={};for(const r in e)e.hasOwnProperty(r)&&(n[r]=t(e[r]));return n}function dn(e){if(null==e)return null;if(e instanceof Number&&(e=e.valueOf()),"number"==typeof e&&isFinite(e))return e;if(!0===e||!1===e)return e;if("[object String]"===Object.prototype.toString.call(e))return e;if(e instanceof Date)return e.toISOString();if(Array.isArray(e))return e.map((e=>dn(e)));if("function"==typeof e||"object"==typeof e)return hn(e,(e=>dn(e)));throw new Error("Data cannot be encoded in JSON: "+e)}function fn(e){if(null==e)return e;if(e["@type"])switch(e["@type"]){case un:case ln:{const t=Number(e.value);if(isNaN(t))throw new Error("Data cannot be decoded from JSON: "+e);return t}default:throw new Error("Data cannot be decoded from JSON: "+e)}return Array.isArray(e)?e.map((e=>fn(e))):"function"==typeof e||"object"==typeof e?hn(e,(e=>fn(e))):e}const pn="functions",mn={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class gn extends f{constructor(e,t,n){super(`${pn}/${e}`,t||""),this.details=n}}class yn{constructor(e,t,n){this.auth=null,this.messaging=null,this.appCheck=null,this.auth=e.getImmediate({optional:!0}),this.messaging=t.getImmediate({optional:!0}),this.auth||e.get().then((e=>this.auth=e),(()=>{})),this.messaging||t.get().then((e=>this.messaging=e),(()=>{})),this.appCheck||n.get().then((e=>this.appCheck=e),(()=>{}))}async getAuthToken(){if(this.auth)try{const e=await this.auth.getToken();return null==e?void 0:e.accessToken}catch(e){return}}async getMessagingToken(){if(this.messaging&&"Notification"in self&&"granted"===Notification.permission)try{return await this.messaging.getToken()}catch(e){return}}async getAppCheckToken(e){if(this.appCheck){const t=e?await this.appCheck.getLimitedUseToken():await this.appCheck.getToken();return t.error?null:t.token}return null}async getContext(e){return{authToken:await this.getAuthToken(),messagingToken:await this.getMessagingToken(),appCheckToken:await this.getAppCheckToken(e)}}}const vn="us-central1";class wn{constructor(e,t,n,r,i=vn,s){this.app=e,this.fetchImpl=s,this.emulatorOrigin=null,this.contextProvider=new yn(t,n,r),this.cancelAllRequests=new Promise((e=>{this.deleteService=()=>Promise.resolve(e())}));try{const e=new URL(i);this.customDomain=e.origin,this.region=vn}catch(e){this.customDomain=null,this.region=i}}_delete(){return this.deleteService()}_url(e){const t=this.app.options.projectId;return null!==this.emulatorOrigin?`${this.emulatorOrigin}/${t}/${this.region}/${e}`:null!==this.customDomain?`${this.customDomain}/${e}`:`https://${this.region}-${t}.cloudfunctions.net/${e}`}}function En(e,t,n){return r=>function(e,t,n,r){const i=e._url(t);return async function(e,t,n,r){const i={data:n=dn(n)},s={},o=await e.contextProvider.getContext(r.limitedUseAppCheckTokens);o.authToken&&(s.Authorization="Bearer "+o.authToken),o.messagingToken&&(s["Firebase-Instance-ID-Token"]=o.messagingToken),null!==o.appCheckToken&&(s["X-Firebase-AppCheck"]=o.appCheckToken);const a=function(e){let t=null;return{promise:new Promise(((n,r)=>{t=setTimeout((()=>{r(new gn("deadline-exceeded","deadline-exceeded"))}),e)})),cancel:()=>{t&&clearTimeout(t)}}}(r.timeout||7e4),c=await Promise.race([_n(t,i,s,e.fetchImpl),a.promise,e.cancelAllRequests]);if(a.cancel(),!c)throw new gn("cancelled","Firebase Functions instance was deleted.");const u=function(e,t){let n,r=function(e){if(e>=200&&e<300)return"ok";switch(e){case 0:case 500:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"}(e),i=r;try{const e=t&&t.error;if(e){const t=e.status;if("string"==typeof t){if(!mn[t])return new gn("internal","internal");r=mn[t],i=t}const s=e.message;"string"==typeof s&&(i=s),n=e.details,void 0!==n&&(n=fn(n))}}catch(e){}return"ok"===r?null:new gn(r,i,n)}(c.status,c.json);if(u)throw u;if(!c.json)throw new gn("internal","Response is not valid JSON object.");let l=c.json.data;if(void 0===l&&(l=c.json.result),void 0===l)throw new gn("internal","Response is missing data field.");return{data:fn(l)}}(e,i,n,r)}(e,t,r,n||{})}async function _n(e,t,n,r){let i;n["Content-Type"]="application/json";try{i=await r(e,{method:"POST",body:JSON.stringify(t),headers:n})}catch(e){return{status:0,json:null}}let s=null;try{s=await i.json()}catch(e){}return{status:i.status,json:s}}const Tn="@firebase/functions",bn="0.11.1";function In(e,t,n){return En(b(e),t,n)}var Sn;Sn=fetch.bind(self),ae(new I(pn,((e,{instanceIdentifier:t})=>{const n=e.getProvider("app").getImmediate(),r=e.getProvider("auth-internal"),i=e.getProvider("messaging-internal"),s=e.getProvider("app-check-internal");return new wn(n,r,i,s,t,Sn)}),"PUBLIC").setMultipleInstances(!0)),pe(Tn,bn,void 0),pe(Tn,bn,"esm2017");var Cn,An="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},kn={},Nn=Nn||{},Dn=An||self;function Rn(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function Ln(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}var On="closure_uid_"+(1e9*Math.random()>>>0),Pn=0;function xn(e,t,n){return e.call.apply(e.bind,arguments)}function Mn(e,t,n){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function Un(e,t,n){return(Un=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?xn:Mn).apply(null,arguments)}function Fn(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function Vn(e,t){function n(){}n.prototype=t.prototype,e.$=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.ac=function(e,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[n].apply(e,i)}}function Bn(){this.s=this.s,this.o=this.o}Bn.prototype.s=!1,Bn.prototype.sa=function(){var e;!this.s&&(this.s=!0,this.N(),0)&&(e=this,Object.prototype.hasOwnProperty.call(e,On)&&e[On]||(e[On]=++Pn))},Bn.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const jn=Array.prototype.indexOf?function(e,t){return Array.prototype.indexOf.call(e,t,void 0)}:function(e,t){if("string"==typeof e)return"string"!=typeof t||1!=t.length?-1:e.indexOf(t,0);for(let n=0;n<e.length;n++)if(n in e&&e[n]===t)return n;return-1};function zn(e){const t=e.length;if(0<t){const n=Array(t);for(let r=0;r<t;r++)n[r]=e[r];return n}return[]}function qn(e,t){for(let t=1;t<arguments.length;t++){const n=arguments[t];if(Rn(n)){const t=e.length||0,r=n.length||0;e.length=t+r;for(let i=0;i<r;i++)e[t+i]=n[i]}else e.push(n)}}function $n(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}$n.prototype.h=function(){this.defaultPrevented=!0};var Hn=function(){if(!Dn.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{const e=()=>{};Dn.addEventListener("test",e,t),Dn.removeEventListener("test",e,t)}catch(e){}return e}();function Gn(e){return/^[\s\xa0]*$/.test(e)}function Kn(){var e=Dn.navigator;return e&&(e=e.userAgent)?e:""}function Wn(e){return-1!=Kn().indexOf(e)}function Qn(e){return Qn[" "](e),e}Qn[" "]=function(){};var Xn,Yn,Jn,Zn=Wn("Opera"),er=Wn("Trident")||Wn("MSIE"),tr=Wn("Edge"),nr=tr||er,rr=Wn("Gecko")&&!(-1!=Kn().toLowerCase().indexOf("webkit")&&!Wn("Edge"))&&!(Wn("Trident")||Wn("MSIE"))&&!Wn("Edge"),ir=-1!=Kn().toLowerCase().indexOf("webkit")&&!Wn("Edge");function sr(){var e=Dn.document;return e?e.documentMode:void 0}e:{var or="",ar=(Yn=Kn(),rr?/rv:([^\);]+)(\)|;)/.exec(Yn):tr?/Edge\/([\d\.]+)/.exec(Yn):er?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(Yn):ir?/WebKit\/(\S+)/.exec(Yn):Zn?/(?:Version)[ \/]?(\S+)/.exec(Yn):void 0);if(ar&&(or=ar?ar[1]:""),er){var cr=sr();if(null!=cr&&cr>parseFloat(or)){Xn=String(cr);break e}}Xn=or}Dn.document&&er?Jn=sr()||parseInt(Xn,10)||void 0:Jn=void 0;var ur=Jn;function lr(e,t){if($n.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(rr){e:{try{Qn(t.nodeName);var i=!0;break e}catch(e){}i=!1}i||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:hr[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&lr.$.h.call(this)}}Vn(lr,$n);var hr={2:"touch",3:"pen",4:"mouse"};lr.prototype.h=function(){lr.$.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var dr="closure_listenable_"+(1e6*Math.random()|0),fr=0;function pr(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.la=i,this.key=++fr,this.fa=this.ia=!1}function mr(e){e.fa=!0,e.listener=null,e.proxy=null,e.src=null,e.la=null}function gr(e,t,n){for(const r in e)t.call(n,e[r],r,e)}function yr(e){const t={};for(const n in e)t[n]=e[n];return t}const vr="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function wr(e,t){let n,r;for(let t=1;t<arguments.length;t++){for(n in r=arguments[t],r)e[n]=r[n];for(let t=0;t<vr.length;t++)n=vr[t],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}function Er(e){this.src=e,this.g={},this.h=0}function _r(e,t){var n=t.type;if(n in e.g){var r,i=e.g[n],s=jn(i,t);(r=0<=s)&&Array.prototype.splice.call(i,s,1),r&&(mr(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function Tr(e,t,n,r){for(var i=0;i<e.length;++i){var s=e[i];if(!s.fa&&s.listener==t&&s.capture==!!n&&s.la==r)return i}return-1}Er.prototype.add=function(e,t,n,r,i){var s=e.toString();(e=this.g[s])||(e=this.g[s]=[],this.h++);var o=Tr(e,t,r,i);return-1<o?(t=e[o],n||(t.ia=!1)):((t=new pr(t,this.src,s,!!r,i)).ia=n,e.push(t)),t};var br="closure_lm_"+(1e6*Math.random()|0),Ir={};function Sr(e,t,n,r,i){if(r&&r.once)return Ar(e,t,n,r,i);if(Array.isArray(t)){for(var s=0;s<t.length;s++)Sr(e,t[s],n,r,i);return null}return n=Pr(n),e&&e[dr]?e.O(t,n,Ln(r)?!!r.capture:!!r,i):Cr(e,t,n,!1,r,i)}function Cr(e,t,n,r,i,s){if(!t)throw Error("Invalid event type");var o=Ln(i)?!!i.capture:!!i,a=Lr(e);if(a||(e[br]=a=new Er(e)),(n=a.add(t,n,r,o,s)).proxy)return n;if(r=function(){const e=Rr;return function t(n){return e.call(t.src,t.listener,n)}}(),n.proxy=r,r.src=e,r.listener=n,e.addEventListener)Hn||(i=o),void 0===i&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(Dr(t.toString()),r);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(r)}return n}function Ar(e,t,n,r,i){if(Array.isArray(t)){for(var s=0;s<t.length;s++)Ar(e,t[s],n,r,i);return null}return n=Pr(n),e&&e[dr]?e.P(t,n,Ln(r)?!!r.capture:!!r,i):Cr(e,t,n,!0,r,i)}function kr(e,t,n,r,i){if(Array.isArray(t))for(var s=0;s<t.length;s++)kr(e,t[s],n,r,i);else r=Ln(r)?!!r.capture:!!r,n=Pr(n),e&&e[dr]?(e=e.i,(t=String(t).toString())in e.g&&-1<(n=Tr(s=e.g[t],n,r,i))&&(mr(s[n]),Array.prototype.splice.call(s,n,1),0==s.length&&(delete e.g[t],e.h--))):e&&(e=Lr(e))&&(t=e.g[t.toString()],e=-1,t&&(e=Tr(t,n,r,i)),(n=-1<e?t[e]:null)&&Nr(n))}function Nr(e){if("number"!=typeof e&&e&&!e.fa){var t=e.src;if(t&&t[dr])_r(t.i,e);else{var n=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(Dr(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=Lr(t))?(_r(n,e),0==n.h&&(n.src=null,t[br]=null)):mr(e)}}}function Dr(e){return e in Ir?Ir[e]:Ir[e]="on"+e}function Rr(e,t){if(e.fa)e=!0;else{t=new lr(t,this);var n=e.listener,r=e.la||e.src;e.ia&&Nr(e),e=n.call(r,t)}return e}function Lr(e){return(e=e[br])instanceof Er?e:null}var Or="__closure_events_fn_"+(1e9*Math.random()>>>0);function Pr(e){return"function"==typeof e?e:(e[Or]||(e[Or]=function(t){return e.handleEvent(t)}),e[Or])}function xr(){Bn.call(this),this.i=new Er(this),this.S=this,this.J=null}function Mr(e,t){var n,r=e.J;if(r)for(n=[];r;r=r.J)n.push(r);if(e=e.S,r=t.type||t,"string"==typeof t)t=new $n(t,e);else if(t instanceof $n)t.target=t.target||e;else{var i=t;wr(t=new $n(r,e),i)}if(i=!0,n)for(var s=n.length-1;0<=s;s--){var o=t.g=n[s];i=Ur(o,r,!0,t)&&i}if(i=Ur(o=t.g=e,r,!0,t)&&i,i=Ur(o,r,!1,t)&&i,n)for(s=0;s<n.length;s++)i=Ur(o=t.g=n[s],r,!1,t)&&i}function Ur(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var i=!0,s=0;s<t.length;++s){var o=t[s];if(o&&!o.fa&&o.capture==n){var a=o.listener,c=o.la||o.src;o.ia&&_r(e.i,o),i=!1!==a.call(c,r)&&i}}return i&&!r.defaultPrevented}Vn(xr,Bn),xr.prototype[dr]=!0,xr.prototype.removeEventListener=function(e,t,n,r){kr(this,e,t,n,r)},xr.prototype.N=function(){if(xr.$.N.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],r=0;r<n.length;r++)mr(n[r]);delete t.g[e],t.h--}}this.J=null},xr.prototype.O=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},xr.prototype.P=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};var Fr=Dn.JSON.stringify;function Vr(){var e=Gr;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var Br=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}((()=>new jr),(e=>e.reset()));class jr{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function zr(e){var t=1;e=e.split(":");const n=[];for(;0<t&&e.length;)n.push(e.shift()),t--;return e.length&&n.push(e.join(":")),n}function qr(e){Dn.setTimeout((()=>{throw e}),0)}let $r,Hr=!1,Gr=new class{constructor(){this.h=this.g=null}add(e,t){const n=Br.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}},Kr=()=>{const e=Dn.Promise.resolve(void 0);$r=()=>{e.then(Wr)}};var Wr=()=>{for(var e;e=Vr();){try{e.h.call(e.g)}catch(e){qr(e)}var t=Br;t.j(e),100>t.h&&(t.h++,e.next=t.g,t.g=e)}Hr=!1};function Qr(e,t){xr.call(this),this.h=e||1,this.g=t||Dn,this.j=Un(this.qb,this),this.l=Date.now()}function Xr(e){e.ga=!1,e.T&&(e.g.clearTimeout(e.T),e.T=null)}function Yr(e,t,n){if("function"==typeof e)n&&(e=Un(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=Un(e.handleEvent,e)}return 2147483647<Number(t)?-1:Dn.setTimeout(e,t||0)}function Jr(e){e.g=Yr((()=>{e.g=null,e.i&&(e.i=!1,Jr(e))}),e.j);const t=e.h;e.h=null,e.m.apply(null,t)}Vn(Qr,xr),(Cn=Qr.prototype).ga=!1,Cn.T=null,Cn.qb=function(){if(this.ga){var e=Date.now()-this.l;0<e&&e<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-e):(this.T&&(this.g.clearTimeout(this.T),this.T=null),Mr(this,"tick"),this.ga&&(Xr(this),this.start()))}},Cn.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())},Cn.N=function(){Qr.$.N.call(this),Xr(this),delete this.g};class Zr extends Bn{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:Jr(this)}N(){super.N(),this.g&&(Dn.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ei(e){Bn.call(this),this.h=e,this.g={}}Vn(ei,Bn);var ti=[];function ni(e,t,n,r){Array.isArray(n)||(n&&(ti[0]=n.toString()),n=ti);for(var i=0;i<n.length;i++){var s=Sr(t,n[i],r||e.handleEvent,!1,e.h||e);if(!s)break;e.g[s.key]=s}}function ri(e){gr(e.g,(function(e,t){this.g.hasOwnProperty(t)&&Nr(e)}),e),e.g={}}function ii(){this.g=!0}function si(e,t,n,r){e.info((function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n)for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var o=1;o<i.length;o++)i[o]=""}}}return Fr(n)}catch(e){return t}}(e,n)+(r?" "+r:"")}))}ei.prototype.N=function(){ei.$.N.call(this),ri(this)},ei.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},ii.prototype.Ea=function(){this.g=!1},ii.prototype.info=function(){};var oi={},ai=null;function ci(){return ai=ai||new xr}function ui(e){$n.call(this,oi.Ta,e)}function li(e){const t=ci();Mr(t,new ui(t))}function hi(e,t){$n.call(this,oi.STAT_EVENT,e),this.stat=t}function di(e){const t=ci();Mr(t,new hi(t,e))}function fi(e,t){$n.call(this,oi.Ua,e),this.size=t}function pi(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return Dn.setTimeout((function(){e()}),t)}oi.Ta="serverreachability",Vn(ui,$n),oi.STAT_EVENT="statevent",Vn(hi,$n),oi.Ua="timingevent",Vn(fi,$n);var mi={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},gi={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function yi(){}function vi(e){return e.h||(e.h=e.i())}function wi(){}yi.prototype.h=null;var Ei,_i={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function Ti(){$n.call(this,"d")}function bi(){$n.call(this,"c")}function Ii(){}function Si(e,t,n,r){this.l=e,this.j=t,this.m=n,this.W=r||1,this.U=new ei(this),this.P=Ai,e=nr?125:void 0,this.V=new Qr(e),this.I=null,this.i=!1,this.u=this.B=this.A=this.L=this.G=this.Y=this.C=null,this.F=[],this.g=null,this.o=0,this.s=this.v=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new Ci}function Ci(){this.i=null,this.g="",this.h=!1}Vn(Ti,$n),Vn(bi,$n),Vn(Ii,yi),Ii.prototype.g=function(){return new XMLHttpRequest},Ii.prototype.i=function(){return{}},Ei=new Ii;var Ai=45e3,ki={},Ni={};function Di(e,t,n){e.L=1,e.A=Qi($i(t)),e.u=n,e.S=!0,Ri(e,null)}function Ri(e,t){e.G=Date.now(),xi(e),e.B=$i(e.A);var n=e.B,r=e.W;Array.isArray(r)||(r=[String(r)]),cs(n.i,"t",r),e.o=0,n=e.l.J,e.h=new Ci,e.g=co(e.l,n?t:null,!e.u),0<e.O&&(e.M=new Zr(Un(e.Pa,e,e.g),e.O)),ni(e.U,e.g,"readystatechange",e.nb),t=e.I?yr(e.I):{},e.u?(e.v||(e.v="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ha(e.B,e.v,e.u,t)):(e.v="GET",e.g.ha(e.B,e.v,null,t)),li(),function(e,t,n,r,i,s){e.info((function(){if(e.g)if(s)for(var o="",a=s.split("&"),c=0;c<a.length;c++){var u=a[c].split("=");if(1<u.length){var l=u[0];u=u[1];var h=l.split("_");o=2<=h.length&&"type"==h[1]?o+(l+"=")+u+"&":o+(l+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+t+"\n"+n+"\n"+o}))}(e.j,e.v,e.B,e.m,e.W,e.u)}function Li(e){return!!e.g&&"GET"==e.v&&2!=e.L&&e.l.Ha}function Oi(e,t,n){let r,i=!0;for(;!e.J&&e.o<n.length;){if(r=Pi(e,n),r==Ni){4==t&&(e.s=4,di(14),i=!1),si(e.j,e.m,null,"[Incomplete Response]");break}if(r==ki){e.s=4,di(15),si(e.j,e.m,n,"[Invalid Chunk]"),i=!1;break}si(e.j,e.m,r,null),Bi(e,r)}Li(e)&&0!=e.o&&(e.h.g=e.h.g.slice(e.o),e.o=0),4!=t||0!=n.length||e.h.h||(e.s=1,di(16),i=!1),e.i=e.i&&i,i?0<n.length&&!e.ba&&(e.ba=!0,(t=e.l).g==e&&t.ca&&!t.M&&(t.l.info("Great, no buffering proxy detected. Bytes received: "+n.length),eo(t),t.M=!0,di(11))):(si(e.j,e.m,n,"[Invalid Chunked Response]"),Vi(e),Fi(e))}function Pi(e,t){var n=e.o,r=t.indexOf("\n",n);return-1==r?Ni:(n=Number(t.substring(n,r)),isNaN(n)?ki:(r+=1)+n>t.length?Ni:(t=t.slice(r,r+n),e.o=r+n,t))}function xi(e){e.Y=Date.now()+e.P,Mi(e,e.P)}function Mi(e,t){if(null!=e.C)throw Error("WatchDog timer not null");e.C=pi(Un(e.lb,e),t)}function Ui(e){e.C&&(Dn.clearTimeout(e.C),e.C=null)}function Fi(e){0==e.l.H||e.J||ro(e.l,e)}function Vi(e){Ui(e);var t=e.M;t&&"function"==typeof t.sa&&t.sa(),e.M=null,Xr(e.V),ri(e.U),e.g&&(t=e.g,e.g=null,t.abort(),t.sa())}function Bi(e,t){try{var n=e.l;if(0!=n.H&&(n.g==e||ms(n.i,e)))if(!e.K&&ms(n.i,e)&&3==n.H){try{var r=n.Ja.g.parse(t)}catch(e){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){e:if(!n.u){if(n.g){if(!(n.g.G+3e3<e.G))break e;no(n),Gs(n)}Zs(n),di(18)}}else n.Fa=i[1],0<n.Fa-n.V&&37500>i[2]&&n.G&&0==n.A&&!n.v&&(n.v=pi(Un(n.ib,n),6e3));if(1>=ps(n.i)&&n.oa){try{n.oa()}catch(e){}n.oa=void 0}}else so(n,11)}else if((e.K||n.g==e)&&no(n),!Gn(t))for(i=n.Ja.g.parse(t),t=0;t<i.length;t++){let u=i[t];if(n.V=u[0],u=u[1],2==n.H)if("c"==u[0]){n.K=u[1],n.pa=u[2];const t=u[3];null!=t&&(n.ra=t,n.l.info("VER="+n.ra));const i=u[4];null!=i&&(n.Ga=i,n.l.info("SVER="+n.Ga));const l=u[5];null!=l&&"number"==typeof l&&0<l&&(r=1.5*l,n.L=r,n.l.info("backChannelRequestTimeoutMs_="+r)),r=n;const h=e.g;if(h){const e=h.g?h.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var s=r.i;s.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(gs(s,s.h),s.h=null))}if(r.F){const e=h.g?h.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(r.Da=e,Wi(r.I,r.F,e))}}n.H=3,n.h&&n.h.Ba(),n.ca&&(n.S=Date.now()-e.G,n.l.info("Handshake RTT: "+n.S+"ms"));var o=e;if((r=n).wa=ao(r,r.J?r.pa:null,r.Y),o.K){ys(r.i,o);var a=o,c=r.L;c&&a.setTimeout(c),a.C&&(Ui(a),xi(a)),r.g=o}else Js(r);0<n.j.length&&Ws(n)}else"stop"!=u[0]&&"close"!=u[0]||so(n,7);else 3==n.H&&("stop"==u[0]||"close"==u[0]?"stop"==u[0]?so(n,7):Hs(n):"noop"!=u[0]&&n.h&&n.h.Aa(u),n.A=0)}li()}catch(e){}}function ji(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(Rn(e)||"string"==typeof e)Array.prototype.forEach.call(e,t,void 0);else for(var n=function(e){if(e.ta&&"function"==typeof e.ta)return e.ta();if(!e.Z||"function"!=typeof e.Z){if("undefined"!=typeof Map&&e instanceof Map)return Array.from(e.keys());if(!("undefined"!=typeof Set&&e instanceof Set)){if(Rn(e)||"string"==typeof e){var t=[];e=e.length;for(var n=0;n<e;n++)t.push(n);return t}t=[],n=0;for(const r in e)t[n++]=r;return t}}}(e),r=function(e){if(e.Z&&"function"==typeof e.Z)return e.Z();if("undefined"!=typeof Map&&e instanceof Map||"undefined"!=typeof Set&&e instanceof Set)return Array.from(e.values());if("string"==typeof e)return e.split("");if(Rn(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}for(r in t=[],n=0,e)t[n++]=e[r];return t}(e),i=r.length,s=0;s<i;s++)t.call(void 0,r[s],n&&n[s],e)}(Cn=Si.prototype).setTimeout=function(e){this.P=e},Cn.nb=function(e){e=e.target;const t=this.M;t&&3==Vs(e)?t.l():this.Pa(e)},Cn.Pa=function(e){try{if(e==this.g)e:{const l=Vs(this.g);var t=this.g.Ia();if(this.g.da(),!(3>l)&&(3!=l||nr||this.g&&(this.h.h||this.g.ja()||Bs(this.g)))){this.J||4!=l||7==t||li(),Ui(this);var n=this.g.da();this.ca=n;t:if(Li(this)){var r=Bs(this.g);e="";var i=r.length,s=4==Vs(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){Vi(this),Fi(this);var o="";break t}this.h.i=new Dn.TextDecoder}for(t=0;t<i;t++)this.h.h=!0,e+=this.h.i.decode(r[t],{stream:s&&t==i-1});r.length=0,this.h.g+=e,this.o=0,o=this.h.g}else o=this.g.ja();if(this.i=200==n,function(e,t,n,r,i,s,o){e.info((function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+t+"\n"+n+"\n"+s+" "+o}))}(this.j,this.v,this.B,this.m,this.W,l,n),this.i){if(this.aa&&!this.K){t:{if(this.g){var a,c=this.g;if((a=c.g?c.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Gn(a)){var u=a;break t}}u=null}if(!(n=u)){this.i=!1,this.s=3,di(12),Vi(this),Fi(this);break e}si(this.j,this.m,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Bi(this,n)}this.S?(Oi(this,l,o),nr&&this.i&&3==l&&(ni(this.U,this.V,"tick",this.mb),this.V.start())):(si(this.j,this.m,o,null),Bi(this,o)),4==l&&Vi(this),this.i&&!this.J&&(4==l?ro(this.l,this):(this.i=!1,xi(this)))}else(function(e){const t={};e=(e.g&&2<=Vs(e)&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let r=0;r<e.length;r++){if(Gn(e[r]))continue;var n=zr(e[r]);const i=n[0];if("string"!=typeof(n=n[1]))continue;n=n.trim();const s=t[i]||[];t[i]=s,s.push(n)}!function(e,t){for(const n in e)t.call(void 0,e[n],n,e)}(t,(function(e){return e.join(", ")}))})(this.g),400==n&&0<o.indexOf("Unknown SID")?(this.s=3,di(12)):(this.s=0,di(13)),Vi(this),Fi(this)}}}catch(e){}},Cn.mb=function(){if(this.g){var e=Vs(this.g),t=this.g.ja();this.o<t.length&&(Ui(this),Oi(this,e,t),this.i&&4!=e&&xi(this))}},Cn.cancel=function(){this.J=!0,Vi(this)},Cn.lb=function(){this.C=null;const e=Date.now();0<=e-this.Y?(function(e,t){e.info((function(){return"TIMEOUT: "+t}))}(this.j,this.B),2!=this.L&&(li(),di(17)),Vi(this),this.s=2,Fi(this)):Mi(this,this.Y-e)};var zi=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function qi(e){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,e instanceof qi){this.h=e.h,Hi(this,e.j),this.s=e.s,this.g=e.g,Gi(this,e.m),this.l=e.l;var t=e.i,n=new is;n.i=t.i,t.g&&(n.g=new Map(t.g),n.h=t.h),Ki(this,n),this.o=e.o}else e&&(t=String(e).match(zi))?(this.h=!1,Hi(this,t[1]||"",!0),this.s=Xi(t[2]||""),this.g=Xi(t[3]||"",!0),Gi(this,t[4]),this.l=Xi(t[5]||"",!0),Ki(this,t[6]||"",!0),this.o=Xi(t[7]||"")):(this.h=!1,this.i=new is(null,this.h))}function $i(e){return new qi(e)}function Hi(e,t,n){e.j=n?Xi(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function Gi(e,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);e.m=t}else e.m=null}function Ki(e,t,n){t instanceof is?(e.i=t,function(e,t){t&&!e.j&&(ss(e),e.i=null,e.g.forEach((function(e,t){var n=t.toLowerCase();t!=n&&(os(this,t),cs(this,n,e))}),e)),e.j=t}(e.i,e.h)):(n||(t=Yi(t,ns)),e.i=new is(t,e.h))}function Wi(e,t,n){e.i.set(t,n)}function Qi(e){return Wi(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function Xi(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function Yi(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,Ji),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function Ji(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}qi.prototype.toString=function(){var e=[],t=this.j;t&&e.push(Yi(t,Zi,!0),":");var n=this.g;return(n||"file"==t)&&(e.push("//"),(t=this.s)&&e.push(Yi(t,Zi,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&e.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(Yi(n,"/"==n.charAt(0)?ts:es,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.o)&&e.push("#",Yi(n,rs)),e.join("")};var Zi=/[#\/\?@]/g,es=/[#\?:]/g,ts=/[#\?]/g,ns=/[#\?@]/g,rs=/#/g;function is(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function ss(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var r=e[n].indexOf("="),i=null;if(0<=r){var s=e[n].substring(0,r);i=e[n].substring(r+1)}else s=e[n];t(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(e.i,(function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)})))}function os(e,t){ss(e),t=us(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function as(e,t){return ss(e),t=us(e,t),e.g.has(t)}function cs(e,t,n){os(e,t),0<n.length&&(e.i=null,e.g.set(us(e,t),zn(n)),e.h+=n.length)}function us(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}(Cn=is.prototype).add=function(e,t){ss(this),this.i=null,e=us(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},Cn.forEach=function(e,t){ss(this),this.g.forEach((function(n,r){n.forEach((function(n){e.call(t,n,r,this)}),this)}),this)},Cn.ta=function(){ss(this);const e=Array.from(this.g.values()),t=Array.from(this.g.keys()),n=[];for(let r=0;r<t.length;r++){const i=e[r];for(let e=0;e<i.length;e++)n.push(t[r])}return n},Cn.Z=function(e){ss(this);let t=[];if("string"==typeof e)as(this,e)&&(t=t.concat(this.g.get(us(this,e))));else{e=Array.from(this.g.values());for(let n=0;n<e.length;n++)t=t.concat(e[n])}return t},Cn.set=function(e,t){return ss(this),this.i=null,as(this,e=us(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},Cn.get=function(e,t){return e&&0<(e=this.Z(e)).length?String(e[0]):t},Cn.toString=function(){if(this.i)return this.i;if(!this.g)return"";const e=[],t=Array.from(this.g.keys());for(var n=0;n<t.length;n++){var r=t[n];const s=encodeURIComponent(String(r)),o=this.Z(r);for(r=0;r<o.length;r++){var i=s;""!==o[r]&&(i+="="+encodeURIComponent(String(o[r]))),e.push(i)}}return this.i=e.join("&")};var ls=class{constructor(e,t){this.g=e,this.map=t}};function hs(e){this.l=e||ds,e=Dn.PerformanceNavigationTiming?0<(e=Dn.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(Dn.g&&Dn.g.Ka&&Dn.g.Ka()&&Dn.g.Ka().dc),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var ds=10;function fs(e){return!!e.h||!!e.g&&e.g.size>=e.j}function ps(e){return e.h?1:e.g?e.g.size:0}function ms(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function gs(e,t){e.g?e.g.add(t):e.h=t}function ys(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function vs(e){if(null!=e.h)return e.i.concat(e.h.F);if(null!=e.g&&0!==e.g.size){let t=e.i;for(const n of e.g.values())t=t.concat(n.F);return t}return zn(e.i)}hs.prototype.cancel=function(){if(this.i=vs(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const e of this.g.values())e.cancel();this.g.clear()}};var ws=class{stringify(e){return Dn.JSON.stringify(e,void 0)}parse(e){return Dn.JSON.parse(e,void 0)}};function Es(){this.g=new ws}function _s(e,t,n){const r=n||"";try{ji(e,(function(e,n){let i=e;Ln(e)&&(i=Fr(e)),t.push(r+n+"="+encodeURIComponent(i))}))}catch(e){throw t.push(r+"type="+encodeURIComponent("_badmap")),e}}function Ts(e,t,n,r,i){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,i(r)}catch(e){}}function bs(e){this.l=e.ec||null,this.j=e.ob||!1}function Is(e,t){xr.call(this),this.F=e,this.u=t,this.m=void 0,this.readyState=Ss,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}Vn(bs,yi),bs.prototype.g=function(){return new Is(this.l,this.j)},bs.prototype.i=function(e){return function(){return e}}({}),Vn(Is,xr);var Ss=0;function Cs(e){e.j.read().then(e.Xa.bind(e)).catch(e.ka.bind(e))}function As(e){e.readyState=4,e.l=null,e.j=null,e.A=null,ks(e)}function ks(e){e.onreadystatechange&&e.onreadystatechange.call(e)}(Cn=Is.prototype).open=function(e,t){if(this.readyState!=Ss)throw this.abort(),Error("Error reopening a connection");this.C=e,this.B=t,this.readyState=1,ks(this)},Cn.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const t={headers:this.v,method:this.C,credentials:this.m,cache:void 0};e&&(t.body=e),(this.F||Dn).fetch(new Request(this.B,t)).then(this.$a.bind(this),this.ka.bind(this))},Cn.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch((()=>{})),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,As(this)),this.readyState=Ss},Cn.$a=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,ks(this)),this.g&&(this.readyState=3,ks(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(void 0!==Dn.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;Cs(this)}else e.text().then(this.Za.bind(this),this.ka.bind(this))},Cn.Xa=function(e){if(this.g){if(this.u&&e.value)this.response.push(e.value);else if(!this.u){var t=e.value?e.value:new Uint8Array(0);(t=this.A.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?As(this):ks(this),3==this.readyState&&Cs(this)}},Cn.Za=function(e){this.g&&(this.response=this.responseText=e,As(this))},Cn.Ya=function(e){this.g&&(this.response=e,As(this))},Cn.ka=function(){this.g&&As(this)},Cn.setRequestHeader=function(e,t){this.v.append(e,t)},Cn.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},Cn.getAllResponseHeaders=function(){if(!this.h)return"";const e=[],t=this.h.entries();for(var n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(Is.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}});var Ns=Dn.JSON.parse;function Ds(e){xr.call(this),this.headers=new Map,this.u=e||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=Rs,this.L=this.M=!1}Vn(Ds,xr);var Rs="",Ls=/^https?$/i,Os=["POST","PUT"];function Ps(e,t){e.h=!1,e.g&&(e.l=!0,e.g.abort(),e.l=!1),e.j=t,e.m=5,xs(e),Us(e)}function xs(e){e.F||(e.F=!0,Mr(e,"complete"),Mr(e,"error"))}function Ms(e){if(e.h&&void 0!==Nn&&(!e.C[1]||4!=Vs(e)||2!=e.da()))if(e.v&&4==Vs(e))Yr(e.La,0,e);else if(Mr(e,"readystatechange"),4==Vs(e)){e.h=!1;try{const o=e.da();e:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t=!0;break e;default:t=!1}var n;if(!(n=t)){var r;if(r=0===o){var i=String(e.I).match(zi)[1]||null;!i&&Dn.self&&Dn.self.location&&(i=Dn.self.location.protocol.slice(0,-1)),r=!Ls.test(i?i.toLowerCase():"")}n=r}if(n)Mr(e,"complete"),Mr(e,"success");else{e.m=6;try{var s=2<Vs(e)?e.g.statusText:""}catch(e){s=""}e.j=s+" ["+e.da()+"]",xs(e)}}finally{Us(e)}}}function Us(e,t){if(e.g){Fs(e);const n=e.g,r=e.C[0]?()=>{}:null;e.g=null,e.C=null,t||Mr(e,"ready");try{n.onreadystatechange=r}catch(e){}}}function Fs(e){e.g&&e.L&&(e.g.ontimeout=null),e.A&&(Dn.clearTimeout(e.A),e.A=null)}function Vs(e){return e.g?e.g.readyState:0}function Bs(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.K){case Rs:case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function js(e){let t="";return gr(e,(function(e,n){t+=n,t+=":",t+=e,t+="\r\n"})),t}function zs(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=js(n),"string"==typeof e?null!=n&&encodeURIComponent(String(n)):Wi(e,t,n))}function qs(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function $s(e){this.Ga=0,this.j=[],this.l=new ii,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=qs("failFast",!1,e),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=qs("baseRetryDelayMs",5e3,e),this.hb=qs("retryDelaySeedMs",1e4,e),this.eb=qs("forwardChannelMaxRetries",2,e),this.xa=qs("forwardChannelRequestTimeoutMs",2e4,e),this.va=e&&e.xmlHttpFactory||void 0,this.Ha=e&&e.useFetchStreams||!1,this.L=void 0,this.J=e&&e.supportsCrossDomainXhr||!1,this.K="",this.i=new hs(e&&e.concurrentRequestLimit),this.Ja=new Es,this.P=e&&e.fastHandshake||!1,this.O=e&&e.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=e&&e.bc||!1,e&&e.Ea&&this.l.Ea(),e&&e.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&e&&e.detectBufferingProxy||!1,this.qa=void 0,e&&e.longPollingTimeout&&0<e.longPollingTimeout&&(this.qa=e.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}function Hs(e){if(Ks(e),3==e.H){var t=e.W++,n=$i(e.I);if(Wi(n,"SID",e.K),Wi(n,"RID",t),Wi(n,"TYPE","terminate"),Xs(e,n),(t=new Si(e,e.l,t)).L=2,t.A=Qi($i(n)),n=!1,Dn.navigator&&Dn.navigator.sendBeacon)try{n=Dn.navigator.sendBeacon(t.A.toString(),"")}catch(e){}!n&&Dn.Image&&((new Image).src=t.A,n=!0),n||(t.g=co(t.l,null),t.g.ha(t.A)),t.G=Date.now(),xi(t)}oo(e)}function Gs(e){e.g&&(eo(e),e.g.cancel(),e.g=null)}function Ks(e){Gs(e),e.u&&(Dn.clearTimeout(e.u),e.u=null),no(e),e.i.cancel(),e.m&&("number"==typeof e.m&&Dn.clearTimeout(e.m),e.m=null)}function Ws(e){if(!fs(e.i)&&!e.m){e.m=!0;var t=e.Na;$r||Kr(),Hr||($r(),Hr=!0),Gr.add(t,e),e.C=0}}function Qs(e,t){var n;n=t?t.m:e.W++;const r=$i(e.I);Wi(r,"SID",e.K),Wi(r,"RID",n),Wi(r,"AID",e.V),Xs(e,r),e.o&&e.s&&zs(r,e.o,e.s),n=new Si(e,e.l,n,e.C+1),null===e.o&&(n.I=e.s),t&&(e.j=t.F.concat(e.j)),t=Ys(e,n,1e3),n.setTimeout(Math.round(.5*e.xa)+Math.round(.5*e.xa*Math.random())),gs(e.i,n),Di(n,r,t)}function Xs(e,t){e.na&&gr(e.na,(function(e,n){Wi(t,n,e)})),e.h&&ji({},(function(e,n){Wi(t,n,e)}))}function Ys(e,t,n){n=Math.min(e.j.length,n);var r=e.h?Un(e.h.Va,e.h,e):null;e:{var i=e.j;let t=-1;for(;;){const e=["count="+n];-1==t?0<n?(t=i[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let s=!0;for(let o=0;o<n;o++){let n=i[o].g;const a=i[o].map;if(n-=t,0>n)t=Math.max(0,i[o].g-100),s=!1;else try{_s(a,e,"req"+n+"_")}catch(e){r&&r(a)}}if(s){r=e.join("&");break e}}}return e=e.j.splice(0,n),t.F=e,r}function Js(e){if(!e.g&&!e.u){e.ba=1;var t=e.Ma;$r||Kr(),Hr||($r(),Hr=!0),Gr.add(t,e),e.A=0}}function Zs(e){return!(e.g||e.u||3<=e.A||(e.ba++,e.u=pi(Un(e.Ma,e),io(e,e.A)),e.A++,0))}function eo(e){null!=e.B&&(Dn.clearTimeout(e.B),e.B=null)}function to(e){e.g=new Si(e,e.l,"rpc",e.ba),null===e.o&&(e.g.I=e.s),e.g.O=0;var t=$i(e.wa);Wi(t,"RID","rpc"),Wi(t,"SID",e.K),Wi(t,"AID",e.V),Wi(t,"CI",e.G?"0":"1"),!e.G&&e.qa&&Wi(t,"TO",e.qa),Wi(t,"TYPE","xmlhttp"),Xs(e,t),e.o&&e.s&&zs(t,e.o,e.s),e.L&&e.g.setTimeout(e.L);var n=e.g;e=e.pa,n.L=1,n.A=Qi($i(t)),n.u=null,n.S=!0,Ri(n,e)}function no(e){null!=e.v&&(Dn.clearTimeout(e.v),e.v=null)}function ro(e,t){var n=null;if(e.g==t){no(e),eo(e),e.g=null;var r=2}else{if(!ms(e.i,t))return;n=t.F,ys(e.i,t),r=1}if(0!=e.H)if(t.i)if(1==r){n=t.u?t.u.length:0,t=Date.now()-t.G;var i=e.C;Mr(r=ci(),new fi(r,n)),Ws(e)}else Js(e);else if(3==(i=t.s)||0==i&&0<t.ca||!(1==r&&function(e,t){return!(ps(e.i)>=e.i.j-(e.m?1:0)||(e.m?(e.j=t.F.concat(e.j),0):1==e.H||2==e.H||e.C>=(e.cb?0:e.eb)||(e.m=pi(Un(e.Na,e,t),io(e,e.C)),e.C++,0)))}(e,t)||2==r&&Zs(e)))switch(n&&0<n.length&&(t=e.i,t.i=t.i.concat(n)),i){case 1:so(e,5);break;case 4:so(e,10);break;case 3:so(e,6);break;default:so(e,2)}}function io(e,t){let n=e.ab+Math.floor(Math.random()*e.hb);return e.isActive()||(n*=2),n*t}function so(e,t){if(e.l.info("Error code "+t),2==t){var n=null;e.h&&(n=null);var r=Un(e.pb,e);n||(n=new qi("//www.google.com/images/cleardot.gif"),Dn.location&&"http"==Dn.location.protocol||Hi(n,"https"),Qi(n)),function(e,t){const n=new ii;if(Dn.Image){const r=new Image;r.onload=Fn(Ts,n,r,"TestLoadImage: loaded",!0,t),r.onerror=Fn(Ts,n,r,"TestLoadImage: error",!1,t),r.onabort=Fn(Ts,n,r,"TestLoadImage: abort",!1,t),r.ontimeout=Fn(Ts,n,r,"TestLoadImage: timeout",!1,t),Dn.setTimeout((function(){r.ontimeout&&r.ontimeout()}),1e4),r.src=e}else t(!1)}(n.toString(),r)}else di(2);e.H=0,e.h&&e.h.za(t),oo(e),Ks(e)}function oo(e){if(e.H=0,e.ma=[],e.h){const t=vs(e.i);0==t.length&&0==e.j.length||(qn(e.ma,t),qn(e.ma,e.j),e.i.i.length=0,zn(e.j),e.j.length=0),e.h.ya()}}function ao(e,t,n){var r=n instanceof qi?$i(n):new qi(n);if(""!=r.g)t&&(r.g=t+"."+r.g),Gi(r,r.m);else{var i=Dn.location;r=i.protocol,t=t?t+"."+i.hostname:i.hostname,i=+i.port;var s=new qi(null);r&&Hi(s,r),t&&(s.g=t),i&&Gi(s,i),n&&(s.l=n),r=s}return n=e.F,t=e.Da,n&&t&&Wi(r,n,t),Wi(r,"VER",e.ra),Xs(e,r),r}function co(e,t,n){if(t&&!e.J)throw Error("Can't create secondary domain capable XhrIo object.");return(t=e.Ha&&!e.va?new Ds(new bs({ob:n})):new Ds(e.va)).Oa(e.J),t}function uo(){}function lo(){if(er&&!(10<=Number(ur)))throw Error("Environmental error: no available transport.")}function ho(e,t){xr.call(this),this.g=new $s(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.s=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.Ca&&(e?e["X-WebChannel-Client-Profile"]=t.Ca:e={"X-WebChannel-Client-Profile":t.Ca}),this.g.U=e,(e=t&&t.cc)&&!Gn(e)&&(this.g.o=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!Gn(t)&&(this.g.F=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new mo(this)}function fo(e){Ti.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(const n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function po(){bi.call(this),this.status=1}function mo(e){this.g=e}function go(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}function yo(e,t,n){n||(n=0);var r=Array(16);if("string"==typeof t)for(var i=0;16>i;++i)r[i]=t.charCodeAt(n++)|t.charCodeAt(n++)<<8|t.charCodeAt(n++)<<16|t.charCodeAt(n++)<<24;else for(i=0;16>i;++i)r[i]=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;t=e.g[0],n=e.g[1],i=e.g[2];var s=e.g[3],o=t+(s^n&(i^s))+r[0]+3614090360&4294967295;o=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=n+(o<<7&4294967295|o>>>25))+((o=s+(i^t&(n^i))+r[1]+3905402710&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(t^n))+r[2]+606105819&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^i&(s^t))+r[3]+3250441966&4294967295)<<22&4294967295|o>>>10))+((o=t+(s^n&(i^s))+r[4]+4118548399&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^t&(n^i))+r[5]+1200080426&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(t^n))+r[6]+2821735955&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^i&(s^t))+r[7]+4249261313&4294967295)<<22&4294967295|o>>>10))+((o=t+(s^n&(i^s))+r[8]+1770035416&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^t&(n^i))+r[9]+2336552879&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(t^n))+r[10]+4294925233&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^i&(s^t))+r[11]+2304563134&4294967295)<<22&4294967295|o>>>10))+((o=t+(s^n&(i^s))+r[12]+1804603682&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^t&(n^i))+r[13]+4254626195&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(t^n))+r[14]+2792965006&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^i&(s^t))+r[15]+1236535329&4294967295)<<22&4294967295|o>>>10))+((o=t+(i^s&(n^i))+r[1]+4129170786&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(t^n))+r[6]+3225465664&4294967295)<<9&4294967295|o>>>23))+((o=i+(t^n&(s^t))+r[11]+643717713&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^t&(i^s))+r[0]+3921069994&4294967295)<<20&4294967295|o>>>12))+((o=t+(i^s&(n^i))+r[5]+3593408605&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(t^n))+r[10]+38016083&4294967295)<<9&4294967295|o>>>23))+((o=i+(t^n&(s^t))+r[15]+3634488961&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^t&(i^s))+r[4]+3889429448&4294967295)<<20&4294967295|o>>>12))+((o=t+(i^s&(n^i))+r[9]+568446438&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(t^n))+r[14]+3275163606&4294967295)<<9&4294967295|o>>>23))+((o=i+(t^n&(s^t))+r[3]+4107603335&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^t&(i^s))+r[8]+1163531501&4294967295)<<20&4294967295|o>>>12))+((o=t+(i^s&(n^i))+r[13]+2850285829&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(t^n))+r[2]+4243563512&4294967295)<<9&4294967295|o>>>23))+((o=i+(t^n&(s^t))+r[7]+1735328473&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^t&(i^s))+r[12]+2368359562&4294967295)<<20&4294967295|o>>>12))+((o=t+(n^i^s)+r[5]+4294588738&4294967295)<<4&4294967295|o>>>28))+((o=s+(t^n^i)+r[8]+2272392833&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^t^n)+r[11]+1839030562&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^t)+r[14]+4259657740&4294967295)<<23&4294967295|o>>>9))+((o=t+(n^i^s)+r[1]+2763975236&4294967295)<<4&4294967295|o>>>28))+((o=s+(t^n^i)+r[4]+1272893353&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^t^n)+r[7]+4139469664&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^t)+r[10]+3200236656&4294967295)<<23&4294967295|o>>>9))+((o=t+(n^i^s)+r[13]+681279174&4294967295)<<4&4294967295|o>>>28))+((o=s+(t^n^i)+r[0]+3936430074&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^t^n)+r[3]+3572445317&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^t)+r[6]+76029189&4294967295)<<23&4294967295|o>>>9))+((o=t+(n^i^s)+r[9]+3654602809&4294967295)<<4&4294967295|o>>>28))+((o=s+(t^n^i)+r[12]+3873151461&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^t^n)+r[15]+530742520&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^t)+r[2]+3299628645&4294967295)<<23&4294967295|o>>>9))+((o=t+(i^(n|~s))+r[0]+4096336452&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(t|~i))+r[7]+1126891415&4294967295)<<10&4294967295|o>>>22))+((o=i+(t^(s|~n))+r[14]+2878612391&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(i|~t))+r[5]+4237533241&4294967295)<<21&4294967295|o>>>11))+((o=t+(i^(n|~s))+r[12]+1700485571&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(t|~i))+r[3]+2399980690&4294967295)<<10&4294967295|o>>>22))+((o=i+(t^(s|~n))+r[10]+4293915773&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(i|~t))+r[1]+2240044497&4294967295)<<21&4294967295|o>>>11))+((o=t+(i^(n|~s))+r[8]+1873313359&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(t|~i))+r[15]+4264355552&4294967295)<<10&4294967295|o>>>22))+((o=i+(t^(s|~n))+r[6]+2734768916&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(i|~t))+r[13]+1309151649&4294967295)<<21&4294967295|o>>>11))+((s=(t=n+((o=t+(i^(n|~s))+r[4]+4149444226&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(t|~i))+r[11]+3174756917&4294967295)<<10&4294967295|o>>>22))^((i=s+((o=i+(t^(s|~n))+r[2]+718787259&4294967295)<<15&4294967295|o>>>17))|~t))+r[9]+3951481745&4294967295,e.g[0]=e.g[0]+t&4294967295,e.g[1]=e.g[1]+(i+(o<<21&4294967295|o>>>11))&4294967295,e.g[2]=e.g[2]+i&4294967295,e.g[3]=e.g[3]+s&4294967295}function vo(e,t){this.h=t;for(var n=[],r=!0,i=e.length-1;0<=i;i--){var s=0|e[i];r&&s==t||(n[i]=s,r=!1)}this.g=n}(Cn=Ds.prototype).Oa=function(e){this.M=e},Cn.ha=function(e,t,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+e);t=t?t.toUpperCase():"GET",this.I=e,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():Ei.g(),this.C=this.u?vi(this.u):vi(Ei),this.g.onreadystatechange=Un(this.La,this);try{this.G=!0,this.g.open(t,String(e),!0),this.G=!1}catch(e){return void Ps(this,e)}if(e=n||"",n=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var i in r)n.set(i,r[i]);else{if("function"!=typeof r.keys||"function"!=typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const e of r.keys())n.set(e,r.get(e))}r=Array.from(n.keys()).find((e=>"content-type"==e.toLowerCase())),i=Dn.FormData&&e instanceof Dn.FormData,!(0<=jn(Os,t))||r||i||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[e,t]of n)this.g.setRequestHeader(e,t);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{Fs(this),0<this.B&&((this.L=function(e){return er&&"number"==typeof e.timeout&&void 0!==e.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=Un(this.ua,this)):this.A=Yr(this.ua,this.B,this)),this.v=!0,this.g.send(e),this.v=!1}catch(e){Ps(this,e)}},Cn.ua=function(){void 0!==Nn&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,Mr(this,"timeout"),this.abort(8))},Cn.abort=function(e){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=e||7,Mr(this,"complete"),Mr(this,"abort"),Us(this))},Cn.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Us(this,!0)),Ds.$.N.call(this)},Cn.La=function(){this.s||(this.G||this.v||this.l?Ms(this):this.kb())},Cn.kb=function(){Ms(this)},Cn.isActive=function(){return!!this.g},Cn.da=function(){try{return 2<Vs(this)?this.g.status:-1}catch(e){return-1}},Cn.ja=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},Cn.Wa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),Ns(t)}},Cn.Ia=function(){return this.m},Cn.Sa=function(){return"string"==typeof this.j?this.j:String(this.j)},(Cn=$s.prototype).ra=8,Cn.H=1,Cn.Na=function(e){if(this.m)if(this.m=null,1==this.H){if(!e){this.W=Math.floor(1e5*Math.random()),e=this.W++;const i=new Si(this,this.l,e);let s=this.s;if(this.U&&(s?(s=yr(s),wr(s,this.U)):s=this.U),null!==this.o||this.O||(i.I=s,s=null),this.P)e:{for(var t=0,n=0;n<this.j.length;n++){var r=this.j[n];if(void 0===(r="__data__"in r.map&&"string"==typeof(r=r.map.__data__)?r.length:void 0))break;if(4096<(t+=r)){t=n;break e}if(4096===t||n===this.j.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=Ys(this,i,t),Wi(n=$i(this.I),"RID",e),Wi(n,"CVER",22),this.F&&Wi(n,"X-HTTP-Session-Id",this.F),Xs(this,n),s&&(this.O?t="headers="+encodeURIComponent(String(js(s)))+"&"+t:this.o&&zs(n,this.o,s)),gs(this.i,i),this.bb&&Wi(n,"TYPE","init"),this.P?(Wi(n,"$req",t),Wi(n,"SID","null"),i.aa=!0,Di(i,n,null)):Di(i,n,t),this.H=2}}else 3==this.H&&(e?Qs(this,e):0==this.j.length||fs(this.i)||Qs(this))},Cn.Ma=function(){if(this.u=null,to(this),this.ca&&!(this.M||null==this.g||0>=this.S)){var e=2*this.S;this.l.info("BP detection timer enabled: "+e),this.B=pi(Un(this.jb,this),e)}},Cn.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,di(10),Gs(this),to(this))},Cn.ib=function(){null!=this.v&&(this.v=null,Gs(this),Zs(this),di(19))},Cn.pb=function(e){e?(this.l.info("Successfully pinged google.com"),di(2)):(this.l.info("Failed to ping google.com"),di(1))},Cn.isActive=function(){return!!this.h&&this.h.isActive(this)},(Cn=uo.prototype).Ba=function(){},Cn.Aa=function(){},Cn.za=function(){},Cn.ya=function(){},Cn.isActive=function(){return!0},Cn.Va=function(){},lo.prototype.g=function(e,t){return new ho(e,t)},Vn(ho,xr),ho.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var e=this.g,t=this.l,n=this.h||void 0;di(0),e.Y=t,e.na=n||{},e.G=e.aa,e.I=ao(e,null,e.Y),Ws(e)},ho.prototype.close=function(){Hs(this.g)},ho.prototype.u=function(e){var t=this.g;if("string"==typeof e){var n={};n.__data__=e,e=n}else this.v&&((n={}).__data__=Fr(e),e=n);t.j.push(new ls(t.fb++,e)),3==t.H&&Ws(t)},ho.prototype.N=function(){this.g.h=null,delete this.j,Hs(this.g),delete this.g,ho.$.N.call(this)},Vn(fo,Ti),Vn(po,bi),Vn(mo,uo),mo.prototype.Ba=function(){Mr(this.g,"a")},mo.prototype.Aa=function(e){Mr(this.g,new fo(e))},mo.prototype.za=function(e){Mr(this.g,new po)},mo.prototype.ya=function(){Mr(this.g,"b")},Vn(go,(function(){this.blockSize=-1})),go.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0},go.prototype.j=function(e,t){void 0===t&&(t=e.length);for(var n=t-this.blockSize,r=this.m,i=this.h,s=0;s<t;){if(0==i)for(;s<=n;)yo(this,e,s),s+=this.blockSize;if("string"==typeof e){for(;s<t;)if(r[i++]=e.charCodeAt(s++),i==this.blockSize){yo(this,r),i=0;break}}else for(;s<t;)if(r[i++]=e[s++],i==this.blockSize){yo(this,r),i=0;break}}this.h=i,this.i+=t},go.prototype.l=function(){var e=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;var n=8*this.i;for(t=e.length-8;t<e.length;++t)e[t]=255&n,n/=256;for(this.j(e),e=Array(16),t=n=0;4>t;++t)for(var r=0;32>r;r+=8)e[n++]=this.g[t]>>>r&255;return e};var wo={};function Eo(e){return-128<=e&&128>e?function(e,t){var n=wo;return Object.prototype.hasOwnProperty.call(n,e)?n[e]:n[e]=function(e){return new vo([0|e],0>e?-1:0)}(e)}(e):new vo([0|e],0>e?-1:0)}function _o(e){if(isNaN(e)||!isFinite(e))return bo;if(0>e)return ko(_o(-e));for(var t=[],n=1,r=0;e>=n;r++)t[r]=e/n|0,n*=To;return new vo(t,0)}var To=4294967296,bo=Eo(0),Io=Eo(1),So=Eo(16777216);function Co(e){if(0!=e.h)return!1;for(var t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function Ao(e){return-1==e.h}function ko(e){for(var t=e.g.length,n=[],r=0;r<t;r++)n[r]=~e.g[r];return new vo(n,~e.h).add(Io)}function No(e,t){return e.add(ko(t))}function Do(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function Ro(e,t){this.g=e,this.h=t}function Lo(e,t){if(Co(t))throw Error("division by zero");if(Co(e))return new Ro(bo,bo);if(Ao(e))return t=Lo(ko(e),t),new Ro(ko(t.g),ko(t.h));if(Ao(t))return t=Lo(e,ko(t)),new Ro(ko(t.g),t.h);if(30<e.g.length){if(Ao(e)||Ao(t))throw Error("slowDivide_ only works with positive integers.");for(var n=Io,r=t;0>=r.X(e);)n=Oo(n),r=Oo(r);var i=Po(n,1),s=Po(r,1);for(r=Po(r,2),n=Po(n,2);!Co(r);){var o=s.add(r);0>=o.X(e)&&(i=i.add(n),s=o),r=Po(r,1),n=Po(n,1)}return t=No(e,i.R(t)),new Ro(i,t)}for(i=bo;0<=e.X(t);){for(n=Math.max(1,Math.floor(e.ea()/t.ea())),r=48>=(r=Math.ceil(Math.log(n)/Math.LN2))?1:Math.pow(2,r-48),o=(s=_o(n)).R(t);Ao(o)||0<o.X(e);)o=(s=_o(n-=r)).R(t);Co(s)&&(s=Io),i=i.add(s),e=No(e,o)}return new Ro(i,e)}function Oo(e){for(var t=e.g.length+1,n=[],r=0;r<t;r++)n[r]=e.D(r)<<1|e.D(r-1)>>>31;return new vo(n,e.h)}function Po(e,t){var n=t>>5;t%=32;for(var r=e.g.length-n,i=[],s=0;s<r;s++)i[s]=0<t?e.D(s+n)>>>t|e.D(s+n+1)<<32-t:e.D(s+n);return new vo(i,e.h)}(Cn=vo.prototype).ea=function(){if(Ao(this))return-ko(this).ea();for(var e=0,t=1,n=0;n<this.g.length;n++){var r=this.D(n);e+=(0<=r?r:To+r)*t,t*=To}return e},Cn.toString=function(e){if(2>(e=e||10)||36<e)throw Error("radix out of range: "+e);if(Co(this))return"0";if(Ao(this))return"-"+ko(this).toString(e);for(var t=_o(Math.pow(e,6)),n=this,r="";;){var i=Lo(n,t).g,s=((0<(n=No(n,i.R(t))).g.length?n.g[0]:n.h)>>>0).toString(e);if(Co(n=i))return s+r;for(;6>s.length;)s="0"+s;r=s+r}},Cn.D=function(e){return 0>e?0:e<this.g.length?this.g[e]:this.h},Cn.X=function(e){return Ao(e=No(this,e))?-1:Co(e)?0:1},Cn.abs=function(){return Ao(this)?ko(this):this},Cn.add=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0,i=0;i<=t;i++){var s=r+(65535&this.D(i))+(65535&e.D(i)),o=(s>>>16)+(this.D(i)>>>16)+(e.D(i)>>>16);r=o>>>16,s&=65535,o&=65535,n[i]=o<<16|s}return new vo(n,-2147483648&n[n.length-1]?-1:0)},Cn.R=function(e){if(Co(this)||Co(e))return bo;if(Ao(this))return Ao(e)?ko(this).R(ko(e)):ko(ko(this).R(e));if(Ao(e))return ko(this.R(ko(e)));if(0>this.X(So)&&0>e.X(So))return _o(this.ea()*e.ea());for(var t=this.g.length+e.g.length,n=[],r=0;r<2*t;r++)n[r]=0;for(r=0;r<this.g.length;r++)for(var i=0;i<e.g.length;i++){var s=this.D(r)>>>16,o=65535&this.D(r),a=e.D(i)>>>16,c=65535&e.D(i);n[2*r+2*i]+=o*c,Do(n,2*r+2*i),n[2*r+2*i+1]+=s*c,Do(n,2*r+2*i+1),n[2*r+2*i+1]+=o*a,Do(n,2*r+2*i+1),n[2*r+2*i+2]+=s*a,Do(n,2*r+2*i+2)}for(r=0;r<t;r++)n[r]=n[2*r+1]<<16|n[2*r];for(r=t;r<2*t;r++)n[r]=0;return new vo(n,0)},Cn.gb=function(e){return Lo(this,e).h},Cn.and=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.D(r)&e.D(r);return new vo(n,this.h&e.h)},Cn.or=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.D(r)|e.D(r);return new vo(n,this.h|e.h)},Cn.xor=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.D(r)^e.D(r);return new vo(n,this.h^e.h)},lo.prototype.createWebChannel=lo.prototype.g,ho.prototype.send=ho.prototype.u,ho.prototype.open=ho.prototype.m,ho.prototype.close=ho.prototype.close,mi.NO_ERROR=0,mi.TIMEOUT=8,mi.HTTP_ERROR=6,gi.COMPLETE="complete",wi.EventType=_i,_i.OPEN="a",_i.CLOSE="b",_i.ERROR="c",_i.MESSAGE="d",xr.prototype.listen=xr.prototype.O,Ds.prototype.listenOnce=Ds.prototype.P,Ds.prototype.getLastError=Ds.prototype.Sa,Ds.prototype.getLastErrorCode=Ds.prototype.Ia,Ds.prototype.getStatus=Ds.prototype.da,Ds.prototype.getResponseJson=Ds.prototype.Wa,Ds.prototype.getResponseText=Ds.prototype.ja,Ds.prototype.send=Ds.prototype.ha,Ds.prototype.setWithCredentials=Ds.prototype.Oa,go.prototype.digest=go.prototype.l,go.prototype.reset=go.prototype.reset,go.prototype.update=go.prototype.j,vo.prototype.add=vo.prototype.add,vo.prototype.multiply=vo.prototype.R,vo.prototype.modulo=vo.prototype.gb,vo.prototype.compare=vo.prototype.X,vo.prototype.toNumber=vo.prototype.ea,vo.prototype.toString=vo.prototype.toString,vo.prototype.getBits=vo.prototype.D,vo.fromNumber=_o,vo.fromString=function e(t,n){if(0==t.length)throw Error("number format error: empty string");if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if("-"==t.charAt(0))return ko(e(t.substring(1),n));if(0<=t.indexOf("-"))throw Error('number format error: interior "-" character');for(var r=_o(Math.pow(n,8)),i=bo,s=0;s<t.length;s+=8){var o=Math.min(8,t.length-s),a=parseInt(t.substring(s,s+o),n);8>o?(o=_o(Math.pow(n,o)),i=i.R(o).add(_o(a))):i=(i=i.R(r)).add(_o(a))}return i};var xo=kn.createWebChannelTransport=function(){return new lo},Mo=kn.getStatEventTarget=function(){return ci()},Uo=kn.ErrorCode=mi,Fo=kn.EventType=gi,Vo=kn.Event=oi,Bo=kn.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},jo=(kn.FetchXmlHttpFactory=bs,kn.WebChannel=wi),zo=kn.XhrIo=Ds,qo=kn.Md5=go,$o=kn.Integer=vo;const Ho="@firebase/firestore";class Go{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Go.UNAUTHENTICATED=new Go(null),Go.GOOGLE_CREDENTIALS=new Go("google-credentials-uid"),Go.FIRST_PARTY=new Go("first-party-uid"),Go.MOCK_USER=new Go("mock-user");let Ko="10.8.0";const Wo=new P("@firebase/firestore");function Qo(){return Wo.logLevel}function Xo(e,...t){if(Wo.logLevel<=N.DEBUG){const n=t.map(Zo);Wo.debug(`Firestore (${Ko}): ${e}`,...n)}}function Yo(e,...t){if(Wo.logLevel<=N.ERROR){const n=t.map(Zo);Wo.error(`Firestore (${Ko}): ${e}`,...n)}}function Jo(e,...t){if(Wo.logLevel<=N.WARN){const n=t.map(Zo);Wo.warn(`Firestore (${Ko}): ${e}`,...n)}}function Zo(e){if("string"==typeof e)return e;try{return function(e){return JSON.stringify(e)}(e)}catch(t){return e}}function ea(e="Unexpected state"){const t=`FIRESTORE (${Ko}) INTERNAL ASSERTION FAILED: `+e;throw Yo(t),new Error(t)}function ta(e,t){e||ea()}function na(e,t){return e}const ra={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class ia extends f{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class sa{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}class oa{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class aa{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(Go.UNAUTHENTICATED)))}shutdown(){}}class ca{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class ua{constructor(e){this.t=e,this.currentUser=Go.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){let n=this.i;const r=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve();let i=new sa;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new sa,e.enqueueRetryable((()=>r(this.currentUser)))};const s=()=>{const t=i;e.enqueueRetryable((async()=>{await t.promise,await r(this.currentUser)}))},o=e=>{Xo("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.auth.addAuthTokenListener(this.o),s()};this.t.onInit((e=>o(e))),setTimeout((()=>{if(!this.auth){const e=this.t.getImmediate({optional:!0});e?o(e):(Xo("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new sa)}}),0),s()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((t=>this.i!==e?(Xo("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(ta("string"==typeof t.accessToken),new oa(t.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return ta(null===e||"string"==typeof e),new Go(e)}}class la{constructor(e,t,n){this.l=e,this.h=t,this.P=n,this.type="FirstParty",this.user=Go.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class ha{constructor(e,t,n){this.l=e,this.h=t,this.P=n}getToken(){return Promise.resolve(new la(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable((()=>t(Go.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class da{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class fa{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){const n=e=>{null!=e.error&&Xo("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);const n=e.token!==this.R;return this.R=e.token,Xo("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable((()=>n(t)))};const r=e=>{Xo("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.appCheck.addTokenListener(this.o)};this.A.onInit((e=>r(e))),setTimeout((()=>{if(!this.appCheck){const e=this.A.getImmediate({optional:!0});e?r(e):Xo("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((e=>e?(ta("string"==typeof e.token),this.R=e.token,new da(e.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function pa(e){const t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let t=0;t<e;t++)n[t]=Math.floor(256*Math.random());return n}class ma{static newId(){const e=62*Math.floor(256/62);let t="";for(;t.length<20;){const n=pa(40);for(let r=0;r<n.length;++r)t.length<20&&n[r]<e&&(t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(n[r]%62))}return t}}function ga(e,t){return e<t?-1:e>t?1:0}function ya(e,t,n){return e.length===t.length&&e.every(((e,r)=>n(e,t[r])))}class va{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new ia(ra.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new ia(ra.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new ia(ra.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new ia(ra.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return va.fromMillis(Date.now())}static fromDate(e){return va.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new va(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?ga(this.nanoseconds,e.nanoseconds):ga(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class wa{constructor(e){this.timestamp=e}static fromTimestamp(e){return new wa(e)}static min(){return new wa(new va(0,0))}static max(){return new wa(new va(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class Ea{constructor(e,t,n){void 0===t?t=0:t>e.length&&ea(),void 0===n?n=e.length-t:n>e.length-t&&ea(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===Ea.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Ea?e.forEach((e=>{t.push(e)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let r=0;r<n;r++){const n=e.get(r),i=t.get(r);if(n<i)return-1;if(n>i)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class _a extends Ea{construct(e,t,n){return new _a(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new ia(ra.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter((e=>e.length>0)))}return new _a(t)}static emptyPath(){return new _a([])}}const Ta=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class ba extends Ea{construct(e,t,n){return new ba(e,t,n)}static isValidIdentifier(e){return Ta.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),ba.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new ba(["__name__"])}static fromServerFormat(e){const t=[];let n="",r=0;const i=()=>{if(0===n.length)throw new ia(ra.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let s=!1;for(;r<e.length;){const t=e[r];if("\\"===t){if(r+1===e.length)throw new ia(ra.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[r+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new ia(ra.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,r+=2}else"`"===t?(s=!s,r++):"."!==t||s?(n+=t,r++):(i(),r++)}if(i(),s)throw new ia(ra.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new ba(t)}static emptyPath(){return new ba([])}}class Ia{constructor(e){this.path=e}static fromPath(e){return new Ia(_a.fromString(e))}static fromName(e){return new Ia(_a.fromString(e).popFirst(5))}static empty(){return new Ia(_a.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===_a.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return _a.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Ia(new _a(e.slice()))}}function Sa(e){return new Ca(e.readTime,e.key,-1)}class Ca{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new Ca(wa.min(),Ia.empty(),-1)}static max(){return new Ca(wa.max(),Ia.empty(),-1)}}function Aa(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n?n:(n=Ia.comparator(e.documentKey,t.documentKey),0!==n?n:ga(e.largestBatchId,t.largestBatchId))}const ka="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Na{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}async function Da(e){if(e.code!==ra.FAILED_PRECONDITION||e.message!==ka)throw e;Xo("LocalStore","Unexpectedly lost primary lease")}class Ra{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)}),(e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&ea(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new Ra(((n,r)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,r)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,r)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof Ra?t:Ra.resolve(t)}catch(e){return Ra.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):Ra.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):Ra.reject(t)}static resolve(e){return new Ra(((t,n)=>{t(e)}))}static reject(e){return new Ra(((t,n)=>{n(e)}))}static waitFor(e){return new Ra(((t,n)=>{let r=0,i=0,s=!1;e.forEach((e=>{++r,e.next((()=>{++i,s&&i===r&&t()}),(e=>n(e)))})),s=!0,i===r&&t()}))}static or(e){let t=Ra.resolve(!1);for(const n of e)t=t.next((e=>e?Ra.resolve(e):n()));return t}static forEach(e,t){const n=[];return e.forEach(((e,r)=>{n.push(t.call(this,e,r))})),this.waitFor(n)}static mapArray(e,t){return new Ra(((n,r)=>{const i=e.length,s=new Array(i);let o=0;for(let a=0;a<i;a++){const c=a;t(e[c]).next((e=>{s[c]=e,++o,o===i&&n(s)}),(e=>r(e)))}}))}static doWhile(e,t){return new Ra(((n,r)=>{const i=()=>{!0===e()?t().next((()=>{i()}),r):n()};i()}))}}class La{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.V=new sa,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{t.error?this.V.reject(new xa(e,t.error)):this.V.resolve()},this.transaction.onerror=t=>{const n=Ba(t.target.error);this.V.reject(new xa(e,n))}}static open(e,t,n,r){try{return new La(t,e.transaction(r,n))}catch(e){throw new xa(t,e)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(Xo("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){const e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){const t=this.transaction.objectStore(e);return new Ua(t)}}class Oa{constructor(e,t,n){this.name=e,this.version=t,this.p=n,12.2===Oa.S(h())&&Yo("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return Xo("SimpleDb","Removing database:",e),Fa(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!d())return!1;if(Oa.C())return!0;const e=h(),t=Oa.S(e),n=0<t&&t<10,r=Oa.v(e),i=0<r&&r<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||n||i)}static C(){var e;return"undefined"!=typeof process&&"YES"===(null===(e=process.__PRIVATE_env)||void 0===e?void 0:e.F)}static M(e,t){return e.store(t)}static S(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)}static v(e){const t=e.match(/Android ([\d.]+)/i),n=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(n)}async O(e){return this.db||(Xo("SimpleDb","Opening database:",this.name),this.db=await new Promise(((t,n)=>{const r=indexedDB.open(this.name,this.version);r.onsuccess=e=>{const n=e.target.result;t(n)},r.onblocked=()=>{n(new xa(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=t=>{const r=t.target.error;"VersionError"===r.name?n(new ia(ra.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===r.name?n(new ia(ra.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+r)):n(new xa(e,r))},r.onupgradeneeded=e=>{Xo("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',e.oldVersion);const t=e.target.result;this.p.N(t,r.transaction,e.oldVersion,this.version).next((()=>{Xo("SimpleDb","Database upgrade to version "+this.version+" complete")}))}}))),this.B&&(this.db.onversionchange=e=>this.B(e)),this.db}L(e){this.B=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,n,r){const i="readonly"===t;let s=0;for(;;){++s;try{this.db=await this.O(e);const t=La.open(this.db,e,i?"readonly":"readwrite",n),s=r(t).next((e=>(t.g(),e))).catch((e=>(t.abort(e),Ra.reject(e)))).toPromise();return s.catch((()=>{})),await t.m,s}catch(e){const t=e,n="FirebaseError"!==t.name&&s<3;if(Xo("SimpleDb","Transaction failed with error:",t.message,"Retrying:",n),this.close(),!n)return Promise.reject(t)}}}close(){this.db&&this.db.close(),this.db=void 0}}class Pa{constructor(e){this.k=e,this.q=!1,this.K=null}get isDone(){return this.q}get $(){return this.K}set cursor(e){this.k=e}done(){this.q=!0}U(e){this.K=e}delete(){return Fa(this.k.delete())}}class xa extends ia{constructor(e,t){super(ra.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function Ma(e){return"IndexedDbTransactionError"===e.name}class Ua{constructor(e){this.store=e}put(e,t){let n;return void 0!==t?(Xo("SimpleDb","PUT",this.store.name,e,t),n=this.store.put(t,e)):(Xo("SimpleDb","PUT",this.store.name,"<auto-key>",e),n=this.store.put(e)),Fa(n)}add(e){return Xo("SimpleDb","ADD",this.store.name,e,e),Fa(this.store.add(e))}get(e){return Fa(this.store.get(e)).next((t=>(void 0===t&&(t=null),Xo("SimpleDb","GET",this.store.name,e,t),t)))}delete(e){return Xo("SimpleDb","DELETE",this.store.name,e),Fa(this.store.delete(e))}count(){return Xo("SimpleDb","COUNT",this.store.name),Fa(this.store.count())}W(e,t){const n=this.options(e,t),r=n.index?this.store.index(n.index):this.store;if("function"==typeof r.getAll){const e=r.getAll(n.range);return new Ra(((t,n)=>{e.onerror=e=>{n(e.target.error)},e.onsuccess=e=>{t(e.target.result)}}))}{const e=this.cursor(n),t=[];return this.G(e,((e,n)=>{t.push(n)})).next((()=>t))}}j(e,t){const n=this.store.getAll(e,null===t?void 0:t);return new Ra(((e,t)=>{n.onerror=e=>{t(e.target.error)},n.onsuccess=t=>{e(t.target.result)}}))}H(e,t){Xo("SimpleDb","DELETE ALL",this.store.name);const n=this.options(e,t);n.J=!1;const r=this.cursor(n);return this.G(r,((e,t,n)=>n.delete()))}Y(e,t){let n;t?n=e:(n={},t=e);const r=this.cursor(n);return this.G(r,t)}Z(e){const t=this.cursor({});return new Ra(((n,r)=>{t.onerror=e=>{const t=Ba(e.target.error);r(t)},t.onsuccess=t=>{const r=t.target.result;r?e(r.primaryKey,r.value).next((e=>{e?r.continue():n()})):n()}}))}G(e,t){const n=[];return new Ra(((r,i)=>{e.onerror=e=>{i(e.target.error)},e.onsuccess=e=>{const i=e.target.result;if(!i)return void r();const s=new Pa(i),o=t(i.primaryKey,i.value,s);if(o instanceof Ra){const e=o.catch((e=>(s.done(),Ra.reject(e))));n.push(e)}s.isDone?r():null===s.$?i.continue():i.continue(s.$)}})).next((()=>Ra.waitFor(n)))}options(e,t){let n;return void 0!==e&&("string"==typeof e?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const n=this.store.index(e.index);return e.J?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function Fa(e){return new Ra(((t,n)=>{e.onsuccess=e=>{const n=e.target.result;t(n)},e.onerror=e=>{const t=Ba(e.target.error);n(t)}}))}let Va=!1;function Ba(e){const t=Oa.S(h());if(t>=12.2&&t<13){const t="An internal error was encountered in the Indexed Database server";if(e.message.indexOf(t)>=0){const e=new ia("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Va||(Va=!0,setTimeout((()=>{throw e}),0)),e}}return e}class ja{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.se(e),this.oe=e=>t.writeSequenceNumber(e))}se(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.oe&&this.oe(e),e}}function za(e){return null==e}function qa(e){return 0===e&&1/e==-1/0}ja._e=-1;function $a(e){let t=0;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function Ha(e,t){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function Ga(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class Ka{constructor(e,t){this.comparator=e,this.root=t||Qa.EMPTY}insert(e,t){return new Ka(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Qa.BLACK,null,null))}remove(e){return new Ka(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Qa.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(0===r)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,n)=>(e(t,n),!1)))}toString(){const e=[];return this.inorderTraversal(((t,n)=>(e.push(`${t}:${n}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Wa(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Wa(this.root,e,this.comparator,!1)}getReverseIterator(){return new Wa(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Wa(this.root,e,this.comparator,!0)}}class Wa{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,t&&r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Qa{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:Qa.RED,this.left=null!=r?r:Qa.EMPTY,this.right=null!=i?i:Qa.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,i){return new Qa(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;const i=n(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return Qa.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return Qa.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Qa.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Qa.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw ea();if(this.right.isRed())throw ea();const e=this.left.check();if(e!==this.right.check())throw ea();return e+(this.isRed()?0:1)}}Qa.EMPTY=null,Qa.RED=!0,Qa.BLACK=!1,Qa.EMPTY=new class{constructor(){this.size=0}get key(){throw ea()}get value(){throw ea()}get color(){throw ea()}get left(){throw ea()}get right(){throw ea()}copy(e,t,n,r,i){return this}insert(e,t,n){return new Qa(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Xa{constructor(e){this.comparator=e,this.data=new Ka(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,n)=>(e(t),!1)))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Ya(this.data.getIterator())}getIteratorFrom(e){return new Ya(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((e=>{t=t.add(e)})),t}isEqual(e){if(!(e instanceof Xa))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(0!==this.comparator(e,r))return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new Xa(this.comparator);return t.data=e,t}}class Ya{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class Ja{constructor(e){this.fields=e,e.sort(ba.comparator)}static empty(){return new Ja([])}unionWith(e){let t=new Xa(ba.comparator);for(const e of this.fields)t=t.add(e);for(const n of e)t=t.add(n);return new Ja(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return ya(this.fields,e.fields,((e,t)=>e.isEqual(t)))}}class Za extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class ec{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(e){try{return atob(e)}catch(e){throw"undefined"!=typeof DOMException&&e instanceof DOMException?new Za("Invalid base64 string: "+e):e}}(e);return new ec(t)}static fromUint8Array(e){const t=function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e);return new ec(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return ga(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}ec.EMPTY_BYTE_STRING=new ec("");const tc=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function nc(e){if(ta(!!e),"string"==typeof e){let t=0;const n=tc.exec(e);if(ta(!!n),n[1]){let e=n[1];e=(e+"000000000").substr(0,9),t=Number(e)}const r=new Date(e);return{seconds:Math.floor(r.getTime()/1e3),nanos:t}}return{seconds:rc(e.seconds),nanos:rc(e.nanos)}}function rc(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function ic(e){return"string"==typeof e?ec.fromBase64String(e):ec.fromUint8Array(e)}function sc(e){var t,n;return"server_timestamp"===(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function oc(e){const t=e.mapValue.fields.__previous_value__;return sc(t)?oc(t):t}function ac(e){const t=nc(e.mapValue.fields.__local_write_time__.timestampValue);return new va(t.seconds,t.nanos)}class cc{constructor(e,t,n,r,i,s,o,a,c){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=o,this.longPollingOptions=a,this.useFetchStreams=c}}class uc{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new uc("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof uc&&e.projectId===this.projectId&&e.database===this.database}}const lc={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function hc(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?sc(e)?4:Sc(e)?9007199254740991:10:ea()}function dc(e,t){if(e===t)return!0;const n=hc(e);if(n!==hc(t))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return ac(e).isEqual(ac(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;const n=nc(e.timestampValue),r=nc(t.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return function(e,t){return ic(e.bytesValue).isEqual(ic(t.bytesValue))}(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return rc(e.geoPointValue.latitude)===rc(t.geoPointValue.latitude)&&rc(e.geoPointValue.longitude)===rc(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return rc(e.integerValue)===rc(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){const n=rc(e.doubleValue),r=rc(t.doubleValue);return n===r?qa(n)===qa(r):isNaN(n)&&isNaN(r)}return!1}(e,t);case 9:return ya(e.arrayValue.values||[],t.arrayValue.values||[],dc);case 10:return function(e,t){const n=e.mapValue.fields||{},r=t.mapValue.fields||{};if($a(n)!==$a(r))return!1;for(const e in n)if(n.hasOwnProperty(e)&&(void 0===r[e]||!dc(n[e],r[e])))return!1;return!0}(e,t);default:return ea()}}function fc(e,t){return void 0!==(e.values||[]).find((e=>dc(e,t)))}function pc(e,t){if(e===t)return 0;const n=hc(e),r=hc(t);if(n!==r)return ga(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return ga(e.booleanValue,t.booleanValue);case 2:return function(e,t){const n=rc(e.integerValue||e.doubleValue),r=rc(t.integerValue||t.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(e,t);case 3:return mc(e.timestampValue,t.timestampValue);case 4:return mc(ac(e),ac(t));case 5:return ga(e.stringValue,t.stringValue);case 6:return function(e,t){const n=ic(e),r=ic(t);return n.compareTo(r)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){const n=e.split("/"),r=t.split("/");for(let e=0;e<n.length&&e<r.length;e++){const t=ga(n[e],r[e]);if(0!==t)return t}return ga(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){const n=ga(rc(e.latitude),rc(t.latitude));return 0!==n?n:ga(rc(e.longitude),rc(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return function(e,t){const n=e.values||[],r=t.values||[];for(let e=0;e<n.length&&e<r.length;++e){const t=pc(n[e],r[e]);if(t)return t}return ga(n.length,r.length)}(e.arrayValue,t.arrayValue);case 10:return function(e,t){if(e===lc.mapValue&&t===lc.mapValue)return 0;if(e===lc.mapValue)return 1;if(t===lc.mapValue)return-1;const n=e.fields||{},r=Object.keys(n),i=t.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let e=0;e<r.length&&e<s.length;++e){const t=ga(r[e],s[e]);if(0!==t)return t;const o=pc(n[r[e]],i[s[e]]);if(0!==o)return o}return ga(r.length,s.length)}(e.mapValue,t.mapValue);default:throw ea()}}function mc(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return ga(e,t);const n=nc(e),r=nc(t),i=ga(n.seconds,r.seconds);return 0!==i?i:ga(n.nanos,r.nanos)}function gc(e){return yc(e)}function yc(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){const t=nc(e);return`time(${t.seconds},${t.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?function(e){return ic(e).toBase64()}(e.bytesValue):"referenceValue"in e?function(e){return Ia.fromName(e).toString()}(e.referenceValue):"geoPointValue"in e?function(e){return`geo(${e.latitude},${e.longitude})`}(e.geoPointValue):"arrayValue"in e?function(e){let t="[",n=!0;for(const r of e.values||[])n?n=!1:t+=",",t+=yc(r);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){const t=Object.keys(e.fields||{}).sort();let n="{",r=!0;for(const i of t)r?r=!1:n+=",",n+=`${i}:${yc(e.fields[i])}`;return n+"}"}(e.mapValue):ea()}function vc(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function wc(e){return!!e&&"integerValue"in e}function Ec(e){return!!e&&"arrayValue"in e}function _c(e){return!!e&&"nullValue"in e}function Tc(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function bc(e){return!!e&&"mapValue"in e}function Ic(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){const t={mapValue:{fields:{}}};return Ha(e.mapValue.fields,((e,n)=>t.mapValue.fields[e]=Ic(n))),t}if(e.arrayValue){const t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=Ic(e.arrayValue.values[n]);return t}return Object.assign({},e)}function Sc(e){return"__max__"===(((e.mapValue||{}).fields||{}).__type__||{}).stringValue}class Cc{constructor(e){this.value=e}static empty(){return new Cc({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!bc(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Ic(t)}setAll(e){let t=ba.emptyPath(),n={},r=[];e.forEach(((e,i)=>{if(!t.isImmediateParentOf(i)){const e=this.getFieldsMap(t);this.applyChanges(e,n,r),n={},r=[],t=i.popLast()}e?n[i.lastSegment()]=Ic(e):r.push(i.lastSegment())}));const i=this.getFieldsMap(t);this.applyChanges(i,n,r)}delete(e){const t=this.field(e.popLast());bc(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return dc(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let r=t.mapValue.fields[e.get(n)];bc(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,n){Ha(t,((t,n)=>e[t]=n));for(const t of n)delete e[t]}clone(){return new Cc(Ic(this.value))}}function Ac(e){const t=[];return Ha(e.fields,((e,n)=>{const r=new ba([e]);if(bc(n)){const e=Ac(n.mapValue).fields;if(0===e.length)t.push(r);else for(const n of e)t.push(r.child(n))}else t.push(r)})),new Ja(t)}class kc{constructor(e,t,n,r,i,s,o){this.key=e,this.documentType=t,this.version=n,this.readTime=r,this.createTime=i,this.data=s,this.documentState=o}static newInvalidDocument(e){return new kc(e,0,wa.min(),wa.min(),wa.min(),Cc.empty(),0)}static newFoundDocument(e,t,n,r){return new kc(e,1,t,wa.min(),n,r,0)}static newNoDocument(e,t){return new kc(e,2,t,wa.min(),wa.min(),Cc.empty(),0)}static newUnknownDocument(e,t){return new kc(e,3,t,wa.min(),wa.min(),Cc.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(wa.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Cc.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Cc.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=wa.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof kc&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new kc(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Nc{constructor(e,t){this.position=e,this.inclusive=t}}function Dc(e,t,n){let r=0;for(let i=0;i<e.position.length;i++){const s=t[i],o=e.position[i];if(r=s.field.isKeyField()?Ia.comparator(Ia.fromName(o.referenceValue),n.key):pc(o,n.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function Rc(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!dc(e.position[n],t.position[n]))return!1;return!0}class Lc{constructor(e,t="asc"){this.field=e,this.dir=t}}function Oc(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}class Pc{}class xc extends Pc{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new zc(e,t,n):"array-contains"===t?new Gc(e,n):"in"===t?new Kc(e,n):"not-in"===t?new Wc(e,n):"array-contains-any"===t?new Qc(e,n):new xc(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new qc(e,n):new $c(e,n)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(pc(t,this.value)):null!==t&&hc(this.value)===hc(t)&&this.matchesComparison(pc(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return ea()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Mc extends Pc{constructor(e,t){super(),this.filters=e,this.op=t,this.ue=null}static create(e,t){return new Mc(e,t)}matches(e){return Uc(this)?void 0===this.filters.find((t=>!t.matches(e))):void 0!==this.filters.find((t=>t.matches(e)))}getFlattenedFilters(){return null!==this.ue||(this.ue=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.ue}getFilters(){return Object.assign([],this.filters)}}function Uc(e){return"and"===e.op}function Fc(e){return function(e){for(const t of e.filters)if(t instanceof Mc)return!1;return!0}(e)&&Uc(e)}function Vc(e){if(e instanceof xc)return e.field.canonicalString()+e.op.toString()+gc(e.value);if(Fc(e))return e.filters.map((e=>Vc(e))).join(",");{const t=e.filters.map((e=>Vc(e))).join(",");return`${e.op}(${t})`}}function Bc(e,t){return e instanceof xc?function(e,t){return t instanceof xc&&e.op===t.op&&e.field.isEqual(t.field)&&dc(e.value,t.value)}(e,t):e instanceof Mc?function(e,t){return t instanceof Mc&&e.op===t.op&&e.filters.length===t.filters.length&&e.filters.reduce(((e,n,r)=>e&&Bc(n,t.filters[r])),!0)}(e,t):void ea()}function jc(e){return e instanceof xc?function(e){return`${e.field.canonicalString()} ${e.op} ${gc(e.value)}`}(e):e instanceof Mc?function(e){return e.op.toString()+" {"+e.getFilters().map(jc).join(" ,")+"}"}(e):"Filter"}class zc extends xc{constructor(e,t,n){super(e,t,n),this.key=Ia.fromName(n.referenceValue)}matches(e){const t=Ia.comparator(e.key,this.key);return this.matchesComparison(t)}}class qc extends xc{constructor(e,t){super(e,"in",t),this.keys=Hc(0,t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class $c extends xc{constructor(e,t){super(e,"not-in",t),this.keys=Hc(0,t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function Hc(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map((e=>Ia.fromName(e.referenceValue)))}class Gc extends xc{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Ec(t)&&fc(t.arrayValue,this.value)}}class Kc extends xc{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&fc(this.value.arrayValue,t)}}class Wc extends xc{constructor(e,t){super(e,"not-in",t)}matches(e){if(fc(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!fc(this.value.arrayValue,t)}}class Qc extends xc{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Ec(t)||!t.arrayValue.values)&&t.arrayValue.values.some((e=>fc(this.value.arrayValue,e)))}}class Xc{constructor(e,t=null,n=[],r=[],i=null,s=null,o=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=s,this.endAt=o,this.ce=null}}function Yc(e,t=null,n=[],r=[],i=null,s=null,o=null){return new Xc(e,t,n,r,i,s,o)}function Jc(e){const t=na(e);if(null===t.ce){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map((e=>Vc(e))).join(","),e+="|ob:",e+=t.orderBy.map((e=>function(e){return e.field.canonicalString()+e.dir}(e))).join(","),za(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((e=>gc(e))).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((e=>gc(e))).join(",")),t.ce=e}return t.ce}function Zc(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(let n=0;n<e.orderBy.length;n++)if(!Oc(e.orderBy[n],t.orderBy[n]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let n=0;n<e.filters.length;n++)if(!Bc(e.filters[n],t.filters[n]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!Rc(e.startAt,t.startAt)&&Rc(e.endAt,t.endAt)}function eu(e){return Ia.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}class tu{constructor(e,t=null,n=[],r=[],i=null,s="F",o=null,a=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=s,this.startAt=o,this.endAt=a,this.le=null,this.he=null,this.Pe=null,this.startAt,this.endAt}}function nu(e){return new tu(e)}function ru(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function iu(e){return null!==e.collectionGroup}function su(e){const t=na(e);if(null===t.le){t.le=[];const e=new Set;for(const n of t.explicitOrderBy)t.le.push(n),e.add(n.field.canonicalString());const n=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc",r=function(e){let t=new Xa(ba.comparator);return e.filters.forEach((e=>{e.getFlattenedFilters().forEach((e=>{e.isInequality()&&(t=t.add(e.field))}))})),t}(t);r.forEach((r=>{e.has(r.canonicalString())||r.isKeyField()||t.le.push(new Lc(r,n))})),e.has(ba.keyField().canonicalString())||t.le.push(new Lc(ba.keyField(),n))}return t.le}function ou(e){const t=na(e);return t.he||(t.he=function(e,t){if("F"===e.limitType)return Yc(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map((e=>{const t="desc"===e.dir?"asc":"desc";return new Lc(e.field,t)}));const n=e.endAt?new Nc(e.endAt.position,e.endAt.inclusive):null,r=e.startAt?new Nc(e.startAt.position,e.startAt.inclusive):null;return Yc(e.path,e.collectionGroup,t,e.filters,e.limit,n,r)}}(t,su(e))),t.he}function au(e,t){const n=e.filters.concat([t]);return new tu(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}function cu(e,t,n){return new tu(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function uu(e,t){return Zc(ou(e),ou(t))&&e.limitType===t.limitType}function lu(e){return`${Jc(ou(e))}|lt:${e.limitType}`}function hu(e){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map((e=>jc(e))).join(", ")}]`),za(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map((e=>function(e){return`${e.field.canonicalString()} (${e.dir})`}(e))).join(", ")}]`),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((e=>gc(e))).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((e=>gc(e))).join(",")),`Target(${t})`}(ou(e))}; limitType=${e.limitType})`}function du(e,t){return t.isFoundDocument()&&function(e,t){const n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):Ia.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){for(const n of su(e))if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(const n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&function(e,t){return!(e.startAt&&!function(e,t,n){const r=Dc(e,t,n);return e.inclusive?r<=0:r<0}(e.startAt,su(e),t)||e.endAt&&!function(e,t,n){const r=Dc(e,t,n);return e.inclusive?r>=0:r>0}(e.endAt,su(e),t))}(e,t)}function fu(e){return(t,n)=>{let r=!1;for(const i of su(e)){const e=pu(i,t,n);if(0!==e)return e;r=r||i.field.isKeyField()}return 0}}function pu(e,t,n){const r=e.field.isKeyField()?Ia.comparator(t.key,n.key):function(e,t,n){const r=t.data.field(e),i=n.data.field(e);return null!==r&&null!==i?pc(r,i):ea()}(e.field,t,n);switch(e.dir){case"asc":return r;case"desc":return-1*r;default:return ea()}}class mu{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[t,r]of n)if(this.equalsFn(t,e))return r}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),r=this.inner[n];if(void 0===r)return this.inner[n]=[[e,t]],void this.innerSize++;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],e))return void(r[n]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(e){Ha(this.inner,((t,n)=>{for(const[t,r]of n)e(t,r)}))}isEmpty(){return Ga(this.inner)}size(){return this.innerSize}}const gu=new Ka(Ia.comparator);function yu(){return gu}const vu=new Ka(Ia.comparator);function wu(...e){let t=vu;for(const n of e)t=t.insert(n.key,n);return t}function Eu(e){let t=vu;return e.forEach(((e,n)=>t=t.insert(e,n.overlayedDocument))),t}function _u(){return bu()}function Tu(){return bu()}function bu(){return new mu((e=>e.toString()),((e,t)=>e.isEqual(t)))}const Iu=new Ka(Ia.comparator),Su=new Xa(Ia.comparator);function Cu(...e){let t=Su;for(const n of e)t=t.add(n);return t}const Au=new Xa(ga);function ku(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:qa(t)?"-0":t}}function Nu(e){return{integerValue:""+e}}function Du(e,t){return function(e){return"number"==typeof e&&Number.isInteger(e)&&!qa(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}(t)?Nu(t):ku(e,t)}class Ru{constructor(){this._=void 0}}function Lu(e,t,n){return e instanceof xu?function(e,t){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&sc(t)&&(t=oc(t)),t&&(n.fields.__previous_value__=t),{mapValue:n}}(n,t):e instanceof Mu?Uu(e,t):e instanceof Fu?Vu(e,t):function(e,t){const n=Pu(e,t),r=ju(n)+ju(e.Ie);return wc(n)&&wc(e.Ie)?Nu(r):ku(e.serializer,r)}(e,t)}function Ou(e,t,n){return e instanceof Mu?Uu(e,t):e instanceof Fu?Vu(e,t):n}function Pu(e,t){return e instanceof Bu?function(e){return wc(e)||function(e){return!!e&&"doubleValue"in e}(e)}(t)?t:{integerValue:0}:null}class xu extends Ru{}class Mu extends Ru{constructor(e){super(),this.elements=e}}function Uu(e,t){const n=zu(t);for(const t of e.elements)n.some((e=>dc(e,t)))||n.push(t);return{arrayValue:{values:n}}}class Fu extends Ru{constructor(e){super(),this.elements=e}}function Vu(e,t){let n=zu(t);for(const t of e.elements)n=n.filter((e=>!dc(e,t)));return{arrayValue:{values:n}}}class Bu extends Ru{constructor(e,t){super(),this.serializer=e,this.Ie=t}}function ju(e){return rc(e.integerValue||e.doubleValue)}function zu(e){return Ec(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class qu{constructor(e,t){this.version=e,this.transformResults=t}}class $u{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new $u}static exists(e){return new $u(void 0,e)}static updateTime(e){return new $u(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Hu(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class Gu{}function Ku(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new rl(e.key,$u.none()):new Ju(e.key,e.data,$u.none());{const n=e.data,r=Cc.empty();let i=new Xa(ba.comparator);for(let e of t.fields)if(!i.has(e)){let t=n.field(e);null===t&&e.length>1&&(e=e.popLast(),t=n.field(e)),null===t?r.delete(e):r.set(e,t),i=i.add(e)}return new Zu(e.key,r,new Ja(i.toArray()),$u.none())}}function Wu(e,t,n){e instanceof Ju?function(e,t,n){const r=e.value.clone(),i=tl(e.fieldTransforms,t,n.transformResults);r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):e instanceof Zu?function(e,t,n){if(!Hu(e.precondition,t))return void t.convertToUnknownDocument(n.version);const r=tl(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(el(e)),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(e,t,n):function(e,t,n){t.convertToNoDocument(n.version).setHasCommittedMutations()}(0,t,n)}function Qu(e,t,n,r){return e instanceof Ju?function(e,t,n,r){if(!Hu(e.precondition,t))return n;const i=e.value.clone(),s=nl(e.fieldTransforms,r,t);return i.setAll(s),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}(e,t,n,r):e instanceof Zu?function(e,t,n,r){if(!Hu(e.precondition,t))return n;const i=nl(e.fieldTransforms,r,t),s=t.data;return s.setAll(el(e)),s.setAll(i),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null===n?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map((e=>e.field)))}(e,t,n,r):function(e,t,n){return Hu(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n}(e,t,n)}function Xu(e,t){let n=null;for(const r of e.fieldTransforms){const e=t.data.field(r.field),i=Pu(r.transform,e||null);null!=i&&(null===n&&(n=Cc.empty()),n.set(r.field,i))}return n||null}function Yu(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!function(e,t){return void 0===e&&void 0===t||!(!e||!t)&&ya(e,t,((e,t)=>function(e,t){return e.field.isEqual(t.field)&&function(e,t){return e instanceof Mu&&t instanceof Mu||e instanceof Fu&&t instanceof Fu?ya(e.elements,t.elements,dc):e instanceof Bu&&t instanceof Bu?dc(e.Ie,t.Ie):e instanceof xu&&t instanceof xu}(e.transform,t.transform)}(e,t)))}(e.fieldTransforms,t.fieldTransforms)&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class Ju extends Gu{constructor(e,t,n,r=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class Zu extends Gu{constructor(e,t,n,r,i=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function el(e){const t=new Map;return e.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const r=e.data.field(n);t.set(n,r)}})),t}function tl(e,t,n){const r=new Map;ta(e.length===n.length);for(let i=0;i<n.length;i++){const s=e[i],o=s.transform,a=t.data.field(s.field);r.set(s.field,Ou(o,a,n[i]))}return r}function nl(e,t,n){const r=new Map;for(const i of e){const e=i.transform,s=n.data.field(i.field);r.set(i.field,Lu(e,s,t))}return r}class rl extends Gu{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class il extends Gu{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class sl{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let t=0;t<this.mutations.length;t++){const r=this.mutations[t];r.key.isEqual(e.key)&&Wu(r,e,n[t])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=Qu(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=Qu(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=Tu();return this.mutations.forEach((r=>{const i=e.get(r.key),s=i.overlayedDocument;let o=this.applyToLocalView(s,i.mutatedFields);o=t.has(r.key)?null:o;const a=Ku(s,o);null!==a&&n.set(r.key,a),s.isValidDocument()||s.convertToNoDocument(wa.min())})),n}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),Cu())}isEqual(e){return this.batchId===e.batchId&&ya(this.mutations,e.mutations,((e,t)=>Yu(e,t)))&&ya(this.baseMutations,e.baseMutations,((e,t)=>Yu(e,t)))}}class ol{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(e,t,n){ta(e.mutations.length===n.length);let r=Iu;const i=e.mutations;for(let e=0;e<i.length;e++)r=r.insert(i[e].key,n[e].version);return new ol(e,t,n,r)}}class al{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class cl{constructor(e,t){this.count=e,this.unchangedNames=t}}var ul,ll;function hl(e){if(void 0===e)return Yo("GRPC error has no .code"),ra.UNKNOWN;switch(e){case ul.OK:return ra.OK;case ul.CANCELLED:return ra.CANCELLED;case ul.UNKNOWN:return ra.UNKNOWN;case ul.DEADLINE_EXCEEDED:return ra.DEADLINE_EXCEEDED;case ul.RESOURCE_EXHAUSTED:return ra.RESOURCE_EXHAUSTED;case ul.INTERNAL:return ra.INTERNAL;case ul.UNAVAILABLE:return ra.UNAVAILABLE;case ul.UNAUTHENTICATED:return ra.UNAUTHENTICATED;case ul.INVALID_ARGUMENT:return ra.INVALID_ARGUMENT;case ul.NOT_FOUND:return ra.NOT_FOUND;case ul.ALREADY_EXISTS:return ra.ALREADY_EXISTS;case ul.PERMISSION_DENIED:return ra.PERMISSION_DENIED;case ul.FAILED_PRECONDITION:return ra.FAILED_PRECONDITION;case ul.ABORTED:return ra.ABORTED;case ul.OUT_OF_RANGE:return ra.OUT_OF_RANGE;case ul.UNIMPLEMENTED:return ra.UNIMPLEMENTED;case ul.DATA_LOSS:return ra.DATA_LOSS;default:return ea()}}(ll=ul||(ul={}))[ll.OK=0]="OK",ll[ll.CANCELLED=1]="CANCELLED",ll[ll.UNKNOWN=2]="UNKNOWN",ll[ll.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ll[ll.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ll[ll.NOT_FOUND=5]="NOT_FOUND",ll[ll.ALREADY_EXISTS=6]="ALREADY_EXISTS",ll[ll.PERMISSION_DENIED=7]="PERMISSION_DENIED",ll[ll.UNAUTHENTICATED=16]="UNAUTHENTICATED",ll[ll.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ll[ll.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ll[ll.ABORTED=10]="ABORTED",ll[ll.OUT_OF_RANGE=11]="OUT_OF_RANGE",ll[ll.UNIMPLEMENTED=12]="UNIMPLEMENTED",ll[ll.INTERNAL=13]="INTERNAL",ll[ll.UNAVAILABLE=14]="UNAVAILABLE",ll[ll.DATA_LOSS=15]="DATA_LOSS";const dl=new $o([4294967295,4294967295],0);function fl(e){const t=(new TextEncoder).encode(e),n=new qo;return n.update(t),new Uint8Array(n.digest())}function pl(e){const t=new DataView(e.buffer),n=t.getUint32(0,!0),r=t.getUint32(4,!0),i=t.getUint32(8,!0),s=t.getUint32(12,!0);return[new $o([n,r],0),new $o([i,s],0)]}class ml{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new gl(`Invalid padding: ${t}`);if(n<0)throw new gl(`Invalid hash count: ${n}`);if(e.length>0&&0===this.hashCount)throw new gl(`Invalid hash count: ${n}`);if(0===e.length&&0!==t)throw new gl(`Invalid padding when bitmap length is 0: ${t}`);this.Te=8*e.length-t,this.Ee=$o.fromNumber(this.Te)}de(e,t,n){let r=e.add(t.multiply($o.fromNumber(n)));return 1===r.compare(dl)&&(r=new $o([r.getBits(0),r.getBits(1)],0)),r.modulo(this.Ee).toNumber()}Ae(e){return 0!=(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.Te)return!1;const t=fl(e),[n,r]=pl(t);for(let e=0;e<this.hashCount;e++){const t=this.de(n,r,e);if(!this.Ae(t))return!1}return!0}static create(e,t,n){const r=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),s=new ml(i,r,t);return n.forEach((e=>s.insert(e))),s}insert(e){if(0===this.Te)return;const t=fl(e),[n,r]=pl(t);for(let e=0;e<this.hashCount;e++){const t=this.de(n,r,e);this.Re(t)}}Re(e){const t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1<<n}}class gl extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class yl{constructor(e,t,n,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const r=new Map;return r.set(e,vl.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new yl(wa.min(),r,new Ka(ga),yu(),Cu())}}class vl{constructor(e,t,n,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new vl(n,t,Cu(),Cu(),Cu())}}class wl{constructor(e,t,n,r){this.Ve=e,this.removedTargetIds=t,this.key=n,this.me=r}}class El{constructor(e,t){this.targetId=e,this.fe=t}}class _l{constructor(e,t,n=ec.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class Tl{constructor(){this.ge=0,this.pe=Sl(),this.ye=ec.EMPTY_BYTE_STRING,this.we=!1,this.Se=!0}get current(){return this.we}get resumeToken(){return this.ye}get be(){return 0!==this.ge}get De(){return this.Se}Ce(e){e.approximateByteSize()>0&&(this.Se=!0,this.ye=e)}ve(){let e=Cu(),t=Cu(),n=Cu();return this.pe.forEach(((r,i)=>{switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:ea()}})),new vl(this.ye,this.we,e,t,n)}Fe(){this.Se=!1,this.pe=Sl()}Me(e,t){this.Se=!0,this.pe=this.pe.insert(e,t)}xe(e){this.Se=!0,this.pe=this.pe.remove(e)}Oe(){this.ge+=1}Ne(){this.ge-=1,ta(this.ge>=0)}Be(){this.Se=!0,this.we=!0}}class bl{constructor(e){this.Le=e,this.ke=new Map,this.qe=yu(),this.Qe=Il(),this.Ke=new Ka(ga)}$e(e){for(const t of e.Ve)e.me&&e.me.isFoundDocument()?this.Ue(t,e.me):this.We(t,e.key,e.me);for(const t of e.removedTargetIds)this.We(t,e.key,e.me)}Ge(e){this.forEachTarget(e,(t=>{const n=this.ze(t);switch(e.state){case 0:this.je(t)&&n.Ce(e.resumeToken);break;case 1:n.Ne(),n.be||n.Fe(),n.Ce(e.resumeToken);break;case 2:n.Ne(),n.be||this.removeTarget(t);break;case 3:this.je(t)&&(n.Be(),n.Ce(e.resumeToken));break;case 4:this.je(t)&&(this.He(t),n.Ce(e.resumeToken));break;default:ea()}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ke.forEach(((e,n)=>{this.je(n)&&t(n)}))}Je(e){const t=e.targetId,n=e.fe.count,r=this.Ye(t);if(r){const i=r.target;if(eu(i))if(0===n){const e=new Ia(i.path);this.We(t,e,kc.newNoDocument(e,wa.min()))}else ta(1===n);else{const r=this.Ze(t);if(r!==n){const n=this.Xe(e),i=n?this.et(n,e,r):1;if(0!==i){this.He(t);const e=2===i?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ke=this.Ke.insert(t,e)}}}}}Xe(e){const t=e.fe.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:n="",padding:r=0},hashCount:i=0}=t;let s,o;try{s=ic(n).toUint8Array()}catch(e){if(e instanceof Za)return Jo("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw e}try{o=new ml(s,r,i)}catch(e){return Jo(e instanceof gl?"BloomFilter error: ":"Applying bloom filter failed: ",e),null}return 0===o.Te?null:o}et(e,t,n){return t.fe.count===n-this.rt(e,t.targetId)?0:2}rt(e,t){const n=this.Le.getRemoteKeysForTarget(t);let r=0;return n.forEach((n=>{const i=this.Le.nt(),s=`projects/${i.projectId}/databases/${i.database}/documents/${n.path.canonicalString()}`;e.mightContain(s)||(this.We(t,n,null),r++)})),r}it(e){const t=new Map;this.ke.forEach(((n,r)=>{const i=this.Ye(r);if(i){if(n.current&&eu(i.target)){const t=new Ia(i.target.path);null!==this.qe.get(t)||this.st(r,t)||this.We(r,t,kc.newNoDocument(t,e))}n.De&&(t.set(r,n.ve()),n.Fe())}}));let n=Cu();this.Qe.forEach(((e,t)=>{let r=!0;t.forEachWhile((e=>{const t=this.Ye(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(r=!1,!1)})),r&&(n=n.add(e))})),this.qe.forEach(((t,n)=>n.setReadTime(e)));const r=new yl(e,t,this.Ke,this.qe,n);return this.qe=yu(),this.Qe=Il(),this.Ke=new Ka(ga),r}Ue(e,t){if(!this.je(e))return;const n=this.st(e,t.key)?2:0;this.ze(e).Me(t.key,n),this.qe=this.qe.insert(t.key,t),this.Qe=this.Qe.insert(t.key,this.ot(t.key).add(e))}We(e,t,n){if(!this.je(e))return;const r=this.ze(e);this.st(e,t)?r.Me(t,1):r.xe(t),this.Qe=this.Qe.insert(t,this.ot(t).delete(e)),n&&(this.qe=this.qe.insert(t,n))}removeTarget(e){this.ke.delete(e)}Ze(e){const t=this.ze(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Oe(e){this.ze(e).Oe()}ze(e){let t=this.ke.get(e);return t||(t=new Tl,this.ke.set(e,t)),t}ot(e){let t=this.Qe.get(e);return t||(t=new Xa(ga),this.Qe=this.Qe.insert(e,t)),t}je(e){const t=null!==this.Ye(e);return t||Xo("WatchChangeAggregator","Detected inactive target",e),t}Ye(e){const t=this.ke.get(e);return t&&t.be?null:this.Le._t(e)}He(e){this.ke.set(e,new Tl),this.Le.getRemoteKeysForTarget(e).forEach((t=>{this.We(e,t,null)}))}st(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}function Il(){return new Ka(Ia.comparator)}function Sl(){return new Ka(Ia.comparator)}const Cl={asc:"ASCENDING",desc:"DESCENDING"},Al={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},kl={and:"AND",or:"OR"};class Nl{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function Dl(e,t){return e.useProto3Json||za(t)?t:{value:t}}function Rl(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function Ll(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function Ol(e,t){return Rl(e,t.toTimestamp())}function Pl(e){return ta(!!e),wa.fromTimestamp(function(e){const t=nc(e);return new va(t.seconds,t.nanos)}(e))}function xl(e,t){return Ml(e,t).canonicalString()}function Ml(e,t){const n=function(e){return new _a(["projects",e.projectId,"databases",e.database])}(e).child("documents");return void 0===t?n:n.child(t)}function Ul(e){const t=_a.fromString(e);return ta(th(t)),t}function Fl(e,t){return xl(e.databaseId,t.path)}function Vl(e,t){const n=Ul(t);if(n.get(1)!==e.databaseId.projectId)throw new ia(ra.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new ia(ra.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new Ia(zl(n))}function Bl(e,t){return xl(e.databaseId,t)}function jl(e){return new _a(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function zl(e){return ta(e.length>4&&"documents"===e.get(4)),e.popFirst(5)}function ql(e,t,n){return{name:Fl(e,t),fields:n.value.mapValue.fields}}function $l(e,t){return{documents:[Bl(e,t.path)]}}function Hl(e,t){const n={structuredQuery:{}},r=t.path;let i;null!==t.collectionGroup?(i=r,n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(i=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),n.parent=Bl(e,i);const s=function(e){if(0!==e.length)return Zl(Mc.create(e,"and"))}(t.filters);s&&(n.structuredQuery.where=s);const o=function(e){if(0!==e.length)return e.map((e=>function(e){return{field:Yl(e.field),direction:Wl(e.dir)}}(e)))}(t.orderBy);o&&(n.structuredQuery.orderBy=o);const a=Dl(e,t.limit);return null!==a&&(n.structuredQuery.limit=a),t.startAt&&(n.structuredQuery.startAt=function(e){return{before:e.inclusive,values:e.position}}(t.startAt)),t.endAt&&(n.structuredQuery.endAt=function(e){return{before:!e.inclusive,values:e.position}}(t.endAt)),{ut:n,parent:i}}function Gl(e){let t=function(e){const t=Ul(e);return 4===t.length?_a.emptyPath():zl(t)}(e.parent);const n=e.structuredQuery,r=n.from?n.from.length:0;let i=null;if(r>0){ta(1===r);const e=n.from[0];e.allDescendants?i=e.collectionId:t=t.child(e.collectionId)}let s=[];n.where&&(s=function(e){const t=Kl(e);return t instanceof Mc&&Fc(t)?t.getFilters():[t]}(n.where));let o=[];n.orderBy&&(o=function(e){return e.map((e=>function(e){return new Lc(Jl(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))}(e)))}(n.orderBy));let a=null;n.limit&&(a=function(e){let t;return t="object"==typeof e?e.value:e,za(t)?null:t}(n.limit));let c=null;n.startAt&&(c=function(e){const t=!!e.before,n=e.values||[];return new Nc(n,t)}(n.startAt));let u=null;return n.endAt&&(u=function(e){const t=!e.before,n=e.values||[];return new Nc(n,t)}(n.endAt)),function(e,t,n,r,i,s,o,a){return new tu(e,t,n,r,i,s,o,a)}(t,i,o,s,a,"F",c,u)}function Kl(e){return void 0!==e.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":const t=Jl(e.unaryFilter.field);return xc.create(t,"==",{doubleValue:NaN});case"IS_NULL":const n=Jl(e.unaryFilter.field);return xc.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=Jl(e.unaryFilter.field);return xc.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=Jl(e.unaryFilter.field);return xc.create(i,"!=",{nullValue:"NULL_VALUE"});default:return ea()}}(e):void 0!==e.fieldFilter?function(e){return xc.create(Jl(e.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return ea()}}(e.fieldFilter.op),e.fieldFilter.value)}(e):void 0!==e.compositeFilter?function(e){return Mc.create(e.compositeFilter.filters.map((e=>Kl(e))),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return ea()}}(e.compositeFilter.op))}(e):ea()}function Wl(e){return Cl[e]}function Ql(e){return Al[e]}function Xl(e){return kl[e]}function Yl(e){return{fieldPath:e.canonicalString()}}function Jl(e){return ba.fromServerFormat(e.fieldPath)}function Zl(e){return e instanceof xc?function(e){if("=="===e.op){if(Tc(e.value))return{unaryFilter:{field:Yl(e.field),op:"IS_NAN"}};if(_c(e.value))return{unaryFilter:{field:Yl(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(Tc(e.value))return{unaryFilter:{field:Yl(e.field),op:"IS_NOT_NAN"}};if(_c(e.value))return{unaryFilter:{field:Yl(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Yl(e.field),op:Ql(e.op),value:e.value}}}(e):e instanceof Mc?function(e){const t=e.getFilters().map((e=>Zl(e)));return 1===t.length?t[0]:{compositeFilter:{op:Xl(e.op),filters:t}}}(e):ea()}function eh(e){const t=[];return e.fields.forEach((e=>t.push(e.canonicalString()))),{fieldPaths:t}}function th(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}class nh{constructor(e,t,n,r,i=wa.min(),s=wa.min(),o=ec.EMPTY_BYTE_STRING,a=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=o,this.expectedCount=a}withSequenceNumber(e){return new nh(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new nh(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new nh(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new nh(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class rh{constructor(e){this.ct=e}}function ih(e){const t=Gl({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?cu(t,t.limit,"L"):t}class sh{constructor(){}Pt(e,t){this.It(e,t),t.Tt()}It(e,t){if("nullValue"in e)this.Et(t,5);else if("booleanValue"in e)this.Et(t,10),t.dt(e.booleanValue?1:0);else if("integerValue"in e)this.Et(t,15),t.dt(rc(e.integerValue));else if("doubleValue"in e){const n=rc(e.doubleValue);isNaN(n)?this.Et(t,13):(this.Et(t,15),qa(n)?t.dt(0):t.dt(n))}else if("timestampValue"in e){const n=e.timestampValue;this.Et(t,20),"string"==typeof n?t.At(n):(t.At(`${n.seconds||""}`),t.dt(n.nanos||0))}else if("stringValue"in e)this.Rt(e.stringValue,t),this.Vt(t);else if("bytesValue"in e)this.Et(t,30),t.ft(ic(e.bytesValue)),this.Vt(t);else if("referenceValue"in e)this.gt(e.referenceValue,t);else if("geoPointValue"in e){const n=e.geoPointValue;this.Et(t,45),t.dt(n.latitude||0),t.dt(n.longitude||0)}else"mapValue"in e?Sc(e)?this.Et(t,Number.MAX_SAFE_INTEGER):(this.yt(e.mapValue,t),this.Vt(t)):"arrayValue"in e?(this.wt(e.arrayValue,t),this.Vt(t)):ea()}Rt(e,t){this.Et(t,25),this.St(e,t)}St(e,t){t.At(e)}yt(e,t){const n=e.fields||{};this.Et(t,55);for(const e of Object.keys(n))this.Rt(e,t),this.It(n[e],t)}wt(e,t){const n=e.values||[];this.Et(t,50);for(const e of n)this.It(e,t)}gt(e,t){this.Et(t,37),Ia.fromName(e).path.forEach((e=>{this.Et(t,60),this.St(e,t)}))}Et(e,t){e.dt(t)}Vt(e){e.dt(2)}}sh.bt=new sh;class oh{constructor(){this._n=new ah}addToCollectionParentIndex(e,t){return this._n.add(t),Ra.resolve()}getCollectionParents(e,t){return Ra.resolve(this._n.getEntries(t))}addFieldIndex(e,t){return Ra.resolve()}deleteFieldIndex(e,t){return Ra.resolve()}deleteAllFieldIndexes(e){return Ra.resolve()}createTargetIndexes(e,t){return Ra.resolve()}getDocumentsMatchingTarget(e,t){return Ra.resolve(null)}getIndexType(e,t){return Ra.resolve(0)}getFieldIndexes(e,t){return Ra.resolve([])}getNextCollectionGroupToUpdate(e){return Ra.resolve(null)}getMinOffset(e,t){return Ra.resolve(Ca.min())}getMinOffsetFromCollectionGroup(e,t){return Ra.resolve(Ca.min())}updateCollectionGroup(e,t,n){return Ra.resolve()}updateIndexEntries(e,t){return Ra.resolve()}}class ah{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new Xa(_a.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}has(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new Xa(_a.comparator)).toArray()}}new Uint8Array(0);class ch{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new ch(e,ch.DEFAULT_COLLECTION_PERCENTILE,ch.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}ch.DEFAULT_COLLECTION_PERCENTILE=10,ch.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,ch.DEFAULT=new ch(41943040,ch.DEFAULT_COLLECTION_PERCENTILE,ch.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),ch.DISABLED=new ch(-1,0,0);class uh{constructor(e){this.On=e}next(){return this.On+=2,this.On}static Nn(){return new uh(0)}static Bn(){return new uh(-1)}}class lh{constructor(){this.changes=new mu((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,kc.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return void 0!==n?Ra.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class hh{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class dh{constructor(e,t,n,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=r}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next((r=>(n=r,this.remoteDocumentCache.getEntry(e,t)))).next((e=>(null!==n&&Qu(n.mutation,e,Ja.empty(),va.now()),e)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((t=>this.getLocalViewOfDocuments(e,t,Cu()).next((()=>t))))}getLocalViewOfDocuments(e,t,n=Cu()){const r=_u();return this.populateOverlays(e,r,t).next((()=>this.computeViews(e,t,r,n).next((e=>{let t=wu();return e.forEach(((e,n)=>{t=t.insert(e,n.overlayedDocument)})),t}))))}getOverlayedDocuments(e,t){const n=_u();return this.populateOverlays(e,n,t).next((()=>this.computeViews(e,t,n,Cu())))}populateOverlays(e,t,n){const r=[];return n.forEach((e=>{t.has(e)||r.push(e)})),this.documentOverlayCache.getOverlays(e,r).next((e=>{e.forEach(((e,n)=>{t.set(e,n)}))}))}computeViews(e,t,n,r){let i=yu();const s=bu(),o=bu();return t.forEach(((e,t)=>{const o=n.get(t.key);r.has(t.key)&&(void 0===o||o.mutation instanceof Zu)?i=i.insert(t.key,t):void 0!==o?(s.set(t.key,o.mutation.getFieldMask()),Qu(o.mutation,t,o.mutation.getFieldMask(),va.now())):s.set(t.key,Ja.empty())})),this.recalculateAndSaveOverlays(e,i).next((e=>(e.forEach(((e,t)=>s.set(e,t))),t.forEach(((e,t)=>{var n;return o.set(e,new hh(t,null!==(n=s.get(e))&&void 0!==n?n:null))})),o)))}recalculateAndSaveOverlays(e,t){const n=bu();let r=new Ka(((e,t)=>e-t)),i=Cu();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((e=>{for(const i of e)i.keys().forEach((e=>{const s=t.get(e);if(null===s)return;let o=n.get(e)||Ja.empty();o=i.applyToLocalView(s,o),n.set(e,o);const a=(r.get(i.batchId)||Cu()).add(e);r=r.insert(i.batchId,a)}))})).next((()=>{const s=[],o=r.getReverseIterator();for(;o.hasNext();){const r=o.getNext(),a=r.key,c=r.value,u=Tu();c.forEach((e=>{if(!i.has(e)){const r=Ku(t.get(e),n.get(e));null!==r&&u.set(e,r),i=i.add(e)}})),s.push(this.documentOverlayCache.saveOverlays(e,a,u))}return Ra.waitFor(s)})).next((()=>n))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((t=>this.recalculateAndSaveOverlays(e,t)))}getDocumentsMatchingQuery(e,t,n,r){return function(e){return Ia.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):iu(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,r):this.getDocumentsMatchingCollectionQuery(e,t,n,r)}getNextDocuments(e,t,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,r).next((i=>{const s=r-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,r-i.size):Ra.resolve(_u());let o=-1,a=i;return s.next((t=>Ra.forEach(t,((t,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),i.get(t)?Ra.resolve():this.remoteDocumentCache.getEntry(e,t).next((e=>{a=a.insert(t,e)}))))).next((()=>this.populateOverlays(e,t,i))).next((()=>this.computeViews(e,a,t,Cu()))).next((e=>({batchId:o,changes:Eu(e)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new Ia(t)).next((e=>{let t=wu();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t}))}getDocumentsMatchingCollectionGroupQuery(e,t,n,r){const i=t.collectionGroup;let s=wu();return this.indexManager.getCollectionParents(e,i).next((o=>Ra.forEach(o,(o=>{const a=function(e,t){return new tu(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(t,o.child(i));return this.getDocumentsMatchingCollectionQuery(e,a,n,r).next((e=>{e.forEach(((e,t)=>{s=s.insert(e,t)}))}))})).next((()=>s))))}getDocumentsMatchingCollectionQuery(e,t,n,r){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next((s=>(i=s,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,i,r)))).next((e=>{i.forEach(((t,n)=>{const r=n.getKey();null===e.get(r)&&(e=e.insert(r,kc.newInvalidDocument(r)))}));let n=wu();return e.forEach(((e,r)=>{const s=i.get(e);void 0!==s&&Qu(s.mutation,r,Ja.empty(),va.now()),du(t,r)&&(n=n.insert(e,r))})),n}))}}class fh{constructor(e){this.serializer=e,this.cr=new Map,this.lr=new Map}getBundleMetadata(e,t){return Ra.resolve(this.cr.get(t))}saveBundleMetadata(e,t){return this.cr.set(t.id,function(e){return{id:e.id,version:e.version,createTime:Pl(e.createTime)}}(t)),Ra.resolve()}getNamedQuery(e,t){return Ra.resolve(this.lr.get(t))}saveNamedQuery(e,t){return this.lr.set(t.name,function(e){return{name:e.name,query:ih(e.bundledQuery),readTime:Pl(e.readTime)}}(t)),Ra.resolve()}}class ph{constructor(){this.overlays=new Ka(Ia.comparator),this.hr=new Map}getOverlay(e,t){return Ra.resolve(this.overlays.get(t))}getOverlays(e,t){const n=_u();return Ra.forEach(t,(t=>this.getOverlay(e,t).next((e=>{null!==e&&n.set(t,e)})))).next((()=>n))}saveOverlays(e,t,n){return n.forEach(((n,r)=>{this.ht(e,t,r)})),Ra.resolve()}removeOverlaysForBatchId(e,t,n){const r=this.hr.get(n);return void 0!==r&&(r.forEach((e=>this.overlays=this.overlays.remove(e))),this.hr.delete(n)),Ra.resolve()}getOverlaysForCollection(e,t,n){const r=_u(),i=t.length+1,s=new Ia(t.child("")),o=this.overlays.getIteratorFrom(s);for(;o.hasNext();){const e=o.getNext().value,s=e.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===i&&e.largestBatchId>n&&r.set(e.getKey(),e)}return Ra.resolve(r)}getOverlaysForCollectionGroup(e,t,n,r){let i=new Ka(((e,t)=>e-t));const s=this.overlays.getIterator();for(;s.hasNext();){const e=s.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>n){let t=i.get(e.largestBatchId);null===t&&(t=_u(),i=i.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}const o=_u(),a=i.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach(((e,t)=>o.set(e,t))),!(o.size()>=r)););return Ra.resolve(o)}ht(e,t,n){const r=this.overlays.get(n.key);if(null!==r){const e=this.hr.get(r.largestBatchId).delete(n.key);this.hr.set(r.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new al(t,n));let i=this.hr.get(t);void 0===i&&(i=Cu(),this.hr.set(t,i)),this.hr.set(t,i.add(n.key))}}class mh{constructor(){this.Pr=new Xa(gh.Ir),this.Tr=new Xa(gh.Er)}isEmpty(){return this.Pr.isEmpty()}addReference(e,t){const n=new gh(e,t);this.Pr=this.Pr.add(n),this.Tr=this.Tr.add(n)}dr(e,t){e.forEach((e=>this.addReference(e,t)))}removeReference(e,t){this.Ar(new gh(e,t))}Rr(e,t){e.forEach((e=>this.removeReference(e,t)))}Vr(e){const t=new Ia(new _a([])),n=new gh(t,e),r=new gh(t,e+1),i=[];return this.Tr.forEachInRange([n,r],(e=>{this.Ar(e),i.push(e.key)})),i}mr(){this.Pr.forEach((e=>this.Ar(e)))}Ar(e){this.Pr=this.Pr.delete(e),this.Tr=this.Tr.delete(e)}gr(e){const t=new Ia(new _a([])),n=new gh(t,e),r=new gh(t,e+1);let i=Cu();return this.Tr.forEachInRange([n,r],(e=>{i=i.add(e.key)})),i}containsKey(e){const t=new gh(e,0),n=this.Pr.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class gh{constructor(e,t){this.key=e,this.pr=t}static Ir(e,t){return Ia.comparator(e.key,t.key)||ga(e.pr,t.pr)}static Er(e,t){return ga(e.pr,t.pr)||Ia.comparator(e.key,t.key)}}class yh{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.yr=1,this.wr=new Xa(gh.Ir)}checkEmpty(e){return Ra.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,r){const i=this.yr;this.yr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const s=new sl(i,t,n,r);this.mutationQueue.push(s);for(const t of r)this.wr=this.wr.add(new gh(t.key,i)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return Ra.resolve(s)}lookupMutationBatch(e,t){return Ra.resolve(this.Sr(t))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,r=this.br(n),i=r<0?0:r;return Ra.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return Ra.resolve(0===this.mutationQueue.length?-1:this.yr-1)}getAllMutationBatches(e){return Ra.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new gh(t,0),r=new gh(t,Number.POSITIVE_INFINITY),i=[];return this.wr.forEachInRange([n,r],(e=>{const t=this.Sr(e.pr);i.push(t)})),Ra.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new Xa(ga);return t.forEach((e=>{const t=new gh(e,0),r=new gh(e,Number.POSITIVE_INFINITY);this.wr.forEachInRange([t,r],(e=>{n=n.add(e.pr)}))})),Ra.resolve(this.Dr(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1;let i=n;Ia.isDocumentKey(i)||(i=i.child(""));const s=new gh(new Ia(i),0);let o=new Xa(ga);return this.wr.forEachWhile((e=>{const t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(o=o.add(e.pr)),!0)}),s),Ra.resolve(this.Dr(o))}Dr(e){const t=[];return e.forEach((e=>{const n=this.Sr(e);null!==n&&t.push(n)})),t}removeMutationBatch(e,t){ta(0===this.Cr(t.batchId,"removed")),this.mutationQueue.shift();let n=this.wr;return Ra.forEach(t.mutations,(r=>{const i=new gh(r.key,t.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)})).next((()=>{this.wr=n}))}Mn(e){}containsKey(e,t){const n=new gh(t,0),r=this.wr.firstAfterOrEqual(n);return Ra.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,Ra.resolve()}Cr(e,t){return this.br(e)}br(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Sr(e){const t=this.br(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class vh{constructor(e){this.vr=e,this.docs=new Ka(Ia.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,r=this.docs.get(n),i=r?r.size:0,s=this.vr(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return Ra.resolve(n?n.document.mutableCopy():kc.newInvalidDocument(t))}getEntries(e,t){let n=yu();return t.forEach((e=>{const t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():kc.newInvalidDocument(e))})),Ra.resolve(n)}getDocumentsMatchingQuery(e,t,n,r){let i=yu();const s=t.path,o=new Ia(s.child("")),a=this.docs.getIteratorFrom(o);for(;a.hasNext();){const{key:e,value:{document:o}}=a.getNext();if(!s.isPrefixOf(e.path))break;e.path.length>s.length+1||Aa(Sa(o),n)<=0||(r.has(o.key)||du(t,o))&&(i=i.insert(o.key,o.mutableCopy()))}return Ra.resolve(i)}getAllFromCollectionGroup(e,t,n,r){ea()}Fr(e,t){return Ra.forEach(this.docs,(e=>t(e)))}newChangeBuffer(e){return new wh(this)}getSize(e){return Ra.resolve(this.size)}}class wh extends lh{constructor(e){super(),this.ar=e}applyChanges(e){const t=[];return this.changes.forEach(((n,r)=>{r.isValidDocument()?t.push(this.ar.addEntry(e,r)):this.ar.removeEntry(n)})),Ra.waitFor(t)}getFromCache(e,t){return this.ar.getEntry(e,t)}getAllFromCache(e,t){return this.ar.getEntries(e,t)}}class Eh{constructor(e){this.persistence=e,this.Mr=new mu((e=>Jc(e)),Zc),this.lastRemoteSnapshotVersion=wa.min(),this.highestTargetId=0,this.Or=0,this.Nr=new mh,this.targetCount=0,this.Br=uh.Nn()}forEachTarget(e,t){return this.Mr.forEach(((e,n)=>t(n))),Ra.resolve()}getLastRemoteSnapshotVersion(e){return Ra.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return Ra.resolve(this.Or)}allocateTargetId(e){return this.highestTargetId=this.Br.next(),Ra.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.Or&&(this.Or=t),Ra.resolve()}qn(e){this.Mr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.Br=new uh(t),this.highestTargetId=t),e.sequenceNumber>this.Or&&(this.Or=e.sequenceNumber)}addTargetData(e,t){return this.qn(t),this.targetCount+=1,Ra.resolve()}updateTargetData(e,t){return this.qn(t),Ra.resolve()}removeTargetData(e,t){return this.Mr.delete(t.target),this.Nr.Vr(t.targetId),this.targetCount-=1,Ra.resolve()}removeTargets(e,t,n){let r=0;const i=[];return this.Mr.forEach(((s,o)=>{o.sequenceNumber<=t&&null===n.get(o.targetId)&&(this.Mr.delete(s),i.push(this.removeMatchingKeysForTargetId(e,o.targetId)),r++)})),Ra.waitFor(i).next((()=>r))}getTargetCount(e){return Ra.resolve(this.targetCount)}getTargetData(e,t){const n=this.Mr.get(t)||null;return Ra.resolve(n)}addMatchingKeys(e,t,n){return this.Nr.dr(t,n),Ra.resolve()}removeMatchingKeys(e,t,n){this.Nr.Rr(t,n);const r=this.persistence.referenceDelegate,i=[];return r&&t.forEach((t=>{i.push(r.markPotentiallyOrphaned(e,t))})),Ra.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.Nr.Vr(t),Ra.resolve()}getMatchingKeysForTargetId(e,t){const n=this.Nr.gr(t);return Ra.resolve(n)}containsKey(e,t){return Ra.resolve(this.Nr.containsKey(t))}}class _h{constructor(e,t){this.Lr={},this.overlays={},this.kr=new ja(0),this.qr=!1,this.qr=!0,this.referenceDelegate=e(this),this.Qr=new Eh(this),this.indexManager=new oh,this.remoteDocumentCache=function(e){return new vh(e)}((e=>this.referenceDelegate.Kr(e))),this.serializer=new rh(t),this.$r=new fh(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.qr=!1,Promise.resolve()}get started(){return this.qr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new ph,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.Lr[e.toKey()];return n||(n=new yh(t,this.referenceDelegate),this.Lr[e.toKey()]=n),n}getTargetCache(){return this.Qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.$r}runTransaction(e,t,n){Xo("MemoryPersistence","Starting transaction:",e);const r=new Th(this.kr.next());return this.referenceDelegate.Ur(),n(r).next((e=>this.referenceDelegate.Wr(r).next((()=>e)))).toPromise().then((e=>(r.raiseOnCommittedEvent(),e)))}Gr(e,t){return Ra.or(Object.values(this.Lr).map((n=>()=>n.containsKey(e,t))))}}class Th extends Na{constructor(e){super(),this.currentSequenceNumber=e}}class bh{constructor(e){this.persistence=e,this.zr=new mh,this.jr=null}static Hr(e){return new bh(e)}get Jr(){if(this.jr)return this.jr;throw ea()}addReference(e,t,n){return this.zr.addReference(n,t),this.Jr.delete(n.toString()),Ra.resolve()}removeReference(e,t,n){return this.zr.removeReference(n,t),this.Jr.add(n.toString()),Ra.resolve()}markPotentiallyOrphaned(e,t){return this.Jr.add(t.toString()),Ra.resolve()}removeTarget(e,t){this.zr.Vr(t.targetId).forEach((e=>this.Jr.add(e.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next((e=>{e.forEach((e=>this.Jr.add(e.toString())))})).next((()=>n.removeTargetData(e,t)))}Ur(){this.jr=new Set}Wr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Ra.forEach(this.Jr,(n=>{const r=Ia.fromPath(n);return this.Yr(e,r).next((e=>{e||t.removeEntry(r,wa.min())}))})).next((()=>(this.jr=null,t.apply(e))))}updateLimboDocument(e,t){return this.Yr(e,t).next((e=>{e?this.Jr.delete(t.toString()):this.Jr.add(t.toString())}))}Kr(e){return 0}Yr(e,t){return Ra.or([()=>Ra.resolve(this.zr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Gr(e,t)])}}class Ih{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.qi=n,this.Qi=r}static Ki(e,t){let n=Cu(),r=Cu();for(const e of t.docChanges)switch(e.type){case 0:n=n.add(e.doc.key);break;case 1:r=r.add(e.doc.key)}return new Ih(e,t.fromCache,n,r)}}class Sh{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class Ch{constructor(){this.$i=!1,this.Ui=!1,this.Wi=100,this.Gi=!function(){var e;const t=null===(e=o())||void 0===e?void 0:e.forceEnvironment;if("node"===t)return!0;if("browser"===t)return!1;try{return"[object process]"===Object.prototype.toString.call(n.g.process)}catch(e){return!1}}()&&navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")?8:Oa.v(h())>0?6:4}initialize(e,t){this.zi=e,this.indexManager=t,this.$i=!0}getDocumentsMatchingQuery(e,t,n,r){const i={result:null};return this.ji(e,t).next((e=>{i.result=e})).next((()=>{if(!i.result)return this.Hi(e,t,r,n).next((e=>{i.result=e}))})).next((()=>{if(i.result)return;const n=new Sh;return this.Ji(e,t,n).next((r=>{if(i.result=r,this.Ui)return this.Yi(e,t,n,r.size)}))})).next((()=>i.result))}Yi(e,t,n,r){return n.documentReadCount<this.Wi?(Qo()<=N.DEBUG&&Xo("QueryEngine","SDK will not create cache indexes for query:",hu(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Wi,"documents"),Ra.resolve()):(Qo()<=N.DEBUG&&Xo("QueryEngine","Query:",hu(t),"scans",n.documentReadCount,"local documents and returns",r,"documents as results."),n.documentReadCount>this.Gi*r?(Qo()<=N.DEBUG&&Xo("QueryEngine","The SDK decides to create cache indexes for query:",hu(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,ou(t))):Ra.resolve())}ji(e,t){if(ru(t))return Ra.resolve(null);let n=ou(t);return this.indexManager.getIndexType(e,n).next((r=>0===r?null:(null!==t.limit&&1===r&&(t=cu(t,null,"F"),n=ou(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next((r=>{const i=Cu(...r);return this.zi.getDocuments(e,i).next((r=>this.indexManager.getMinOffset(e,n).next((n=>{const s=this.Zi(t,r);return this.Xi(t,s,i,n.readTime)?this.ji(e,cu(t,null,"F")):this.es(e,s,t,n)}))))})))))}Hi(e,t,n,r){return ru(t)||r.isEqual(wa.min())?Ra.resolve(null):this.zi.getDocuments(e,n).next((i=>{const s=this.Zi(t,i);return this.Xi(t,s,n,r)?Ra.resolve(null):(Qo()<=N.DEBUG&&Xo("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),hu(t)),this.es(e,s,t,function(e,t){const n=e.toTimestamp().seconds,r=e.toTimestamp().nanoseconds+1,i=wa.fromTimestamp(1e9===r?new va(n+1,0):new va(n,r));return new Ca(i,Ia.empty(),t)}(r,-1)).next((e=>e)))}))}Zi(e,t){let n=new Xa(fu(e));return t.forEach(((t,r)=>{du(e,r)&&(n=n.add(r))})),n}Xi(e,t,n,r){if(null===e.limit)return!1;if(n.size!==t.size)return!0;const i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}Ji(e,t,n){return Qo()<=N.DEBUG&&Xo("QueryEngine","Using full collection scan to execute query:",hu(t)),this.zi.getDocumentsMatchingQuery(e,t,Ca.min(),n)}es(e,t,n,r){return this.zi.getDocumentsMatchingQuery(e,n,r).next((e=>(t.forEach((t=>{e=e.insert(t.key,t)})),e)))}}class Ah{constructor(e,t,n,r){this.persistence=e,this.ts=t,this.serializer=r,this.ns=new Ka(ga),this.rs=new mu((e=>Jc(e)),Zc),this.ss=new Map,this.os=e.getRemoteDocumentCache(),this.Qr=e.getTargetCache(),this.$r=e.getBundleCache(),this._s(n)}_s(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new dh(this.os,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.os.setIndexManager(this.indexManager),this.ts.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.ns)))}}async function kh(e,t){const n=na(e);return await n.persistence.runTransaction("Handle user change","readonly",(e=>{let r;return n.mutationQueue.getAllMutationBatches(e).next((i=>(r=i,n._s(t),n.mutationQueue.getAllMutationBatches(e)))).next((t=>{const i=[],s=[];let o=Cu();for(const e of r){i.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}for(const e of t){s.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}return n.localDocuments.getDocuments(e,o).next((e=>({us:e,removedBatchIds:i,addedBatchIds:s})))}))}))}function Nh(e){const t=na(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",(e=>t.Qr.getLastRemoteSnapshotVersion(e)))}function Dh(e,t){const n=na(e);return n.persistence.runTransaction("Get next mutation batch","readonly",(e=>(void 0===t&&(t=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(e,t))))}async function Rh(e,t,n){const r=na(e),i=r.ns.get(t),s=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",s,(e=>r.persistence.referenceDelegate.removeTarget(e,i)))}catch(e){if(!Ma(e))throw e;Xo("LocalStore",`Failed to update sequence numbers for target ${t}: ${e}`)}r.ns=r.ns.remove(t),r.rs.delete(i.target)}function Lh(e,t,n){const r=na(e);let i=wa.min(),s=Cu();return r.persistence.runTransaction("Execute query","readwrite",(e=>function(e,t,n){const r=na(e),i=r.rs.get(n);return void 0!==i?Ra.resolve(r.ns.get(i)):r.Qr.getTargetData(t,n)}(r,e,ou(t)).next((t=>{if(t)return i=t.lastLimboFreeSnapshotVersion,r.Qr.getMatchingKeysForTargetId(e,t.targetId).next((e=>{s=e}))})).next((()=>r.ts.getDocumentsMatchingQuery(e,t,n?i:wa.min(),n?s:Cu()))).next((e=>(function(e,t,n){let r=e.ss.get(t)||wa.min();n.forEach(((e,t)=>{t.readTime.compareTo(r)>0&&(r=t.readTime)})),e.ss.set(t,r)}(r,function(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}(t),e),{documents:e,hs:s})))))}class Oh{constructor(){this.activeTargetIds=Au}As(e){this.activeTargetIds=this.activeTargetIds.add(e)}Rs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}ds(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Ph{constructor(){this.no=new Oh,this.ro={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return this.no.As(e),this.ro[e]||"not-current"}updateQueryState(e,t,n){this.ro[e]=t}removeLocalQueryTarget(e){this.no.Rs(e)}isLocalQueryTarget(e){return this.no.activeTargetIds.has(e)}clearQueryState(e){delete this.ro[e]}getAllActiveQueryTargets(){return this.no.activeTargetIds}isActiveQueryTarget(e){return this.no.activeTargetIds.has(e)}start(){return this.no=new Oh,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class xh{io(e){}shutdown(){}}class Mh{constructor(){this.so=()=>this.oo(),this._o=()=>this.ao(),this.uo=[],this.co()}io(e){this.uo.push(e)}shutdown(){window.removeEventListener("online",this.so),window.removeEventListener("offline",this._o)}co(){window.addEventListener("online",this.so),window.addEventListener("offline",this._o)}oo(){Xo("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.uo)e(0)}ao(){Xo("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.uo)e(1)}static D(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let Uh=null;function Fh(){return null===Uh?Uh=268435456+Math.round(2147483648*Math.random()):Uh++,"0x"+Uh.toString(16)}const Vh={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class Bh{constructor(e){this.lo=e.lo,this.ho=e.ho}Po(e){this.Io=e}To(e){this.Eo=e}onMessage(e){this.Ao=e}close(){this.ho()}send(e){this.lo(e)}Ro(){this.Io()}Vo(e){this.Eo(e)}mo(e){this.Ao(e)}}const jh="WebChannelConnection";class zh extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.fo=t+"://"+e.host,this.po=`projects/${n}/databases/${r}`,this.yo="(default)"===this.databaseId.database?`project_id=${n}`:`project_id=${n}&database_id=${r}`}get wo(){return!1}So(e,t,n,r,i){const s=Fh(),o=this.bo(e,t.toUriEncodedString());Xo("RestConnection",`Sending RPC '${e}' ${s}:`,o,n);const a={"google-cloud-resource-prefix":this.po,"x-goog-request-params":this.yo};return this.Do(a,r,i),this.Co(e,o,a,n).then((t=>(Xo("RestConnection",`Received RPC '${e}' ${s}: `,t),t)),(t=>{throw Jo("RestConnection",`RPC '${e}' ${s} failed with error: `,t,"url: ",o,"request:",n),t}))}vo(e,t,n,r,i,s){return this.So(e,t,n,r,i)}Do(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+Ko,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((t,n)=>e[n]=t)),n&&n.headers.forEach(((t,n)=>e[n]=t))}bo(e,t){const n=Vh[e];return`${this.fo}/v1/${t}:${n}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Co(e,t,n,r){const i=Fh();return new Promise(((s,o)=>{const a=new zo;a.setWithCredentials(!0),a.listenOnce(Fo.COMPLETE,(()=>{try{switch(a.getLastErrorCode()){case Uo.NO_ERROR:const t=a.getResponseJson();Xo(jh,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(t)),s(t);break;case Uo.TIMEOUT:Xo(jh,`RPC '${e}' ${i} timed out`),o(new ia(ra.DEADLINE_EXCEEDED,"Request time out"));break;case Uo.HTTP_ERROR:const n=a.getStatus();if(Xo(jh,`RPC '${e}' ${i} failed with status:`,n,"response text:",a.getResponseText()),n>0){let e=a.getResponseJson();Array.isArray(e)&&(e=e[0]);const t=null==e?void 0:e.error;if(t&&t.status&&t.message){const e=function(e){const t=e.toLowerCase().replace(/_/g,"-");return Object.values(ra).indexOf(t)>=0?t:ra.UNKNOWN}(t.status);o(new ia(e,t.message))}else o(new ia(ra.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new ia(ra.UNAVAILABLE,"Connection failed."));break;default:ea()}}finally{Xo(jh,`RPC '${e}' ${i} completed.`)}}));const c=JSON.stringify(r);Xo(jh,`RPC '${e}' ${i} sending request:`,r),a.send(t,"POST",c,n,15)}))}Fo(e,t,n){const r=Fh(),i=[this.fo,"/","google.firestore.v1.Firestore","/",e,"/channel"],s=xo(),o=Mo(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;void 0!==c&&(a.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(a.useFetchStreams=!0),this.Do(a.initMessageHeaders,t,n),a.encodeInitMessageHeaders=!0;const u=i.join("");Xo(jh,`Creating RPC '${e}' stream ${r}: ${u}`,a);const l=s.createWebChannel(u,a);let h=!1,d=!1;const f=new Bh({lo:t=>{d?Xo(jh,`Not sending because RPC '${e}' stream ${r} is closed:`,t):(h||(Xo(jh,`Opening RPC '${e}' stream ${r} transport.`),l.open(),h=!0),Xo(jh,`RPC '${e}' stream ${r} sending:`,t),l.send(t))},ho:()=>l.close()}),p=(e,t,n)=>{e.listen(t,(e=>{try{n(e)}catch(e){setTimeout((()=>{throw e}),0)}}))};return p(l,jo.EventType.OPEN,(()=>{d||Xo(jh,`RPC '${e}' stream ${r} transport opened.`)})),p(l,jo.EventType.CLOSE,(()=>{d||(d=!0,Xo(jh,`RPC '${e}' stream ${r} transport closed`),f.Vo())})),p(l,jo.EventType.ERROR,(t=>{d||(d=!0,Jo(jh,`RPC '${e}' stream ${r} transport errored:`,t),f.Vo(new ia(ra.UNAVAILABLE,"The operation could not be completed")))})),p(l,jo.EventType.MESSAGE,(t=>{var n;if(!d){const i=t.data[0];ta(!!i);const s=i,o=s.error||(null===(n=s[0])||void 0===n?void 0:n.error);if(o){Xo(jh,`RPC '${e}' stream ${r} received error:`,o);const t=o.status;let n=function(e){const t=ul[e];if(void 0!==t)return hl(t)}(t),i=o.message;void 0===n&&(n=ra.INTERNAL,i="Unknown error status: "+t+" with message "+o.message),d=!0,f.Vo(new ia(n,i)),l.close()}else Xo(jh,`RPC '${e}' stream ${r} received:`,i),f.mo(i)}})),p(o,Vo.STAT_EVENT,(t=>{t.stat===Bo.PROXY?Xo(jh,`RPC '${e}' stream ${r} detected buffering proxy`):t.stat===Bo.NOPROXY&&Xo(jh,`RPC '${e}' stream ${r} detected no buffering proxy`)})),setTimeout((()=>{f.Ro()}),0),f}}function qh(){return"undefined"!=typeof document?document:null}function $h(e){return new Nl(e,!0)}class Hh{constructor(e,t,n=1e3,r=1.5,i=6e4){this.oi=e,this.timerId=t,this.Mo=n,this.xo=r,this.Oo=i,this.No=0,this.Bo=null,this.Lo=Date.now(),this.reset()}reset(){this.No=0}ko(){this.No=this.Oo}qo(e){this.cancel();const t=Math.floor(this.No+this.Qo()),n=Math.max(0,Date.now()-this.Lo),r=Math.max(0,t-n);r>0&&Xo("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.No} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.Bo=this.oi.enqueueAfterDelay(this.timerId,r,(()=>(this.Lo=Date.now(),e()))),this.No*=this.xo,this.No<this.Mo&&(this.No=this.Mo),this.No>this.Oo&&(this.No=this.Oo)}Ko(){null!==this.Bo&&(this.Bo.skipDelay(),this.Bo=null)}cancel(){null!==this.Bo&&(this.Bo.cancel(),this.Bo=null)}Qo(){return(Math.random()-.5)*this.No}}class Gh{constructor(e,t,n,r,i,s,o,a){this.oi=e,this.$o=n,this.Uo=r,this.connection=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.Wo=0,this.Go=null,this.zo=null,this.stream=null,this.jo=new Hh(e,t)}Ho(){return 1===this.state||5===this.state||this.Jo()}Jo(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Yo()}async stop(){this.Ho()&&await this.close(0)}Zo(){this.state=0,this.jo.reset()}Xo(){this.Jo()&&null===this.Go&&(this.Go=this.oi.enqueueAfterDelay(this.$o,6e4,(()=>this.e_())))}t_(e){this.n_(),this.stream.send(e)}async e_(){if(this.Jo())return this.close(0)}n_(){this.Go&&(this.Go.cancel(),this.Go=null)}r_(){this.zo&&(this.zo.cancel(),this.zo=null)}async close(e,t){this.n_(),this.r_(),this.jo.cancel(),this.Wo++,4!==e?this.jo.reset():t&&t.code===ra.RESOURCE_EXHAUSTED?(Yo(t.toString()),Yo("Using maximum backoff delay to prevent overloading the backend."),this.jo.ko()):t&&t.code===ra.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.i_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.To(t)}i_(){}auth(){this.state=1;const e=this.s_(this.Wo),t=this.Wo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([e,n])=>{this.Wo===t&&this.o_(e,n)}),(t=>{e((()=>{const e=new ia(ra.UNKNOWN,"Fetching auth token failed: "+t.message);return this.__(e)}))}))}o_(e,t){const n=this.s_(this.Wo);this.stream=this.a_(e,t),this.stream.Po((()=>{n((()=>(this.state=2,this.zo=this.oi.enqueueAfterDelay(this.Uo,1e4,(()=>(this.Jo()&&(this.state=3),Promise.resolve()))),this.listener.Po())))})),this.stream.To((e=>{n((()=>this.__(e)))})),this.stream.onMessage((e=>{n((()=>this.onMessage(e)))}))}Yo(){this.state=5,this.jo.qo((async()=>{this.state=0,this.start()}))}__(e){return Xo("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}s_(e){return t=>{this.oi.enqueueAndForget((()=>this.Wo===e?t():(Xo("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class Kh extends Gh{constructor(e,t,n,r,i,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i}a_(e,t){return this.connection.Fo("Listen",e,t)}onMessage(e){this.jo.reset();const t=function(e,t){let n;if("targetChange"in t){t.targetChange;const r=function(e){return"NO_CHANGE"===e?0:"ADD"===e?1:"REMOVE"===e?2:"CURRENT"===e?3:"RESET"===e?4:ea()}(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],s=function(e,t){return e.useProto3Json?(ta(void 0===t||"string"==typeof t),ec.fromBase64String(t||"")):(ta(void 0===t||t instanceof Uint8Array),ec.fromUint8Array(t||new Uint8Array))}(e,t.targetChange.resumeToken),o=t.targetChange.cause,a=o&&function(e){const t=void 0===e.code?ra.UNKNOWN:hl(e.code);return new ia(t,e.message||"")}(o);n=new _l(r,i,s,a||null)}else if("documentChange"in t){t.documentChange;const r=t.documentChange;r.document,r.document.name,r.document.updateTime;const i=Vl(e,r.document.name),s=Pl(r.document.updateTime),o=r.document.createTime?Pl(r.document.createTime):wa.min(),a=new Cc({mapValue:{fields:r.document.fields}}),c=kc.newFoundDocument(i,s,o,a),u=r.targetIds||[],l=r.removedTargetIds||[];n=new wl(u,l,c.key,c)}else if("documentDelete"in t){t.documentDelete;const r=t.documentDelete;r.document;const i=Vl(e,r.document),s=r.readTime?Pl(r.readTime):wa.min(),o=kc.newNoDocument(i,s),a=r.removedTargetIds||[];n=new wl([],a,o.key,o)}else if("documentRemove"in t){t.documentRemove;const r=t.documentRemove;r.document;const i=Vl(e,r.document),s=r.removedTargetIds||[];n=new wl([],s,i,null)}else{if(!("filter"in t))return ea();{t.filter;const e=t.filter;e.targetId;const{count:r=0,unchangedNames:i}=e,s=new cl(r,i),o=e.targetId;n=new El(o,s)}}return n}(this.serializer,e),n=function(e){if(!("targetChange"in e))return wa.min();const t=e.targetChange;return t.targetIds&&t.targetIds.length?wa.min():t.readTime?Pl(t.readTime):wa.min()}(e);return this.listener.u_(t,n)}c_(e){const t={};t.database=jl(this.serializer),t.addTarget=function(e,t){let n;const r=t.target;if(n=eu(r)?{documents:$l(e,r)}:{query:Hl(e,r).ut},n.targetId=t.targetId,t.resumeToken.approximateByteSize()>0){n.resumeToken=Ll(e,t.resumeToken);const r=Dl(e,t.expectedCount);null!==r&&(n.expectedCount=r)}else if(t.snapshotVersion.compareTo(wa.min())>0){n.readTime=Rl(e,t.snapshotVersion.toTimestamp());const r=Dl(e,t.expectedCount);null!==r&&(n.expectedCount=r)}return n}(this.serializer,e);const n=function(e,t){const n=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return ea()}}(t.purpose);return null==n?null:{"goog-listen-tags":n}}(this.serializer,e);n&&(t.labels=n),this.t_(t)}l_(e){const t={};t.database=jl(this.serializer),t.removeTarget=e,this.t_(t)}}class Wh extends Gh{constructor(e,t,n,r,i,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i,this.h_=!1}get P_(){return this.h_}start(){this.h_=!1,this.lastStreamToken=void 0,super.start()}i_(){this.h_&&this.I_([])}a_(e,t){return this.connection.Fo("Write",e,t)}onMessage(e){if(ta(!!e.streamToken),this.lastStreamToken=e.streamToken,this.h_){this.jo.reset();const t=function(e,t){return e&&e.length>0?(ta(void 0!==t),e.map((e=>function(e,t){let n=e.updateTime?Pl(e.updateTime):Pl(t);return n.isEqual(wa.min())&&(n=Pl(t)),new qu(n,e.transformResults||[])}(e,t)))):[]}(e.writeResults,e.commitTime),n=Pl(e.commitTime);return this.listener.T_(n,t)}return ta(!e.writeResults||0===e.writeResults.length),this.h_=!0,this.listener.E_()}d_(){const e={};e.database=jl(this.serializer),this.t_(e)}I_(e){const t={streamToken:this.lastStreamToken,writes:e.map((e=>function(e,t){let n;if(t instanceof Ju)n={update:ql(e,t.key,t.value)};else if(t instanceof rl)n={delete:Fl(e,t.key)};else if(t instanceof Zu)n={update:ql(e,t.key,t.data),updateMask:eh(t.fieldMask)};else{if(!(t instanceof il))return ea();n={verify:Fl(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map((e=>function(e,t){const n=t.transform;if(n instanceof xu)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof Mu)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof Fu)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof Bu)return{fieldPath:t.field.canonicalString(),increment:n.Ie};throw ea()}(0,e)))),t.precondition.isNone||(n.currentDocument=function(e,t){return void 0!==t.updateTime?{updateTime:Ol(e,t.updateTime)}:void 0!==t.exists?{exists:t.exists}:ea()}(e,t.precondition)),n}(this.serializer,e)))};this.t_(t)}}class Qh extends class{}{constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=r,this.A_=!1}R_(){if(this.A_)throw new ia(ra.FAILED_PRECONDITION,"The client has already been terminated.")}So(e,t,n,r){return this.R_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([i,s])=>this.connection.So(e,Ml(t,n),r,i,s))).catch((e=>{throw"FirebaseError"===e.name?(e.code===ra.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new ia(ra.UNKNOWN,e.toString())}))}vo(e,t,n,r,i){return this.R_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([s,o])=>this.connection.vo(e,Ml(t,n),r,s,o,i))).catch((e=>{throw"FirebaseError"===e.name?(e.code===ra.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new ia(ra.UNKNOWN,e.toString())}))}terminate(){this.A_=!0,this.connection.terminate()}}class Xh{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.m_=0,this.f_=null,this.g_=!0}p_(){0===this.m_&&(this.y_("Unknown"),this.f_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this.f_=null,this.w_("Backend didn't respond within 10 seconds."),this.y_("Offline"),Promise.resolve()))))}S_(e){"Online"===this.state?this.y_("Unknown"):(this.m_++,this.m_>=1&&(this.b_(),this.w_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.y_("Offline")))}set(e){this.b_(),this.m_=0,"Online"===e&&(this.g_=!1),this.y_(e)}y_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}w_(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.g_?(Yo(t),this.g_=!1):Xo("OnlineStateTracker",t)}b_(){null!==this.f_&&(this.f_.cancel(),this.f_=null)}}class Yh{constructor(e,t,n,r,i){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.D_=[],this.C_=new Map,this.v_=new Set,this.F_=[],this.M_=i,this.M_.io((e=>{n.enqueueAndForget((async()=>{od(this)&&(Xo("RemoteStore","Restarting streams for network reachability change."),await async function(e){const t=na(e);t.v_.add(4),await Zh(t),t.x_.set("Unknown"),t.v_.delete(4),await Jh(t)}(this))}))})),this.x_=new Xh(n,r)}}async function Jh(e){if(od(e))for(const t of e.F_)await t(!0)}async function Zh(e){for(const t of e.F_)await t(!1)}function ed(e,t){const n=na(e);n.C_.has(t.targetId)||(n.C_.set(t.targetId,t),sd(n)?id(n):bd(n).Jo()&&nd(n,t))}function td(e,t){const n=na(e),r=bd(n);n.C_.delete(t),r.Jo()&&rd(n,t),0===n.C_.size&&(r.Jo()?r.Xo():od(n)&&n.x_.set("Unknown"))}function nd(e,t){if(e.O_.Oe(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(wa.min())>0){const n=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(n)}bd(e).c_(t)}function rd(e,t){e.O_.Oe(t),bd(e).l_(t)}function id(e){e.O_=new bl({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),_t:t=>e.C_.get(t)||null,nt:()=>e.datastore.serializer.databaseId}),bd(e).start(),e.x_.p_()}function sd(e){return od(e)&&!bd(e).Ho()&&e.C_.size>0}function od(e){return 0===na(e).v_.size}function ad(e){e.O_=void 0}async function cd(e){e.C_.forEach(((t,n)=>{nd(e,t)}))}async function ud(e,t){ad(e),sd(e)?(e.x_.S_(t),id(e)):e.x_.set("Unknown")}async function ld(e,t,n){if(e.x_.set("Online"),t instanceof _l&&2===t.state&&t.cause)try{await async function(e,t){const n=t.cause;for(const r of t.targetIds)e.C_.has(r)&&(await e.remoteSyncer.rejectListen(r,n),e.C_.delete(r),e.O_.removeTarget(r))}(e,t)}catch(n){Xo("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),n),await hd(e,n)}else if(t instanceof wl?e.O_.$e(t):t instanceof El?e.O_.Je(t):e.O_.Ge(t),!n.isEqual(wa.min()))try{const t=await Nh(e.localStore);n.compareTo(t)>=0&&await function(e,t){const n=e.O_.it(t);return n.targetChanges.forEach(((n,r)=>{if(n.resumeToken.approximateByteSize()>0){const i=e.C_.get(r);i&&e.C_.set(r,i.withResumeToken(n.resumeToken,t))}})),n.targetMismatches.forEach(((t,n)=>{const r=e.C_.get(t);if(!r)return;e.C_.set(t,r.withResumeToken(ec.EMPTY_BYTE_STRING,r.snapshotVersion)),rd(e,t);const i=new nh(r.target,t,n,r.sequenceNumber);nd(e,i)})),e.remoteSyncer.applyRemoteEvent(n)}(e,n)}catch(t){Xo("RemoteStore","Failed to raise snapshot:",t),await hd(e,t)}}async function hd(e,t,n){if(!Ma(t))throw t;e.v_.add(1),await Zh(e),e.x_.set("Offline"),n||(n=()=>Nh(e.localStore)),e.asyncQueue.enqueueRetryable((async()=>{Xo("RemoteStore","Retrying IndexedDB access"),await n(),e.v_.delete(1),await Jh(e)}))}function dd(e,t){return t().catch((n=>hd(e,n,t)))}async function fd(e){const t=na(e),n=Id(t);let r=t.D_.length>0?t.D_[t.D_.length-1].batchId:-1;for(;pd(t);)try{const e=await Dh(t.localStore,r);if(null===e){0===t.D_.length&&n.Xo();break}r=e.batchId,md(t,e)}catch(e){await hd(t,e)}gd(t)&&yd(t)}function pd(e){return od(e)&&e.D_.length<10}function md(e,t){e.D_.push(t);const n=Id(e);n.Jo()&&n.P_&&n.I_(t.mutations)}function gd(e){return od(e)&&!Id(e).Ho()&&e.D_.length>0}function yd(e){Id(e).start()}async function vd(e){Id(e).d_()}async function wd(e){const t=Id(e);for(const n of e.D_)t.I_(n.mutations)}async function Ed(e,t,n){const r=e.D_.shift(),i=ol.from(r,t,n);await dd(e,(()=>e.remoteSyncer.applySuccessfulWrite(i))),await fd(e)}async function _d(e,t){t&&Id(e).P_&&await async function(e,t){if(function(e){return function(e){switch(e){default:return ea();case ra.CANCELLED:case ra.UNKNOWN:case ra.DEADLINE_EXCEEDED:case ra.RESOURCE_EXHAUSTED:case ra.INTERNAL:case ra.UNAVAILABLE:case ra.UNAUTHENTICATED:return!1;case ra.INVALID_ARGUMENT:case ra.NOT_FOUND:case ra.ALREADY_EXISTS:case ra.PERMISSION_DENIED:case ra.FAILED_PRECONDITION:case ra.ABORTED:case ra.OUT_OF_RANGE:case ra.UNIMPLEMENTED:case ra.DATA_LOSS:return!0}}(e)&&e!==ra.ABORTED}(t.code)){const n=e.D_.shift();Id(e).Zo(),await dd(e,(()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t))),await fd(e)}}(e,t),gd(e)&&yd(e)}async function Td(e,t){const n=na(e);n.asyncQueue.verifyOperationInProgress(),Xo("RemoteStore","RemoteStore received new credentials");const r=od(n);n.v_.add(3),await Zh(n),r&&n.x_.set("Unknown"),await n.remoteSyncer.handleCredentialChange(t),n.v_.delete(3),await Jh(n)}function bd(e){return e.N_||(e.N_=function(e,t,n){const r=na(e);return r.R_(),new Kh(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(e.datastore,e.asyncQueue,{Po:cd.bind(null,e),To:ud.bind(null,e),u_:ld.bind(null,e)}),e.F_.push((async t=>{t?(e.N_.Zo(),sd(e)?id(e):e.x_.set("Unknown")):(await e.N_.stop(),ad(e))}))),e.N_}function Id(e){return e.B_||(e.B_=function(e,t,n){const r=na(e);return r.R_(),new Wh(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(e.datastore,e.asyncQueue,{Po:vd.bind(null,e),To:_d.bind(null,e),E_:wd.bind(null,e),T_:Ed.bind(null,e)}),e.F_.push((async t=>{t?(e.B_.Zo(),await fd(e)):(await e.B_.stop(),e.D_.length>0&&(Xo("RemoteStore",`Stopping write stream with ${e.D_.length} pending writes`),e.D_=[]))}))),e.B_}class Sd{constructor(e,t,n,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new sa,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((e=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,r,i){const s=Date.now()+n,o=new Sd(e,t,s,r,i);return o.start(n),o}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new ia(ra.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Cd(e,t){if(Yo("AsyncQueue",`${t}: ${e}`),Ma(e))return new ia(ra.UNAVAILABLE,`${t}: ${e}`);throw e}class Ad{constructor(e){this.comparator=e?(t,n)=>e(t,n)||Ia.comparator(t.key,n.key):(e,t)=>Ia.comparator(e.key,t.key),this.keyedMap=wu(),this.sortedSet=new Ka(this.comparator)}static emptySet(e){return new Ad(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,n)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Ad))return!1;if(this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(!e.isEqual(r))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const n=new Ad;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class kd{constructor(){this.L_=new Ka(Ia.comparator)}track(e){const t=e.doc.key,n=this.L_.get(t);n?0!==e.type&&3===n.type?this.L_=this.L_.insert(t,e):3===e.type&&1!==n.type?this.L_=this.L_.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.L_=this.L_.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.L_=this.L_.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.L_=this.L_.remove(t):1===e.type&&2===n.type?this.L_=this.L_.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.L_=this.L_.insert(t,{type:2,doc:e.doc}):ea():this.L_=this.L_.insert(t,e)}k_(){const e=[];return this.L_.inorderTraversal(((t,n)=>{e.push(n)})),e}}class Nd{constructor(e,t,n,r,i,s,o,a,c){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=o,this.excludesMetadataChanges=a,this.hasCachedResults=c}static fromInitialDocuments(e,t,n,r,i){const s=[];return t.forEach((e=>{s.push({type:0,doc:e})})),new Nd(e,t,Ad.emptySet(t),s,n,r,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&uu(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==n[e].type||!t[e].doc.isEqual(n[e].doc))return!1;return!0}}class Dd{constructor(){this.q_=void 0,this.Q_=[]}}class Rd{constructor(){this.queries=new mu((e=>lu(e)),uu),this.onlineState="Unknown",this.K_=new Set}}async function Ld(e,t){const n=na(e),r=t.query;let i=!1,s=n.queries.get(r);if(s||(i=!0,s=new Dd),i)try{s.q_=await n.onListen(r)}catch(e){const n=Cd(e,`Initialization of query '${hu(t.query)}' failed`);return void t.onError(n)}n.queries.set(r,s),s.Q_.push(t),t.U_(n.onlineState),s.q_&&t.W_(s.q_)&&Md(n)}async function Od(e,t){const n=na(e),r=t.query;let i=!1;const s=n.queries.get(r);if(s){const e=s.Q_.indexOf(t);e>=0&&(s.Q_.splice(e,1),i=0===s.Q_.length)}if(i)return n.queries.delete(r),n.onUnlisten(r)}function Pd(e,t){const n=na(e);let r=!1;for(const e of t){const t=e.query,i=n.queries.get(t);if(i){for(const t of i.Q_)t.W_(e)&&(r=!0);i.q_=e}}r&&Md(n)}function xd(e,t,n){const r=na(e),i=r.queries.get(t);if(i)for(const e of i.Q_)e.onError(n);r.queries.delete(t)}function Md(e){e.K_.forEach((e=>{e.next()}))}class Ud{constructor(e,t,n){this.query=e,this.G_=t,this.z_=!1,this.j_=null,this.onlineState="Unknown",this.options=n||{}}W_(e){if(!this.options.includeMetadataChanges){const t=[];for(const n of e.docChanges)3!==n.type&&t.push(n);e=new Nd(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.z_?this.H_(e)&&(this.G_.next(e),t=!0):this.J_(e,this.onlineState)&&(this.Y_(e),t=!0),this.j_=e,t}onError(e){this.G_.error(e)}U_(e){this.onlineState=e;let t=!1;return this.j_&&!this.z_&&this.J_(this.j_,e)&&(this.Y_(this.j_),t=!0),t}J_(e,t){if(!e.fromCache)return!0;const n="Offline"!==t;return(!this.options.Z_||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}H_(e){if(e.docChanges.length>0)return!0;const t=this.j_&&this.j_.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}Y_(e){e=Nd.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.z_=!0,this.G_.next(e)}}class Fd{constructor(e){this.key=e}}class Vd{constructor(e){this.key=e}}class Bd{constructor(e,t){this.query=e,this.oa=t,this._a=null,this.hasCachedResults=!1,this.current=!1,this.aa=Cu(),this.mutatedKeys=Cu(),this.ua=fu(e),this.ca=new Ad(this.ua)}get la(){return this.oa}ha(e,t){const n=t?t.Pa:new kd,r=t?t.ca:this.ca;let i=t?t.mutatedKeys:this.mutatedKeys,s=r,o=!1;const a="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,c="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal(((e,t)=>{const u=r.get(e),l=du(this.query,t)?t:null,h=!!u&&this.mutatedKeys.has(u.key),d=!!l&&(l.hasLocalMutations||this.mutatedKeys.has(l.key)&&l.hasCommittedMutations);let f=!1;u&&l?u.data.isEqual(l.data)?h!==d&&(n.track({type:3,doc:l}),f=!0):this.Ia(u,l)||(n.track({type:2,doc:l}),f=!0,(a&&this.ua(l,a)>0||c&&this.ua(l,c)<0)&&(o=!0)):!u&&l?(n.track({type:0,doc:l}),f=!0):u&&!l&&(n.track({type:1,doc:u}),f=!0,(a||c)&&(o=!0)),f&&(l?(s=s.add(l),i=d?i.add(e):i.delete(e)):(s=s.delete(e),i=i.delete(e)))})),null!==this.query.limit)for(;s.size>this.query.limit;){const e="F"===this.query.limitType?s.last():s.first();s=s.delete(e.key),i=i.delete(e.key),n.track({type:1,doc:e})}return{ca:s,Pa:n,Xi:o,mutatedKeys:i}}Ia(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,r){const i=this.ca;this.ca=e.ca,this.mutatedKeys=e.mutatedKeys;const s=e.Pa.k_();s.sort(((e,t)=>function(e,t){const n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return ea()}};return n(e)-n(t)}(e.type,t.type)||this.ua(e.doc,t.doc))),this.Ta(n),r=null!=r&&r;const o=t&&!r?this.Ea():[],a=0===this.aa.size&&this.current&&!r?1:0,c=a!==this._a;return this._a=a,0!==s.length||c?{snapshot:new Nd(this.query,e.ca,i,s,e.mutatedKeys,0===a,c,!1,!!n&&n.resumeToken.approximateByteSize()>0),da:o}:{da:o}}U_(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({ca:this.ca,Pa:new kd,mutatedKeys:this.mutatedKeys,Xi:!1},!1)):{da:[]}}Aa(e){return!this.oa.has(e)&&!!this.ca.has(e)&&!this.ca.get(e).hasLocalMutations}Ta(e){e&&(e.addedDocuments.forEach((e=>this.oa=this.oa.add(e))),e.modifiedDocuments.forEach((e=>{})),e.removedDocuments.forEach((e=>this.oa=this.oa.delete(e))),this.current=e.current)}Ea(){if(!this.current)return[];const e=this.aa;this.aa=Cu(),this.ca.forEach((e=>{this.Aa(e.key)&&(this.aa=this.aa.add(e.key))}));const t=[];return e.forEach((e=>{this.aa.has(e)||t.push(new Vd(e))})),this.aa.forEach((n=>{e.has(n)||t.push(new Fd(n))})),t}Ra(e){this.oa=e.hs,this.aa=Cu();const t=this.ha(e.documents);return this.applyChanges(t,!0)}Va(){return Nd.fromInitialDocuments(this.query,this.ca,this.mutatedKeys,0===this._a,this.hasCachedResults)}}class jd{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class zd{constructor(e){this.key=e,this.ma=!1}}class qd{constructor(e,t,n,r,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.fa={},this.ga=new mu((e=>lu(e)),uu),this.pa=new Map,this.ya=new Set,this.wa=new Ka(Ia.comparator),this.Sa=new Map,this.ba=new mh,this.Da={},this.Ca=new Map,this.va=uh.Bn(),this.onlineState="Unknown",this.Fa=void 0}get isPrimaryClient(){return!0===this.Fa}}async function $d(e,t){const n=function(e){const t=na(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=Gd.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=af.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=Wd.bind(null,t),t.fa.u_=Pd.bind(null,t.eventManager),t.fa.xa=xd.bind(null,t.eventManager),t}(e);let r,i;const s=n.ga.get(t);if(s)r=s.targetId,n.sharedClientState.addLocalQueryTarget(r),i=s.view.Va();else{const e=await function(e,t){const n=na(e);return n.persistence.runTransaction("Allocate target","readwrite",(e=>{let r;return n.Qr.getTargetData(e,t).next((i=>i?(r=i,Ra.resolve(r)):n.Qr.allocateTargetId(e).next((i=>(r=new nh(t,i,"TargetPurposeListen",e.currentSequenceNumber),n.Qr.addTargetData(e,r).next((()=>r)))))))})).then((e=>{const r=n.ns.get(e.targetId);return(null===r||e.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.ns=n.ns.insert(e.targetId,e),n.rs.set(t,e.targetId)),e}))}(n.localStore,ou(t)),s=n.sharedClientState.addLocalQueryTarget(e.targetId);r=e.targetId,i=await async function(e,t,n,r,i){e.Ma=(t,n,r)=>async function(e,t,n,r){let i=t.view.ha(n);i.Xi&&(i=await Lh(e.localStore,t.query,!1).then((({documents:e})=>t.view.ha(e,i))));const s=r&&r.targetChanges.get(t.targetId),o=r&&null!=r.targetMismatches.get(t.targetId),a=t.view.applyChanges(i,e.isPrimaryClient,s,o);return tf(e,t.targetId,a.da),a.snapshot}(e,t,n,r);const s=await Lh(e.localStore,t,!0),o=new Bd(t,s.hs),a=o.ha(s.documents),c=vl.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==e.onlineState,i),u=o.applyChanges(a,e.isPrimaryClient,c);tf(e,n,u.da);const l=new jd(t,n,o);return e.ga.set(t,l),e.pa.has(n)?e.pa.get(n).push(t):e.pa.set(n,[t]),u.snapshot}(n,t,r,"current"===s,e.resumeToken),n.isPrimaryClient&&ed(n.remoteStore,e)}return i}async function Hd(e,t){const n=na(e),r=n.ga.get(t),i=n.pa.get(r.targetId);if(i.length>1)return n.pa.set(r.targetId,i.filter((e=>!uu(e,t)))),void n.ga.delete(t);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)||await Rh(n.localStore,r.targetId,!1).then((()=>{n.sharedClientState.clearQueryState(r.targetId),td(n.remoteStore,r.targetId),Zd(n,r.targetId)})).catch(Da)):(Zd(n,r.targetId),await Rh(n.localStore,r.targetId,!0))}async function Gd(e,t){const n=na(e);try{const e=await function(e,t){const n=na(e),r=t.snapshotVersion;let i=n.ns;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(e=>{const s=n.os.newChangeBuffer({trackRemovals:!0});i=n.ns;const o=[];t.targetChanges.forEach(((s,a)=>{const c=i.get(a);if(!c)return;o.push(n.Qr.removeMatchingKeys(e,s.removedDocuments,a).next((()=>n.Qr.addMatchingKeys(e,s.addedDocuments,a))));let u=c.withSequenceNumber(e.currentSequenceNumber);null!==t.targetMismatches.get(a)?u=u.withResumeToken(ec.EMPTY_BYTE_STRING,wa.min()).withLastLimboFreeSnapshotVersion(wa.min()):s.resumeToken.approximateByteSize()>0&&(u=u.withResumeToken(s.resumeToken,r)),i=i.insert(a,u),function(e,t,n){return 0===e.resumeToken.approximateByteSize()||t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(c,u,s)&&o.push(n.Qr.updateTargetData(e,u))}));let a=yu(),c=Cu();if(t.documentUpdates.forEach((r=>{t.resolvedLimboDocuments.has(r)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(e,r))})),o.push(function(e,t,n){let r=Cu(),i=Cu();return n.forEach((e=>r=r.add(e))),t.getEntries(e,r).next((e=>{let r=yu();return n.forEach(((n,s)=>{const o=e.get(n);s.isFoundDocument()!==o.isFoundDocument()&&(i=i.add(n)),s.isNoDocument()&&s.version.isEqual(wa.min())?(t.removeEntry(n,s.readTime),r=r.insert(n,s)):!o.isValidDocument()||s.version.compareTo(o.version)>0||0===s.version.compareTo(o.version)&&o.hasPendingWrites?(t.addEntry(s),r=r.insert(n,s)):Xo("LocalStore","Ignoring outdated watch update for ",n,". Current version:",o.version," Watch version:",s.version)})),{cs:r,ls:i}}))}(e,s,t.documentUpdates).next((e=>{a=e.cs,c=e.ls}))),!r.isEqual(wa.min())){const t=n.Qr.getLastRemoteSnapshotVersion(e).next((t=>n.Qr.setTargetsMetadata(e,e.currentSequenceNumber,r)));o.push(t)}return Ra.waitFor(o).next((()=>s.apply(e))).next((()=>n.localDocuments.getLocalViewOfDocuments(e,a,c))).next((()=>a))})).then((e=>(n.ns=i,e)))}(n.localStore,t);t.targetChanges.forEach(((e,t)=>{const r=n.Sa.get(t);r&&(ta(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1),e.addedDocuments.size>0?r.ma=!0:e.modifiedDocuments.size>0?ta(r.ma):e.removedDocuments.size>0&&(ta(r.ma),r.ma=!1))})),await sf(n,e,t)}catch(e){await Da(e)}}function Kd(e,t,n){const r=na(e);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){const e=[];r.ga.forEach(((n,r)=>{const i=r.view.U_(t);i.snapshot&&e.push(i.snapshot)})),function(e,t){const n=na(e);n.onlineState=t;let r=!1;n.queries.forEach(((e,n)=>{for(const e of n.Q_)e.U_(t)&&(r=!0)})),r&&Md(n)}(r.eventManager,t),e.length&&r.fa.u_(e),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}async function Wd(e,t,n){const r=na(e);r.sharedClientState.updateQueryState(t,"rejected",n);const i=r.Sa.get(t),s=i&&i.key;if(s){let e=new Ka(Ia.comparator);e=e.insert(s,kc.newNoDocument(s,wa.min()));const n=Cu().add(s),i=new yl(wa.min(),new Map,new Ka(ga),e,n);await Gd(r,i),r.wa=r.wa.remove(s),r.Sa.delete(t),rf(r)}else await Rh(r.localStore,t,!1).then((()=>Zd(r,t,n))).catch(Da)}async function Qd(e,t){const n=na(e),r=t.batch.batchId;try{const e=await function(e,t){const n=na(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(e=>{const r=t.batch.keys(),i=n.os.newChangeBuffer({trackRemovals:!0});return function(e,t,n,r){const i=n.batch,s=i.keys();let o=Ra.resolve();return s.forEach((e=>{o=o.next((()=>r.getEntry(t,e))).next((t=>{const s=n.docVersions.get(e);ta(null!==s),t.version.compareTo(s)<0&&(i.applyToRemoteDocument(t,n),t.isValidDocument()&&(t.setReadTime(n.commitVersion),r.addEntry(t)))}))})),o.next((()=>e.mutationQueue.removeMutationBatch(t,i)))}(n,e,t,i).next((()=>i.apply(e))).next((()=>n.mutationQueue.performConsistencyCheck(e))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t.batch.batchId))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=Cu();for(let n=0;n<e.mutationResults.length;++n)e.mutationResults[n].transformResults.length>0&&(t=t.add(e.batch.mutations[n].key));return t}(t)))).next((()=>n.localDocuments.getDocuments(e,r)))}))}(n.localStore,t);Jd(n,r,null),Yd(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await sf(n,e)}catch(e){await Da(e)}}async function Xd(e,t,n){const r=na(e);try{const e=await function(e,t){const n=na(e);return n.persistence.runTransaction("Reject batch","readwrite-primary",(e=>{let r;return n.mutationQueue.lookupMutationBatch(e,t).next((t=>(ta(null!==t),r=t.keys(),n.mutationQueue.removeMutationBatch(e,t)))).next((()=>n.mutationQueue.performConsistencyCheck(e))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,r))).next((()=>n.localDocuments.getDocuments(e,r)))}))}(r.localStore,t);Jd(r,t,n),Yd(r,t),r.sharedClientState.updateMutationState(t,"rejected",n),await sf(r,e)}catch(n){await Da(n)}}function Yd(e,t){(e.Ca.get(t)||[]).forEach((e=>{e.resolve()})),e.Ca.delete(t)}function Jd(e,t,n){const r=na(e);let i=r.Da[r.currentUser.toKey()];if(i){const e=i.get(t);e&&(n?e.reject(n):e.resolve(),i=i.remove(t)),r.Da[r.currentUser.toKey()]=i}}function Zd(e,t,n=null){e.sharedClientState.removeLocalQueryTarget(t);for(const r of e.pa.get(t))e.ga.delete(r),n&&e.fa.xa(r,n);e.pa.delete(t),e.isPrimaryClient&&e.ba.Vr(t).forEach((t=>{e.ba.containsKey(t)||ef(e,t)}))}function ef(e,t){e.ya.delete(t.path.canonicalString());const n=e.wa.get(t);null!==n&&(td(e.remoteStore,n),e.wa=e.wa.remove(t),e.Sa.delete(n),rf(e))}function tf(e,t,n){for(const r of n)r instanceof Fd?(e.ba.addReference(r.key,t),nf(e,r)):r instanceof Vd?(Xo("SyncEngine","Document no longer in limbo: "+r.key),e.ba.removeReference(r.key,t),e.ba.containsKey(r.key)||ef(e,r.key)):ea()}function nf(e,t){const n=t.key,r=n.path.canonicalString();e.wa.get(n)||e.ya.has(r)||(Xo("SyncEngine","New document in limbo: "+n),e.ya.add(r),rf(e))}function rf(e){for(;e.ya.size>0&&e.wa.size<e.maxConcurrentLimboResolutions;){const t=e.ya.values().next().value;e.ya.delete(t);const n=new Ia(_a.fromString(t)),r=e.va.next();e.Sa.set(r,new zd(n)),e.wa=e.wa.insert(n,r),ed(e.remoteStore,new nh(ou(nu(n.path)),r,"TargetPurposeLimboResolution",ja._e))}}async function sf(e,t,n){const r=na(e),i=[],s=[],o=[];r.ga.isEmpty()||(r.ga.forEach(((e,a)=>{o.push(r.Ma(a,t,n).then((e=>{if((e||n)&&r.isPrimaryClient&&r.sharedClientState.updateQueryState(a.targetId,(null==e?void 0:e.fromCache)?"not-current":"current"),e){i.push(e);const t=Ih.Ki(a.targetId,e);s.push(t)}})))})),await Promise.all(o),r.fa.u_(i),await async function(e,t){const n=na(e);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(e=>Ra.forEach(t,(t=>Ra.forEach(t.qi,(r=>n.persistence.referenceDelegate.addReference(e,t.targetId,r))).next((()=>Ra.forEach(t.Qi,(r=>n.persistence.referenceDelegate.removeReference(e,t.targetId,r)))))))))}catch(e){if(!Ma(e))throw e;Xo("LocalStore","Failed to update sequence numbers: "+e)}for(const e of t){const t=e.targetId;if(!e.fromCache){const e=n.ns.get(t),r=e.snapshotVersion,i=e.withLastLimboFreeSnapshotVersion(r);n.ns=n.ns.insert(t,i)}}}(r.localStore,s))}async function of(e,t){const n=na(e);if(!n.currentUser.isEqual(t)){Xo("SyncEngine","User change. New user:",t.toKey());const e=await kh(n.localStore,t);n.currentUser=t,function(e,t){e.Ca.forEach((e=>{e.forEach((e=>{e.reject(new ia(ra.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),e.Ca.clear()}(n),n.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),await sf(n,e.us)}}function af(e,t){const n=na(e),r=n.Sa.get(t);if(r&&r.ma)return Cu().add(r.key);{let e=Cu();const r=n.pa.get(t);if(!r)return e;for(const t of r){const r=n.ga.get(t);e=e.unionWith(r.view.la)}return e}}function cf(e){const t=na(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=Qd.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=Xd.bind(null,t),t}class uf{constructor(){this.synchronizeTabs=!1}async initialize(e){this.serializer=$h(e.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(e),this.persistence=this.createPersistence(e),await this.persistence.start(),this.localStore=this.createLocalStore(e),this.gcScheduler=this.createGarbageCollectionScheduler(e,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(e,this.localStore)}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return function(e,t,n,r){return new Ah(e,t,n,r)}(this.persistence,new Ch,e.initialUser,this.serializer)}createPersistence(e){return new _h(bh.Hr,this.serializer)}createSharedClientState(e){return new Ph}async terminate(){var e,t;null===(e=this.gcScheduler)||void 0===e||e.stop(),null===(t=this.indexBackfillerScheduler)||void 0===t||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class lf{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>Kd(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=of.bind(null,this.syncEngine),await async function(e,t){const n=na(e);t?(n.v_.delete(2),await Jh(n)):t||(n.v_.add(2),await Zh(n),n.x_.set("Unknown"))}(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new Rd}createDatastore(e){const t=$h(e.databaseInfo.databaseId),n=function(e){return new zh(e)}(e.databaseInfo);return function(e,t,n,r){return new Qh(e,t,n,r)}(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return function(e,t,n,r,i){return new Yh(e,t,n,r,i)}(this.localStore,this.datastore,e.asyncQueue,(e=>Kd(this.syncEngine,e,0)),Mh.D()?new Mh:new xh)}createSyncEngine(e,t){return function(e,t,n,r,i,s,o){const a=new qd(e,t,n,r,i,s);return o&&(a.Fa=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e;await async function(e){const t=na(e);Xo("RemoteStore","RemoteStore shutting down."),t.v_.add(5),await Zh(t),t.M_.shutdown(),t.x_.set("Unknown")}(this.remoteStore),null===(e=this.datastore)||void 0===e||e.terminate()}}class hf{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Ba(this.observer.next,e)}error(e){this.observer.error?this.Ba(this.observer.error,e):Yo("Uncaught Error in snapshot listener:",e.toString())}La(){this.muted=!0}Ba(e,t){this.muted||setTimeout((()=>{this.muted||e(t)}),0)}}class df{constructor(e,t,n,r){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=Go.UNAUTHENTICATED,this.clientId=ma.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,(async e=>{Xo("FirestoreClient","Received user=",e.uid),await this.authCredentialListener(e),this.user=e})),this.appCheckCredentials.start(n,(e=>(Xo("FirestoreClient","Received new app check token=",e),this.appCheckCredentialListener(e,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new ia(ra.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const e=new sa;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const n=Cd(t,"Failed to shutdown persistence");e.reject(n)}})),e.promise}}async function ff(e,t){e.asyncQueue.verifyOperationInProgress(),Xo("FirestoreClient","Initializing OfflineComponentProvider");const n=e.configuration;await t.initialize(n);let r=n.initialUser;e.setCredentialChangeListener((async e=>{r.isEqual(e)||(await kh(t.localStore,e),r=e)})),t.persistence.setDatabaseDeletedListener((()=>e.terminate())),e._offlineComponents=t}async function pf(e,t){e.asyncQueue.verifyOperationInProgress();const n=await async function(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){Xo("FirestoreClient","Using user provided OfflineComponentProvider");try{await ff(e,e._uninitializedComponentsProvider._offline)}catch(t){const n=t;if(!function(e){return"FirebaseError"===e.name?e.code===ra.FAILED_PRECONDITION||e.code===ra.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&e instanceof DOMException)||22===e.code||20===e.code||11===e.code}(n))throw n;Jo("Error using user provided cache. Falling back to memory cache: "+n),await ff(e,new uf)}}else Xo("FirestoreClient","Using default OfflineComponentProvider"),await ff(e,new uf);return e._offlineComponents}(e);Xo("FirestoreClient","Initializing OnlineComponentProvider"),await t.initialize(n,e.configuration),e.setCredentialChangeListener((e=>Td(t.remoteStore,e))),e.setAppCheckTokenChangeListener(((e,n)=>Td(t.remoteStore,n))),e._onlineComponents=t}async function mf(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(Xo("FirestoreClient","Using user provided OnlineComponentProvider"),await pf(e,e._uninitializedComponentsProvider._online)):(Xo("FirestoreClient","Using default OnlineComponentProvider"),await pf(e,new lf))),e._onlineComponents}async function gf(e){const t=await mf(e),n=t.eventManager;return n.onListen=$d.bind(null,t.syncEngine),n.onUnlisten=Hd.bind(null,t.syncEngine),n}function yf(e){const t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}const vf=new Map;function wf(e,t,n){if(!n)throw new ia(ra.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function Ef(e){if(!Ia.isDocumentKey(e))throw new ia(ra.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function _f(e){if(Ia.isDocumentKey(e))throw new ia(ra.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function Tf(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{const t=function(e){return e.constructor?e.constructor.name:null}(e);return t?`a custom ${t} object`:"an object"}}return"function"==typeof e?"a function":ea()}function bf(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new ia(ra.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=Tf(e);throw new ia(ra.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}class If{constructor(e){var t,n;if(void 0===e.host){if(void 0!==e.ssl)throw new ia(ra.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new ia(ra.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}(function(e,t,n,r){if(!0===t&&!0===r)throw new ia(ra.INVALID_ARGUMENT,"experimentalForceLongPolling and experimentalAutoDetectLongPolling cannot be used together.")})(0,e.experimentalForceLongPolling,0,e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=yf(null!==(n=e.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new ia(ra.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<5)throw new ia(ra.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is 5)`);if(e.timeoutSeconds>30)throw new ia(ra.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(e,t){return e.timeoutSeconds===t.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Sf{constructor(e,t,n,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new If({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new ia(ra.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new ia(ra.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new If(e),void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new aa;switch(e.type){case"firstParty":return new ha(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new ia(ra.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=vf.get(e);t&&(Xo("ComponentProvider","Removing Datastore"),vf.delete(e),t.terminate())}(this),Promise.resolve()}}class Cf{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new Cf(this.firestore,e,this._query)}}class Af{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new kf(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Af(this.firestore,e,this._key)}}class kf extends Cf{constructor(e,t,n){super(e,t,nu(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Af(this.firestore,null,new Ia(e))}withConverter(e){return new kf(this.firestore,e,this._path)}}function Nf(e,t,...n){if(e=b(e),wf("collection","path",t),e instanceof Sf){const r=_a.fromString(t,...n);return _f(r),new kf(e,null,r)}{if(!(e instanceof Af||e instanceof kf))throw new ia(ra.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=e._path.child(_a.fromString(t,...n));return _f(r),new kf(e.firestore,null,r)}}function Df(e,t,...n){if(e=b(e),1===arguments.length&&(t=ma.newId()),wf("doc","path",t),e instanceof Sf){const r=_a.fromString(t,...n);return Ef(r),new Af(e,null,new Ia(r))}{if(!(e instanceof Af||e instanceof kf))throw new ia(ra.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=e._path.child(_a.fromString(t,...n));return Ef(r),new Af(e.firestore,e instanceof kf?e.converter:null,new Ia(r))}}class Rf{constructor(){this.Xa=Promise.resolve(),this.eu=[],this.tu=!1,this.nu=[],this.ru=null,this.iu=!1,this.su=!1,this.ou=[],this.jo=new Hh(this,"async_queue_retry"),this._u=()=>{const e=qh();e&&Xo("AsyncQueue","Visibility state changed to "+e.visibilityState),this.jo.Ko()};const e=qh();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this._u)}get isShuttingDown(){return this.tu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.au(),this.uu(e)}enterRestrictedMode(e){if(!this.tu){this.tu=!0,this.su=e||!1;const t=qh();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this._u)}}enqueue(e){if(this.au(),this.tu)return new Promise((()=>{}));const t=new sa;return this.uu((()=>this.tu&&this.su?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.eu.push(e),this.cu())))}async cu(){if(0!==this.eu.length){try{await this.eu[0](),this.eu.shift(),this.jo.reset()}catch(e){if(!Ma(e))throw e;Xo("AsyncQueue","Operation failed with retryable error: "+e)}this.eu.length>0&&this.jo.qo((()=>this.cu()))}}uu(e){const t=this.Xa.then((()=>(this.iu=!0,e().catch((e=>{this.ru=e,this.iu=!1;const t=function(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}(e);throw Yo("INTERNAL UNHANDLED ERROR: ",t),e})).then((e=>(this.iu=!1,e))))));return this.Xa=t,t}enqueueAfterDelay(e,t,n){this.au(),this.ou.indexOf(e)>-1&&(t=0);const r=Sd.createAndSchedule(this,e,t,n,(e=>this.lu(e)));return this.nu.push(r),r}au(){this.ru&&ea()}verifyOperationInProgress(){}async hu(){let e;do{e=this.Xa,await e}while(e!==this.Xa)}Pu(e){for(const t of this.nu)if(t.timerId===e)return!0;return!1}Iu(e){return this.hu().then((()=>{this.nu.sort(((e,t)=>e.targetTimeMs-t.targetTimeMs));for(const t of this.nu)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.hu()}))}Tu(e){this.ou.push(e)}lu(e){const t=this.nu.indexOf(e);this.nu.splice(t,1)}}function Lf(e){return function(e,t){if("object"!=typeof e||null===e)return!1;const n=e;for(const e of["next","error","complete"])if(e in n&&"function"==typeof n[e])return!0;return!1}(e)}class Of extends Sf{constructor(e,t,n,r){super(e,t,n,r),this.type="firestore",this._queue=new Rf,this._persistenceKey=(null==r?void 0:r.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||xf(this),this._firestoreClient.terminate()}}function Pf(e){return e._firestoreClient||xf(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}function xf(e){var t,n,r;const i=e._freezeSettings(),s=function(e,t,n,r){return new cc(e,t,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,yf(r.experimentalLongPollingOptions),r.useFetchStreams)}(e._databaseId,(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",e._persistenceKey,i);e._firestoreClient=new df(e._authCredentials,e._appCheckCredentials,e._queue,s),(null===(n=i.localCache)||void 0===n?void 0:n._offlineComponentProvider)&&(null===(r=i.localCache)||void 0===r?void 0:r._onlineComponentProvider)&&(e._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.localCache.kind,_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider})}class Mf{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Mf(ec.fromBase64String(e))}catch(e){throw new ia(ra.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new Mf(ec.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class Uf{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new ia(ra.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ba(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class Ff{constructor(e){this._methodName=e}}class Vf{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new ia(ra.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new ia(ra.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return ga(this._lat,e._lat)||ga(this._long,e._long)}}const Bf=/^__.*__$/;function jf(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw ea()}}class zf{constructor(e,t,n,r,i,s){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===i&&this.Eu(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get du(){return this.settings.du}Au(e){return new zf(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Ru(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.Au({path:n,Vu:!1});return r.mu(e),r}fu(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.Au({path:n,Vu:!1});return r.Eu(),r}gu(e){return this.Au({path:void 0,Vu:!0})}pu(e){return Kf(e,this.settings.methodName,this.settings.yu||!1,this.path,this.settings.wu)}contains(e){return void 0!==this.fieldMask.find((t=>e.isPrefixOf(t)))||void 0!==this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))}Eu(){if(this.path)for(let e=0;e<this.path.length;e++)this.mu(this.path.get(e))}mu(e){if(0===e.length)throw this.pu("Document fields must not be empty");if(jf(this.du)&&Bf.test(e))throw this.pu('Document fields cannot begin and end with "__"')}}class qf{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||$h(e)}Su(e,t,n,r=!1){return new zf({du:e,methodName:t,wu:n,path:ba.emptyPath(),Vu:!1,yu:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function $f(e,t){if(Hf(e=b(e)))return function(e,t,n){if(!Hf(n)||!function(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}(n)){const r=Tf(n);throw"an object"===r?t.pu(e+" a custom object"):t.pu(e+" "+r)}}("Unsupported field value:",t,e),function(e,t){const n={};return Ga(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):Ha(e,((e,r)=>{const i=$f(r,t.Ru(e));null!=i&&(n[e]=i)})),{mapValue:{fields:n}}}(e,t);if(e instanceof Ff)return function(e,t){if(!jf(t.du))throw t.pu(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.pu(`${e._methodName}() is not currently supported inside arrays`);const n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.Vu&&4!==t.du)throw t.pu("Nested arrays are not supported");return function(e,t){const n=[];let r=0;for(const i of e){let e=$f(i,t.gu(r));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),r++}return{arrayValue:{values:n}}}(e,t)}return function(e,t){if(null===(e=b(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return Du(t.serializer,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){const n=va.fromDate(e);return{timestampValue:Rl(t.serializer,n)}}if(e instanceof va){const n=new va(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:Rl(t.serializer,n)}}if(e instanceof Vf)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof Mf)return{bytesValue:Ll(t.serializer,e._byteString)};if(e instanceof Af){const n=t.databaseId,r=e.firestore._databaseId;if(!r.isEqual(n))throw t.pu(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:xl(e.firestore._databaseId||t.databaseId,e._key.path)}}throw t.pu(`Unsupported field value: ${Tf(e)}`)}(e,t)}function Hf(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof va||e instanceof Vf||e instanceof Mf||e instanceof Af||e instanceof Ff)}const Gf=new RegExp("[~\\*/\\[\\]]");function Kf(e,t,n,r,i){const s=r&&!r.isEmpty(),o=void 0!==i;let a=`Function ${t}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(s||o)&&(c+=" (found",s&&(c+=` in field ${r}`),o&&(c+=` in document ${i}`),c+=")"),new ia(ra.INVALID_ARGUMENT,a+e+c)}class Wf{constructor(e,t,n,r,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new Af(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new Qf(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Xf("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class Qf extends Wf{data(){return super.data()}}function Xf(e,t){return"string"==typeof t?function(e,t,n){if(t.search(Gf)>=0)throw Kf(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,n);try{return new Uf(...t.split("."))._internalPath}catch(r){throw Kf(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,n)}}(e,t):t instanceof Uf?t._internalPath:t._delegate._internalPath}function Yf(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new ia(ra.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Jf{}class Zf extends Jf{}function ep(e,t,...n){let r=[];t instanceof Jf&&r.push(t),r=r.concat(n),function(e){const t=e.filter((e=>e instanceof rp)).length,n=e.filter((e=>e instanceof tp)).length;if(t>1||t>0&&n>0)throw new ia(ra.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const t of r)e=t._apply(e);return e}class tp extends Zf{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new tp(e,t,n)}_apply(e){const t=this._parse(e);return cp(e._query,t),new Cf(e.firestore,e.converter,au(e._query,t))}_parse(e){const t=function(e){const t=e._freezeSettings(),n=$h(e._databaseId);return new qf(e._databaseId,!!t.ignoreUndefinedProperties,n)}(e.firestore),n=function(e,t,n,r,i,s,o){let a;if(i.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new ia(ra.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if("in"===s||"not-in"===s){ap(o,s);const t=[];for(const n of o)t.push(op(r,e,n));a={arrayValue:{values:t}}}else a=op(r,e,o)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||ap(o,s),a=function(e,t,n,r=!1){return $f(n,e.Su(r?4:3,t))}(n,"where",o,"in"===s||"not-in"===s);return xc.create(i,s,a)}(e._query,0,t,e.firestore._databaseId,this._field,this._op,this._value);return n}}function np(e,t,n){const r=t,i=Xf("where",e);return tp._create(i,r,n)}class rp extends Jf{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new rp(e,t)}_parse(e){const t=this._queryConstraints.map((t=>t._parse(e))).filter((e=>e.getFilters().length>0));return 1===t.length?t[0]:Mc.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(e,t){let n=e;const r=t.getFlattenedFilters();for(const e of r)cp(n,e),n=au(n,e)}(e._query,t),new Cf(e.firestore,e.converter,au(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class ip extends Zf{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new ip(e,t)}_apply(e){const t=function(e,t,n){if(null!==e.startAt)throw new ia(ra.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new ia(ra.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Lc(t,n)}(e._query,this._field,this._direction);return new Cf(e.firestore,e.converter,function(e,t){const n=e.explicitOrderBy.concat([t]);return new tu(e.path,e.collectionGroup,n,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(e._query,t))}}function sp(e,t="asc"){const n=t,r=Xf("orderBy",e);return ip._create(r,n)}function op(e,t,n){if("string"==typeof(n=b(n))){if(""===n)throw new ia(ra.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!iu(t)&&-1!==n.indexOf("/"))throw new ia(ra.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=t.path.child(_a.fromString(n));if(!Ia.isDocumentKey(r))throw new ia(ra.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return vc(e,new Ia(r))}if(n instanceof Af)return vc(e,n._key);throw new ia(ra.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Tf(n)}.`)}function ap(e,t){if(!Array.isArray(e)||0===e.length)throw new ia(ra.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function cp(e,t){const n=function(e,t){for(const n of e)for(const e of n.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}(e.filters,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==n)throw n===t.op?new ia(ra.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new ia(ra.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${n.toString()}' filters.`)}class up{convertValue(e,t="none"){switch(hc(e)){case 0:return null;case 1:return e.booleanValue;case 2:return rc(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(ic(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw ea()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const n={};return Ha(e,((e,r)=>{n[e]=this.convertValue(r,t)})),n}convertGeoPoint(e){return new Vf(rc(e.latitude),rc(e.longitude))}convertArray(e,t){return(e.values||[]).map((e=>this.convertValue(e,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const n=oc(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(ac(e));default:return null}}convertTimestamp(e){const t=nc(e);return new va(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=_a.fromString(e);ta(th(n));const r=new uc(n.get(1),n.get(3)),i=new Ia(n.popFirst(5));return r.isEqual(t)||Yo(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}class lp{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class hp extends Wf{constructor(e,t,n,r,i,s){super(e,t,n,r,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new dp(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(Xf("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class dp extends hp{data(e={}){return super.data(e)}}class fp{constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new lp(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach((n=>{e.call(t,new dp(this._firestore,this._userDataWriter,n.key,n,new lp(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new ia(ra.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map((n=>{const r=new dp(e._firestore,e._userDataWriter,n.doc.key,n.doc,new lp(e._snapshot.mutatedKeys.has(n.doc.key),e._snapshot.fromCache),e.query.converter);return n.doc,{type:"added",doc:r,oldIndex:-1,newIndex:t++}}))}{let n=e._snapshot.oldDocs;return e._snapshot.docChanges.filter((e=>t||3!==e.type)).map((t=>{const r=new dp(e._firestore,e._userDataWriter,t.doc.key,t.doc,new lp(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter);let i=-1,s=-1;return 0!==t.type&&(i=n.indexOf(t.doc.key),n=n.delete(t.doc.key)),1!==t.type&&(n=n.add(t.doc),s=n.indexOf(t.doc.key)),{type:pp(t.type),doc:r,oldIndex:i,newIndex:s}}))}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function pp(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return ea()}}class mp extends up{constructor(e){super(),this.firestore=e}convertBytes(e){return new Mf(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Af(this.firestore,null,t)}}function gp(e){e=bf(e,Cf);const t=bf(e.firestore,Of),n=Pf(t),r=new mp(t);return Yf(e._query),function(e,t,n={}){const r=new sa;return e.asyncQueue.enqueueAndForget((async()=>function(e,t,n,r,i){const s=new hf({next:n=>{t.enqueueAndForget((()=>Od(e,o))),n.fromCache&&"server"===r.source?i.reject(new ia(ra.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:e=>i.reject(e)}),o=new Ud(n,s,{includeMetadataChanges:!0,Z_:!0});return Ld(e,o)}(await gf(e),e.asyncQueue,t,n,r))),r.promise}(n,e._query).then((n=>new fp(t,r,e,n)))}function yp(e){return function(e,t){return function(e,t){const n=new sa;return e.asyncQueue.enqueueAndForget((async()=>async function(e,t,n){const r=cf(e);try{const e=await function(e,t){const n=na(e),r=va.now(),i=t.reduce(((e,t)=>e.add(t.key)),Cu());let s,o;return n.persistence.runTransaction("Locally write mutations","readwrite",(e=>{let a=yu(),c=Cu();return n.os.getEntries(e,i).next((e=>{a=e,a.forEach(((e,t)=>{t.isValidDocument()||(c=c.add(e))}))})).next((()=>n.localDocuments.getOverlayedDocuments(e,a))).next((i=>{s=i;const o=[];for(const e of t){const t=Xu(e,s.get(e.key).overlayedDocument);null!=t&&o.push(new Zu(e.key,t,Ac(t.value.mapValue),$u.exists(!0)))}return n.mutationQueue.addMutationBatch(e,r,o,t)})).next((t=>{o=t;const r=t.applyToLocalDocumentSet(s,c);return n.documentOverlayCache.saveOverlays(e,t.batchId,r)}))})).then((()=>({batchId:o.batchId,changes:Eu(s)})))}(r.localStore,t);r.sharedClientState.addPendingMutation(e.batchId),function(e,t,n){let r=e.Da[e.currentUser.toKey()];r||(r=new Ka(ga)),r=r.insert(t,n),e.Da[e.currentUser.toKey()]=r}(r,e.batchId,n),await sf(r,e.changes),await fd(r.remoteStore)}catch(e){const t=Cd(e,"Failed to persist write");n.reject(t)}}(await function(e){return mf(e).then((e=>e.syncEngine))}(e),t,n))),n.promise}(Pf(e),t)}(bf(e.firestore,Of),[new rl(e._key,$u.none())])}function vp(e,t,n){const r=n.docs.get(t._key),i=new mp(e);return new hp(e,i,t._key,r,new lp(n.hasPendingWrites,n.fromCache),t.converter)}new WeakMap,function(e,t=!0){!function(e){Ko=e}(he),ae(new I("firestore",((e,{instanceIdentifier:n,options:r})=>{const i=e.getProvider("app").getImmediate(),s=new Of(new ua(e.getProvider("auth-internal")),new fa(e.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new ia(ra.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new uc(e.options.projectId,t)}(i,n),i);return r=Object.assign({useFetchStreams:t},r),s._setSettings(r),s}),"PUBLIC").setMultipleInstances(!0)),pe(Ho,"4.4.2",e),pe(Ho,"4.4.2","esm2017")}(),pe("firebase","10.8.0","app");const wp=de({apiKey:"AIzaSyCG0zGyABlsi6tH9YJrK24Iy1CEJN6NM-s",authDomain:"heist-supervisor.firebaseapp.com",projectId:"heist-supervisor",storageBucket:"heist-supervisor.appspot.com",messagingSenderId:"991582455386",appId:"1:991582455386:web:766451a21a8ca17cf73a63",measurementId:"G-GZ10GLQXX7"}),Ep=function(e,t){const n="string"==typeof e?e:"(default)",r=ce("object"==typeof e?e:fe(),"firestore").getImmediate({identifier:n});if(!r._initialized){const e=c("firestore");e&&function(e,t,n,r={}){var s;const o=(e=bf(e,Sf))._getSettings(),a=`${t}:${n}`;if("firestore.googleapis.com"!==o.host&&o.host!==a&&Jo("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),e._setSettings(Object.assign(Object.assign({},o),{host:a,ssl:!1})),r.mockUserToken){let t,n;if("string"==typeof r.mockUserToken)t=r.mockUserToken,n=Go.MOCK_USER;else{t=function(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=t||"demo-project",r=e.iat||0,s=e.sub||e.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},e);return[i(JSON.stringify({alg:"none",type:"JWT"})),i(JSON.stringify(o)),""].join(".")}(r.mockUserToken,null===(s=e._app)||void 0===s?void 0:s.options.projectId);const o=r.mockUserToken.sub||r.mockUserToken.user_id;if(!o)throw new ia(ra.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new Go(o)}e._authCredentials=new ca(new oa(t,n))}}(r,...e)}return r}(wp),_p=function(e=fe()){const t=ce(e,"auth");if(t.isInitialized())return t.getImmediate();const n=function(e,t){const n=ce(e,"auth");if(n.isInitialized()){const e=n.getImmediate();if(g(n.getOptions(),null!=t?t:{}))return e;Re(e,"already-initialized")}return n.initialize({options:t})}(e,{persistence:[rn]}),r=a("auth");return r&&function(e,t,n){const r=wt(e);Pe(r._canInitEmulator,r,"emulator-config-failed"),Pe(/^https?:\/\//.test(t),r,"invalid-emulator-scheme");const i=!!(null==n?void 0:n.disableWarnings),s=St(t),{host:o,port:a}=function(e){const t=St(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){const e=i[1];return{host:e,port:Ct(r.substr(e.length+1))}}{const[e,t]=r.split(":");return{host:e,port:Ct(t)}}}(t),c=null===a?"":`:${a}`;r.config.emulator={url:`${s}//${o}${c}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:o,port:a,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:i})}),i||function(){function e(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}(n,`http://${r}`),n}();var Tp=n(300),bp=n.n(Tp);const Ip=function(e=fe(),t=vn){const n=ce(b(e),pn).getImmediate({identifier:t}),r=c("functions");return r&&function(e,t,n){!function(e,t,n){e.emulatorOrigin=`http://${t}:${n}`}(b(e),t,n)}(n,...r),n}(wp),Sp=In(Ip,"acceptInvitation"),Cp=In(Ip,"sendInvitation"),Ap=In(Ip,"sendMessage"),kp=In(Ip,"askForNewAuthToken");let Np,Dp,Rp,Lp,Op,Pp,xp;const Mp=localStorage.getItem("username");function Up(e){const t=function(n,r,i,s){return b(n).onAuthStateChanged((async n=>{let r=!1;n&&(r=!0,Lp=n,Op=n.uid,"homePage"!==Np&&Fp()),e(r),t()}),void 0,void 0)}(_p)}function Fp(){Np="homePage",Rp=document.getElementById("dynamicContent"),Rp.style.opacity=0;const e=new XMLHttpRequest;e.open("GET","../../public/nativeContent.html",!0),e.onreadystatechange=function(){4===e.readyState&&200===e.status&&setTimeout((()=>{Rp.innerHTML=bp().sanitize(e.responseText),Rp.style.opacity=1}),200)},e.send(),setTimeout(jp,300)}function Vp(){Dp=document.getElementById("buttonBack"),Rp=document.getElementById("dynamicContent"),"sendInvitePage"===Np||"manageChanelPage"===Np||"invitationPage"===Np?Dp.addEventListener("click",(()=>{Rp.style.opacity=0;const e=new XMLHttpRequest;e.open("GET","../../public/privateMessage.html",!0),e.onreadystatechange=function(){4===e.readyState&&200===e.status&&setTimeout((()=>{Rp.innerHTML=bp().sanitize(e.responseText),Rp.style.opacity=1}),200)},e.send(),setTimeout(Hp,300)}),{once:!0}):"chatingPage"===Np?Dp.addEventListener("click",(()=>{Rp.style.opacity=0;const e=new XMLHttpRequest;e.open("GET","../../public/privateMessage.html",!0),e.onreadystatechange=function(){4===e.readyState&&200===e.status&&setTimeout((()=>{Rp.innerHTML=bp().sanitize(e.responseText),Rp.style.opacity=1}),200)},e.send(),setTimeout((()=>{let e=chrome.runtime.getManifest().version;document.getElementById("headerElem").innerHTML=bp().sanitize(`\n        <img src="../app/assets/logo_256.png" draggable="false" />\n        <div style="display: table-column">\n        <h1 style="margin-bottom: 5px;">Heist Supervisor</h1>\n        <h2 style="font-size: medium; margin: 0px; text-align: right;" id="version">${e}</h2>\n    </div>\n        `)}),300),setTimeout(Hp,300)}),{once:!0}):Dp.addEventListener("click",(()=>{Fp()}),{once:!0})}function Bp(e,t,n=5e3){const r=document.createElement("div");r.className="notification","info"===e&&(r.innerHTML=bp().sanitize(`\n       <img src="../app/assets/infoLogo.png" class="stateLogo"\n    \n    <p>${t}</p>\n    `)),"error"===e?r.innerHTML=bp().sanitize(`\n    \n      <img src="../app/assets/errorLogo.png" class="stateLogo"\n    \n    <p>${t}</p>\n    `):"valid"===e&&(r.innerHTML=bp().sanitize(`\n    \n      <img src="../app/assets/validLogo.png" class="stateLogo"\n    \n    <p>${t}</p>\n    `));const i=document.getElementById("notifContent");i.appendChild(r),setTimeout((()=>{r.classList.add("slideIn")}),100),n>0&&setTimeout((()=>{r.classList.remove("slideIn"),r.classList.add("slideOut"),r.addEventListener("transitionend",(function e(){r.removeEventListener("transitionend",e),i.removeChild(r)}))}),n)}async function jp(){const e=document.getElementById("buttonSignIn"),t=(await Jp(["publicAdress"])).publicAdress;Up((n=>{console.log(n),n?(e.textContent=zp(t),e.className="connectedButton",e.style.cursor="default",e.disabled=!0):(e.textContent="connect",e.addEventListener("click",Yp),e.click())})),Np="homePage";const n=document.getElementById("docButton");document.getElementById("loadingOverlayHome").style.display="none",document.getElementById("dynamicContent").style.display="flex";const r=document.getElementById("buttonPricePage"),i=document.getElementById("dynamicContent"),s=document.getElementById("buttonDM"),o=document.getElementById("registerWebsite");o&&o.addEventListener("click",(()=>{window.open("https://heist-supervisor.web.app/","_blank")})),n&&n.addEventListener("click",(()=>{window.open("https://heist-supervisor.gitbook.io/heist-supervisor/","_blank")}),{once:!0}),document.getElementById("inGameMiscButton").addEventListener("click",(()=>{Bp("error","Element disabled for now",3e3)}),{once:!0}),s.addEventListener("click",(()=>{try{Up((async e=>{if(e)if(Xp(s),localStorage.getItem("username")){const e=new XMLHttpRequest;e.open("GET","../../public/privateMessage.html",!0),e.onreadystatechange=function(){4===e.readyState&&200===e.status&&setTimeout((()=>{i.innerHTML=bp().sanitize(e.responseText),i.style.opacity=1}),200)},e.send(),setTimeout(Hp,300)}else{const e=Df(Ep,"users",Op),t=await function(e){e=bf(e,Af);const t=bf(e.firestore,Of);return function(e,t,n={}){const r=new sa;return e.asyncQueue.enqueueAndForget((async()=>function(e,t,n,r,i){const s=new hf({next:s=>{t.enqueueAndForget((()=>Od(e,o)));const a=s.docs.has(n);!a&&s.fromCache?i.reject(new ia(ra.UNAVAILABLE,"Failed to get document because the client is offline.")):a&&s.fromCache&&r&&"server"===r.source?i.reject(new ia(ra.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(s)},error:e=>i.reject(e)}),o=new Ud(nu(n.path),s,{includeMetadataChanges:!0,Z_:!0});return Ld(e,o)}(await gf(e),e.asyncQueue,t,n,r))),r.promise}(Pf(t),e._key).then((n=>vp(t,e,n)))}(e);if(t.exists){const e=t.data();if(e.username){localStorage.setItem(e.username);const t=new XMLHttpRequest;t.open("GET","../../public/privateMessage.html",!0),t.onreadystatechange=function(){4===t.readyState&&200===t.status&&setTimeout((()=>{i.innerHTML=bp().sanitize(t.responseText),i.style.opacity=1}),200)},t.send(),setTimeout(Hp,300)}else{const e=new XMLHttpRequest;e.open("GET","../../public/setUsername.html",!0),e.onreadystatechange=function(){4===e.readyState&&200===e.status&&setTimeout((()=>{i.innerHTML=bp().sanitize(e.responseText),i.style.opacity=1}),200)},e.send(),setTimeout($p,300)}}}else Bp("error","You need to Log-in First.",3e3)}))}catch(e){console.error(e)}})),r.addEventListener("click",(()=>{Up((e=>{if(e){i.style.opacity=0;const e=new XMLHttpRequest;e.open("GET","../../public/pricePage.html",!0),e.onreadystatechange=function(){4===e.readyState&&200===e.status&&setTimeout((()=>{i.innerHTML=bp().sanitize(e.responseText),i.style.opacity=1}),200)},e.send(),setTimeout(qp,300)}else Bp("error","You need to Log-in First.",3e3)}))}))}function zp(e){return e.length>8?e.substring(0,4)+"..."+e.substring(e.length-4):e}async function qp(){Np="pricePage",Dp=document.getElementById("buttonBack"),Rp=document.getElementById("dynamicContent");const e=document.getElementById("tradekiwi"),t=document.getElementById("tradeNana");let n=0;const r=document.getElementById("loadingOverlayPrice"),i=document.createElement("p");i.textContent=n+"/3",i.id="elementsLoaded",i.style.color="#e2e8c0",i.style.fontFamily="Bangers",r.appendChild(i);try{const r=await async function(){try{const e={method:"GET",headers:{accept:"application/json"}},t=await fetch("https://api.coingecko.com/api/v3/simple/price?ids=kiwi-token-2&vs_currencies=usd&include_24hr_change=true",e);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const n=await t.json();let r=n["kiwi-token-2"].usd_24h_change,i=parseFloat(r).toFixed(2),s=n["kiwi-token-2"].usd,o=parseFloat(s).toFixed(6),a=document.getElementById("kiwiPrice");a.innerHTML="";const c=document.createElement("span"),u=document.createElement("img");u.src="../app/assets/kiwiLogo.png",u.classList.add("logo"),c.appendChild(u);const l=document.createTextNode(` $KIWI = $${o} (USD) ${i}%`);return a.appendChild(c),a.appendChild(l),a.style.color=i<=0?"#f45b69":"#00c377",!0}catch(e){return console.error("Error fetching the kiwi price:",e),!1}}();if(!r){const e=new Error("Failed to fetch");throw e.code=429,e.status="FETCH_FAILED",e}n++,document.getElementById("elementsLoaded").textContent=n+"/3";const i=await async function(){try{const e={method:"GET",headers:{accpet:"application/json"}},t=await fetch("https://api.coingecko.com/api/v3/simple/price?ids=solana&vs_currencies=usd&include_24hr_change=true",e);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const n=await t.json();let r=n.solana.usd_24h_change,i=parseFloat(r).toFixed(2),s=n.solana.usd,o=parseFloat(s).toFixed(3),a=document.getElementById("solPrice");a.innerHTML="";const c=document.createElement("span"),u=document.createElement("img");u.src="../app/assets/solLogo.png",u.classList.add("logo"),c.appendChild(u);const l=document.createTextNode(` $SOL = $${o} (USD) ${i}%`);return a.appendChild(c),a.appendChild(l),a.style.color=i<=0?"#f45b69":"#00c377",!0}catch(e){return console.error("Error fetching the solana price:",e),!1}}();if(!i){const e=new Error("Failed to fetch");throw e.code=429,e.status="FETCH_FAILED",e}n++,document.getElementById("elementsLoaded").textContent=n+"/3";const s=await async function(){try{const e={method:"GET",headers:{accept:"application/json"}},t=await fetch("https://api.coingecko.com/api/v3/simple/price?ids=nana-token&vs_currencies=usd&include_24hr_change=true",e);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const n=await t.json();let r=n["nana-token"].usd_24h_change,i=parseFloat(r).toFixed(2),s=n["nana-token"].usd,o=parseFloat(s).toFixed(6),a=document.getElementById("nanaPrice");a.innerHTML="";const c=document.createElement("span"),u=document.createElement("img");u.src="../app/assets/nanaLogo.png",u.classList.add("logo"),c.appendChild(u);const l=document.createTextNode(` $NANA = $${o} (USD) ${i}%`);return a.appendChild(c),a.appendChild(l),a.style.color=i<=0?"#f45b69":"#00c377",!0}catch(e){return console.error("Error fetching the nana price:",e),!1}}();if(!s){const e=new Error("Failed to fetch");throw e.code=429,e.status="FETCH_FAILED",e}n++,document.getElementById("elementsLoaded").textContent=n+"/3",r&&i&&s&&(document.getElementById("loadingOverlayPrice").style.display="none",document.getElementById("dynamicContent").style.display="flex"),e.addEventListener("click",(()=>{window.open("https://birdeye.so/token/74DSHnK1qqr4z1pXjLjPAVi8XFngZ635jEVpdkJtnizQ?chain=solana","blank")})),t.addEventListener("click",(()=>{window.open("https://birdeye.so/token/HxRELUQfvvjToVbacjr9YECdfQMUqGgPYB68jVDYxkbr?chain=solana","_blank")}))}catch(e){console.log(e.code),console.log(e.message),429===e.code&&Bp("error","Too much request try again in a minute",5e3)}Vp()}function $p(){const e=document.getElementById("dynamicContent");document.getElementById("submitPlayerInfo").addEventListener("click",(()=>{try{const t=document.getElementById("playerName").value;if(t.length>=3){(async function(e,{displayName:t,photoURL:n}){if(void 0===t&&void 0===n)return;const r=b(e),i={idToken:await r.getIdToken(),displayName:t,photoUrl:n,returnSecureToken:!0},s=await tt(r,async function(e,t){return qe(e,"POST","/v1/accounts:update",t)}(r.auth,i));r.displayName=s.displayName||null,r.photoURL=s.photoUrl||null;const o=r.providerData.find((({providerId:e})=>"password"===e));o&&(o.displayName=r.displayName,o.photoURL=r.photoURL),await r._updateTokensIfNecessary(s)})(Lp,{displayName:t}),localStorage.setItem("username",t);const n=new XMLHttpRequest;n.open("GET","../../public/privateMessage.html",!0),n.onreadystatechange=function(){4===n.readyState&&200===n.status&&setTimeout((()=>{e.innerHTML=bp().sanitize(n.responseText),e.style.opacity=1}),200)},n.send(),setTimeout(Hp,300)}else Bp("error","Username need to be more then 2 letter",3e3)}catch(e){console.error(e)}}))}function Hp(){Np="privateMessagePage",Dp=document.getElementById("buttonBack"),Rp=document.getElementById("dynamicContent"),Vp(),document.getElementById("buttonCreate").addEventListener("click",(()=>{Np="sendInvitePage",Rp=document.getElementById("dynamicContent"),Rp.style.opacity=0;const e=new XMLHttpRequest;e.open("GET","../../public/sendInvite.html",!0),e.onreadystatechange=function(){4===e.readyState&&200===e.status&&setTimeout((()=>{Rp.innerHTML=bp().sanitize(e.responseText),Rp.style.opacity=1}),200)},e.send(),setTimeout((()=>{Vp(),document.getElementById("sendInvite").addEventListener("click",(()=>{const e=document.getElementById("sendInvite");Xp(e),async function(){const e=document.getElementById("walletAdress").value;if(!e)return void Bp("error","You need to enter a valid adress",3e3);const t=ep(Nf(Ep,"users"),np("wallet","==",e)),n=await gp(t);if(0===n.size)return void Bp("error","Error : un-registered Adress.",3e3);n.forEach((e=>{Pp=e.data().uid,xp=e.data().username}));const r=localStorage.getItem("username");try{return(await Cp({message:e,player1:r,player2:xp,uid2:Pp})).data.status}catch(e){console.error(e)}}().then((t=>{"sent"===t?(Bp("valid","Invitation sent successfully.",3e3),e.style.color="#313131",e.className="button",e.textContent="send invite",e.style.backgroundColor="#e2e8c0",e.id="sendInvite"):"already exist"===t?(Bp("error","Error : Session already Exist.",3e3),e.style.color="#313131",e.className="button",e.style.backgroundColor="#e2e8c0",e.id="sendInvite",e.textContent="send invite"):setTimeout((()=>{e.style.color="#313131",e.className="button",e.style.backgroundColor="#e2e8c0",e.id="sendInvite"}),2e3)}))}))}),300)})),document.getElementById("buttonInvitation").addEventListener("click",(()=>{Np="invitationPage",Rp=document.getElementById("dynamicContent"),Rp.style.opacity=0;const e=new XMLHttpRequest;e.open("GET","../../public/invitationPage.html",!0),e.onreadystatechange=function(){4===e.readyState&&200===e.status&&setTimeout((()=>{Rp.innerHTML=bp().sanitize(e.responseText),Rp.style.opacity=1}),200)},e.send(),setTimeout((()=>{!async function(){Vp();const e=document.getElementById("invitationList"),t=ep(Nf(Ep,"privateMessage"),np("accepted","==",!1),np("sendTo","==",Op)),n=await gp(t),r=[],i=[];try{n.forEach((e=>{r.push(e.id),i.push(e.data().player1)}))}catch(e){console.error(e)}for(let t=0;t<i.length;t++){const n=r[t],s=i[t],o=document.createElement("li");let a="session"+r;o.className="invitationElement",o.id=a,o.innerHTML=bp().sanitize(`\n    <span class="username" id="userName">${s}</span>\n    <div style="transform: translateY(4px)">\n      <button id="create${n}" class="button">accept</button>\n      <button id="delete${n}" class="button">Decline</button>\n    </div>\n    `),e.appendChild(o),document.getElementById("create"+n).addEventListener("click",(()=>{Gp(n).then((e=>{"accepted"!=e?Bp("error","Error while accept request",3e3):document.getElementById(a).remove()}))})),document.getElementById("delete"+n).addEventListener("click",(()=>{yp(Df(Ep,"privateMessage",n)),document.getElementById(a).remove()}))}}()}),300)})),document.getElementById("buttonManageChanel").addEventListener("click",(()=>{Np="manageChanelPage",Rp=document.getElementById("dynamicContent"),Rp.style.opacity=0;const e=new XMLHttpRequest;e.open("GET","../../public/manageChanel.html",!0),e.onreadystatechange=function(){4===e.readyState&&200===e.status&&setTimeout((()=>{Rp.innerHTML=bp().sanitize(e.responseText),Rp.style.opacity=1}),200)},e.send(),setTimeout((()=>{!async function(){try{Vp();const e=Nf(Ep,"privateMessage"),t=ep(e,np("sendBy","==",Op),np("accepted","==",!0)),n=ep(e,np("sendTo","==",Op),np("accepted","==",!0)),r=await gp(t),i=await gp(n),s=[...r.docs,...i.docs],o=[],a=[],c=[],u=document.getElementById("chanelList");try{s.forEach(((e,t)=>{o.push(e.id),a.push(e.data().player1),c.push(e.data().player2);for(let e=0;e<o.length;e++){let t;const n=a[e],r=c[e],i=o[e],s=document.createElement("li");s.id=i,s.className="invitationElement",n===Mp?(s.innerHTML=bp().sanitize(`\n          <span class="username" id="userName">${r}</span>\n      <div style="transform: translateY(4px)">\n        <button id="join${i}" class="button">chat</button>\n        <button id="close${i}" class="button">Close</button>\n      </div>\n          `),t=r):r===Mp&&(s.innerHTML=bp().sanitize(`\n          <span class="username" id="userName">${n}</span>\n      <div style="transform: translateY(4px)">\n        <button id="join${i}" class="button">chat</button>\n        <button id="close${i}" class="button">Close</button>\n      </div>\n          `),t=n),u.appendChild(s);const l=document.getElementById("close"+i),h=document.getElementById("join"+i);let d=!1;const f=()=>{yp(Df(Ep,"privateMessage",i)),l.removeEventListener("click",f),document.getElementById(i).remove(),Bp("valid","chanel with <"+t+">has been closed",3e3)};l.addEventListener("click",(()=>{d||(d=!0,l.textContent="sure ?",l.style.backgroundColor="#f45b69",setTimeout((()=>{d&&l.addEventListener("click",f)}),500),setTimeout((()=>{d&&(l.textContent="close",l.style.backgroundColor="#e2e8c0",l.removeEventListener("click",f),d=!1)}),3e3))})),h.addEventListener("click",(()=>{Rp.style.opacity=0;const e=new XMLHttpRequest;e.open("GET","../../public/chatingPage.html",!0),e.onreadystatechange=function(){4===e.readyState&&200===e.status&&setTimeout((()=>{Rp.innerHTML=bp().sanitize(e.responseText),Rp.style.opacity=1}),200)},e.send(),setTimeout((()=>{document.getElementById("headerElem").innerHTML=bp().sanitize("")}),200),setTimeout((()=>{Kp(i)}),300)}),{once:!0})}}))}catch(e){console.error(e)}}catch(e){console.error(e)}}()}),300)}))}async function Gp(e){try{return(await Sp({sessionId:e})).data.status}catch(e){console.error(e)}}async function Kp(e,t){Np="chatingPage";const n=document.getElementById("sendButton"),r=document.getElementById("messageInput");setTimeout((()=>async function(e){try{!function(e,...t){var n,r,i;e=b(e);let s={includeMetadataChanges:!1},o=0;"object"!=typeof t[o]||Lf(t[o])||(s=t[o],o++);const a={includeMetadataChanges:s.includeMetadataChanges};if(Lf(t[o])){const e=t[o];t[o]=null===(n=e.next)||void 0===n?void 0:n.bind(e),t[o+1]=null===(r=e.error)||void 0===r?void 0:r.bind(e),t[o+2]=null===(i=e.complete)||void 0===i?void 0:i.bind(e)}let c,u,l;if(e instanceof Af)u=bf(e.firestore,Of),l=nu(e._key.path),c={next:n=>{t[o]&&t[o](vp(u,e,n))},error:t[o+1],complete:t[o+2]};else{const n=bf(e,Cf);u=bf(n.firestore,Of),l=n._query;const r=new mp(u);c={next:e=>{t[o]&&t[o](new fp(u,r,n,e))},error:t[o+1],complete:t[o+2]},Yf(e._query)}!function(e,t,n,r){const i=new hf(r),s=new Ud(t,i,n);e.asyncQueue.enqueueAndForget((async()=>Ld(await gf(e),s)))}(Pf(u),l,a,c)}(Nf(Ep,"privateMessage",e,"chat"),(t=>{(t.type="added")&&Qp(e)}))}catch(e){console.error(e)}}(e)),2e3),Vp(),async function(e){const t=document.getElementById("messageUl"),n=e;let r=[];t.innerHTML=bp().sanitize("");const i=localStorage.getItem("username");try{const e=ep(Nf(Ep,"privateMessage",n,"chat"),sp("createdAt"));r=(await gp(e)).docs.map((e=>({id:e.id,...e.data()})))}catch(e){return void Bp("error","Error : unable to retrieve message",3e3)}r.forEach((e=>{if(!document.getElementById(e.id)){const n=document.createElement("li");n.id=e.id,n.textContent=e.text,e.player===i?n.className="player1":n.className="player2",t.appendChild(n),t.scrollTop=t.scrollHeight}}))}(e),r.addEventListener("keydown",(t=>{"Enter"!==t.key||document.getElementById("offButton")||(n.id="offButton",n.className="offButton",n.style.cursor="default",Wp(e),r.value="")})),n.addEventListener("click",(()=>{n.id="offButton",n.className="offButton",n.style.cursor="default",Wp(e),r.value=""}))}async function Wp(e){const t=document.getElementById("offButton"),n=document.getElementById("messageInput");if(!n.value)return Bp("error","Error : can't send empty message",3e3),t.id="sendButton",t.style.cursor="pointer",void(t.className="buttonSend");try{const r=await Ap({message:n.value,sessionId:e});return Bp("valid",r.data.status,2e3),Qp(e),t.id="sendButton",t.style.cursor="pointer",t.className="buttonSend",n.value="",r.data.status}catch(e){console.error(e)}}async function Qp(e){const t=document.getElementById("messageUl"),n=e;let r=[];const i=localStorage.getItem("username");try{const e=ep(Nf(Ep,"privateMessage",n,"chat"),sp("createdAt"));r=(await gp(e)).docs.map((e=>({id:e.id,...e.data()})))}catch(e){return void Bp("error","Error : unable to retrieve Message",3e3)}r.forEach((e=>{if(!document.getElementById(e.id)){const n=document.createElement("li");n.id=e.id,n.textContent=e.text,e.player===i?n.className="player1":n.className="player2",t.appendChild(n),t.scrollTop=t.scrollHeight}}))}function Xp(e){const t=e.id,n=e;n.style.backgroundColor="#444444",n.style.color="#888888",n.textContent="Pending...",n.className="button99",n.id="disabled"+t}async function Yp(){try{const e=document.getElementById("buttonSignIn");e.removeEventListener("click",Yp),Xp(e);const t=(await Jp(["publicAdress"])).publicAdress;console.log(t);const n=await async function(){try{const e=await Jp(["uid","hash"]),{uid:t,hash:n}=e;if(t&&n)try{const e=await kp({uid:t,hash:n});if(e.data.error){let t="Unable to authentificate";switch(e.data.error){case"sent-data-unusable":t="Register yourself with the connect website.";break;case"internal-error":t="Unable to auth with provided DATA.";break;case"dont-own-token":t="You are not allowed to access."}return Bp("error",t,5e3),!1}if(e.data.token){const t=e.data.token.toString();return await async function(e,t){const n=wt(e),r=await async function(e,t){return He(e,"POST","/v1/accounts:signInWithCustomToken",ze(e,t))}(n,{token:t,returnSecureToken:!0}),i=await jt._fromIdTokenResponse(n,"signIn",r);return await n._updateCurrentUser(i.user),i}(_p,t),Bp("valid","Logged !",3e3),!0}}catch(e){return Bp("error","unable to authentificate",3e3),console.error(e),!1}return!1}catch(e){return console.error(e),!1}}();if(console.log(n),n){const e=document.getElementById("disabledbuttonSignIn");e.textContent=zp(t),e.disabled=!0,e.className="connectedButton",e.style="",e.style.marginTop="auto",e.id="buttonSignIn"}else{const e=document.getElementById("disabledbuttonSignIn");e.className="button",e.textContent="connect",e.id="buttonSignIn",document.getElementById("buttonSignIn").addEventListener("click",Yp)}}catch(e){console.error(e)}}async function Jp(e){return new Promise(((t,n)=>{chrome.storage.local.get(e,(e=>{chrome.runtime.lastError?n(chrome.runtime.lastError):t(e)}))}))}document.addEventListener("DOMContentLoaded",(async()=>{jp(),Np="homePage";let e=chrome.runtime.getManifest(),t=localStorage.getItem("AppVersion"),n=e.version;t||localStorage.setItem("AppVersion",n),t!=n&&(Bp("info","App have been updated.",3e3),localStorage.setItem("AppVersion",n)),document.getElementById("version").textContent="V "+n}))})()})();